<center><a href="bddc.c">Actual source code: bddc.c</a></center><br>

<html>
<head> <link rel="canonical" href="http://www.mcs.anl.gov/petsc/petsc-current/src/ksp/pc/impls/bddc/bddc.c.html" />
<title></title>
<meta name="generator" content="c2html 0.9.4">
<meta name="date" content="2016-10-03T02:49:20+00:00">
</head>

<body bgcolor="#FFFFFF">
   <div id="version" align=right><b>petsc-3.7.4 2016-10-02</b></div>
   <div id="bugreport" align=right><a href="mailto:petsc-maint@mcs.anl.gov?subject=Typo or Error in Documentation &body=Please describe the typo or error in the documentation: petsc-3.7.4 v3.7.4 src/ksp/pc/impls/bddc/bddc.c.html "><small>Report Typos and Errors</small></a></div>
<pre width="80"><a name="line1">  1: </a><font color="#B22222">/* TODOLIST</font>

<a name="line3">  3: </a><font color="#B22222">   Solvers</font>
<a name="line4">  4: </a><font color="#B22222">   - Add support for cholesky for coarse solver (similar to local solvers)</font>
<a name="line5">  5: </a><font color="#B22222">   - Propagate ksp prefixes for solvers to mat objects?</font>

<a name="line7">  7: </a><font color="#B22222">   User interface</font>
<a name="line8">  8: </a><font color="#B22222">   - ** <a href="../../../../../docs/manualpages/DM/DM.html#DM">DM</a> attached to pc?</font>

<a name="line10"> 10: </a><font color="#B22222">   Debugging output</font>
<a name="line11"> 11: </a><font color="#B22222">   - * Better management of verbosity levels of debugging output</font>

<a name="line13"> 13: </a><font color="#B22222">   Extra</font>
<a name="line14"> 14: </a><font color="#B22222">   - *** Is it possible to work with PCBDDCGraph on boundary indices only (less memory consumed)?</font>
<a name="line15"> 15: </a><font color="#B22222">   - BDDC with MG framework?</font>

<a name="line17"> 17: </a><font color="#B22222">   FETIDP</font>
<a name="line18"> 18: </a><font color="#B22222">   - Move FETIDP code to its own classes</font>

<a name="line20"> 20: </a><font color="#B22222">   <a href="../../../../../docs/manualpages/Mat/MATIS.html#MATIS">MATIS</a> related operations contained in BDDC code</font>
<a name="line21"> 21: </a><font color="#B22222">   - Provide general case for subassembling</font>

<a name="line23"> 23: </a><font color="#B22222">*/</font>

<a name="line25"> 25: </a><font color="#A020F0">#include &lt;../src/ksp/pc/impls/bddc/bddc.h&gt; </font><font color="#B22222">/*I "petscpc.h" I*/</font><font color="#A020F0">  </font><font color="#B22222">/* includes for fortran wrappers */</font><font color="#A020F0"></font>
<a name="line26"> 26: </a><font color="#A020F0">#include &lt;../src/ksp/pc/impls/bddc/bddcprivate.h&gt;</font>
<a name="line27"> 27: </a><font color="#A020F0">#include &lt;petscblaslapack.h&gt;</font>

<a name="line29"> 29: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>
<a name="line32"> 32: </a><strong><font color="#4169E1"><a name="PCSetFromOptions_BDDC"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PCSetFromOptions_BDDC(PetscOptionItems *PetscOptionsObject,<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> pc)</font></strong>
<a name="line33"> 33: </a>{
<a name="line34"> 34: </a>  PC_BDDC        *pcbddc = (PC_BDDC*)pc-&gt;data;

<a name="line38"> 38: </a>  <a href="../../../../../docs/manualpages/Sys/PetscOptionsHead.html#PetscOptionsHead">PetscOptionsHead</a>(PetscOptionsObject,<font color="#666666">"BDDC options"</font>);
<a name="line39"> 39: </a>  <font color="#B22222">/* Verbose debugging */</font>
<a name="line40"> 40: </a>  <a href="../../../../../docs/manualpages/Sys/PetscOptionsInt.html#PetscOptionsInt">PetscOptionsInt</a>(<font color="#666666">"-pc_bddc_check_level"</font>,<font color="#666666">"Verbose output for <a href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</a> (intended for debug)"</font>,<font color="#666666">"none"</font>,pcbddc-&gt;dbg_flag,&amp;pcbddc-&gt;dbg_flag,NULL);
<a name="line41"> 41: </a>  <font color="#B22222">/* Primal space customization */</font>
<a name="line42"> 42: </a>  <a href="../../../../../docs/manualpages/Sys/PetscOptionsBool.html#PetscOptionsBool">PetscOptionsBool</a>(<font color="#666666">"-pc_bddc_use_local_mat_graph"</font>,<font color="#666666">"Use or not adjacency graph of local mat for interface analysis"</font>,<font color="#666666">"none"</font>,pcbddc-&gt;use_local_adj,&amp;pcbddc-&gt;use_local_adj,NULL);
<a name="line43"> 43: </a>  <a href="../../../../../docs/manualpages/Sys/PetscOptionsBool.html#PetscOptionsBool">PetscOptionsBool</a>(<font color="#666666">"-pc_bddc_use_vertices"</font>,<font color="#666666">"Use or not corner dofs in coarse space"</font>,<font color="#666666">"none"</font>,pcbddc-&gt;use_vertices,&amp;pcbddc-&gt;use_vertices,NULL);
<a name="line44"> 44: </a>  <a href="../../../../../docs/manualpages/Sys/PetscOptionsBool.html#PetscOptionsBool">PetscOptionsBool</a>(<font color="#666666">"-pc_bddc_use_edges"</font>,<font color="#666666">"Use or not edge constraints in coarse space"</font>,<font color="#666666">"none"</font>,pcbddc-&gt;use_edges,&amp;pcbddc-&gt;use_edges,NULL);
<a name="line45"> 45: </a>  <a href="../../../../../docs/manualpages/Sys/PetscOptionsBool.html#PetscOptionsBool">PetscOptionsBool</a>(<font color="#666666">"-pc_bddc_use_faces"</font>,<font color="#666666">"Use or not face constraints in coarse space"</font>,<font color="#666666">"none"</font>,pcbddc-&gt;use_faces,&amp;pcbddc-&gt;use_faces,NULL);
<a name="line46"> 46: </a>  <a href="../../../../../docs/manualpages/Sys/PetscOptionsBool.html#PetscOptionsBool">PetscOptionsBool</a>(<font color="#666666">"-pc_bddc_use_true_nnsp"</font>,<font color="#666666">"Use near null space attached to the matrix without modifications"</font>,<font color="#666666">"none"</font>,pcbddc-&gt;use_nnsp_true,&amp;pcbddc-&gt;use_nnsp_true,NULL);
<a name="line47"> 47: </a>  <a href="../../../../../docs/manualpages/Sys/PetscOptionsBool.html#PetscOptionsBool">PetscOptionsBool</a>(<font color="#666666">"-pc_bddc_use_qr_single"</font>,<font color="#666666">"Use QR factorization for single constraints on cc (QR is used when multiple constraints are present)"</font>,<font color="#666666">"none"</font>,pcbddc-&gt;use_qr_single,&amp;pcbddc-&gt;use_qr_single,NULL);
<a name="line48"> 48: </a>  <font color="#B22222">/* Change of basis */</font>
<a name="line49"> 49: </a>  <a href="../../../../../docs/manualpages/Sys/PetscOptionsBool.html#PetscOptionsBool">PetscOptionsBool</a>(<font color="#666666">"-pc_bddc_use_change_of_basis"</font>,<font color="#666666">"Use or not internal change of basis on local edge nodes"</font>,<font color="#666666">"none"</font>,pcbddc-&gt;use_change_of_basis,&amp;pcbddc-&gt;use_change_of_basis,NULL);
<a name="line50"> 50: </a>  <a href="../../../../../docs/manualpages/Sys/PetscOptionsBool.html#PetscOptionsBool">PetscOptionsBool</a>(<font color="#666666">"-pc_bddc_use_change_on_faces"</font>,<font color="#666666">"Use or not internal change of basis on local face nodes"</font>,<font color="#666666">"none"</font>,pcbddc-&gt;use_change_on_faces,&amp;pcbddc-&gt;use_change_on_faces,NULL);
<a name="line51"> 51: </a>  <font color="#4169E1">if</font> (!pcbddc-&gt;use_change_of_basis) {
<a name="line52"> 52: </a>    pcbddc-&gt;use_change_on_faces = <a href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line53"> 53: </a>  }
<a name="line54"> 54: </a>  <font color="#B22222">/* Switch between M_2 (default) and M_3 preconditioners (as defined by C. Dohrmann in the ref. article) */</font>
<a name="line55"> 55: </a>  <a href="../../../../../docs/manualpages/Sys/PetscOptionsBool.html#PetscOptionsBool">PetscOptionsBool</a>(<font color="#666666">"-pc_bddc_switch_static"</font>,<font color="#666666">"Switch on static condensation ops around the interface preconditioner"</font>,<font color="#666666">"none"</font>,pcbddc-&gt;switch_static,&amp;pcbddc-&gt;switch_static,NULL);
<a name="line56"> 56: </a>  <a href="../../../../../docs/manualpages/Sys/PetscOptionsInt.html#PetscOptionsInt">PetscOptionsInt</a>(<font color="#666666">"-pc_bddc_coarse_redistribute"</font>,<font color="#666666">"Number of procs where to redistribute coarse problem"</font>,<font color="#666666">"none"</font>,pcbddc-&gt;redistribute_coarse,&amp;pcbddc-&gt;redistribute_coarse,NULL);
<a name="line57"> 57: </a>  <a href="../../../../../docs/manualpages/Sys/PetscOptionsInt.html#PetscOptionsInt">PetscOptionsInt</a>(<font color="#666666">"-pc_bddc_coarsening_ratio"</font>,<font color="#666666">"Set coarsening ratio used in multilevel coarsening"</font>,<font color="#666666">"none"</font>,pcbddc-&gt;coarsening_ratio,&amp;pcbddc-&gt;coarsening_ratio,NULL);
<a name="line58"> 58: </a>  <a href="../../../../../docs/manualpages/Sys/PetscOptionsInt.html#PetscOptionsInt">PetscOptionsInt</a>(<font color="#666666">"-pc_bddc_levels"</font>,<font color="#666666">"Set maximum number of levels for multilevel"</font>,<font color="#666666">"none"</font>,pcbddc-&gt;max_levels,&amp;pcbddc-&gt;max_levels,NULL);
<a name="line59"> 59: </a>  <a href="../../../../../docs/manualpages/Sys/PetscOptionsBool.html#PetscOptionsBool">PetscOptionsBool</a>(<font color="#666666">"-pc_bddc_use_coarse_estimates"</font>,<font color="#666666">"Use estimated eigenvalues for coarse problem"</font>,<font color="#666666">"none"</font>,pcbddc-&gt;use_coarse_estimates,&amp;pcbddc-&gt;use_coarse_estimates,NULL);
<a name="line60"> 60: </a>  <a href="../../../../../docs/manualpages/Sys/PetscOptionsBool.html#PetscOptionsBool">PetscOptionsBool</a>(<font color="#666666">"-pc_bddc_use_deluxe_scaling"</font>,<font color="#666666">"Use deluxe scaling for BDDC"</font>,<font color="#666666">"none"</font>,pcbddc-&gt;use_deluxe_scaling,&amp;pcbddc-&gt;use_deluxe_scaling,NULL);
<a name="line61"> 61: </a>  <a href="../../../../../docs/manualpages/Sys/PetscOptionsBool.html#PetscOptionsBool">PetscOptionsBool</a>(<font color="#666666">"-pc_bddc_schur_rebuild"</font>,<font color="#666666">"Whether or not the interface graph for Schur principal minors has to be rebuilt (i.e. define the interface without any adjacency)"</font>,<font color="#666666">"none"</font>,pcbddc-&gt;sub_schurs_rebuild,&amp;pcbddc-&gt;sub_schurs_rebuild,NULL);
<a name="line62"> 62: </a>  <a href="../../../../../docs/manualpages/Sys/PetscOptionsInt.html#PetscOptionsInt">PetscOptionsInt</a>(<font color="#666666">"-pc_bddc_schur_layers"</font>,<font color="#666666">"Number of dofs' layers for the computation of principal minors (i.e. -1 uses all dofs)"</font>,<font color="#666666">"none"</font>,pcbddc-&gt;sub_schurs_layers,&amp;pcbddc-&gt;sub_schurs_layers,NULL);
<a name="line63"> 63: </a>  <a href="../../../../../docs/manualpages/Sys/PetscOptionsBool.html#PetscOptionsBool">PetscOptionsBool</a>(<font color="#666666">"-pc_bddc_schur_use_useradj"</font>,<font color="#666666">"Whether or not the CSR graph specified by the user should be used for computing successive layers (default is to use adj of local mat)"</font>,<font color="#666666">"none"</font>,pcbddc-&gt;sub_schurs_use_useradj,&amp;pcbddc-&gt;sub_schurs_use_useradj,NULL);
<a name="line64"> 64: </a>  <a href="../../../../../docs/manualpages/Sys/PetscOptionsBool.html#PetscOptionsBool">PetscOptionsBool</a>(<font color="#666666">"-pc_bddc_deluxe_faster"</font>,<font color="#666666">"Faster application of deluxe scaling (requires extra work during setup)"</font>,<font color="#666666">"none"</font>,pcbddc-&gt;faster_deluxe,&amp;pcbddc-&gt;faster_deluxe,NULL);
<a name="line65"> 65: </a>  <a href="../../../../../docs/manualpages/Sys/PetscOptionsReal.html#PetscOptionsReal">PetscOptionsReal</a>(<font color="#666666">"-pc_bddc_adaptive_threshold"</font>,<font color="#666666">"Threshold to be used for adaptive selection of constraints"</font>,<font color="#666666">"none"</font>,pcbddc-&gt;adaptive_threshold,&amp;pcbddc-&gt;adaptive_threshold,NULL);
<a name="line66"> 66: </a>  <a href="../../../../../docs/manualpages/Sys/PetscOptionsInt.html#PetscOptionsInt">PetscOptionsInt</a>(<font color="#666666">"-pc_bddc_adaptive_nmin"</font>,<font color="#666666">"Minimum number of constraints per connected components"</font>,<font color="#666666">"none"</font>,pcbddc-&gt;adaptive_nmin,&amp;pcbddc-&gt;adaptive_nmin,NULL);
<a name="line67"> 67: </a>  <a href="../../../../../docs/manualpages/Sys/PetscOptionsInt.html#PetscOptionsInt">PetscOptionsInt</a>(<font color="#666666">"-pc_bddc_adaptive_nmax"</font>,<font color="#666666">"Maximum number of constraints per connected components"</font>,<font color="#666666">"none"</font>,pcbddc-&gt;adaptive_nmax,&amp;pcbddc-&gt;adaptive_nmax,NULL);
<a name="line68"> 68: </a>  <a href="../../../../../docs/manualpages/Sys/PetscOptionsBool.html#PetscOptionsBool">PetscOptionsBool</a>(<font color="#666666">"-pc_bddc_symmetric"</font>,<font color="#666666">"Symmetric computation of primal basis functions"</font>,<font color="#666666">"none"</font>,pcbddc-&gt;symmetric_primal,&amp;pcbddc-&gt;symmetric_primal,NULL);
<a name="line69"> 69: </a>  <a href="../../../../../docs/manualpages/Sys/PetscOptionsInt.html#PetscOptionsInt">PetscOptionsInt</a>(<font color="#666666">"-pc_bddc_coarse_adj"</font>,<font color="#666666">"Number of processors where to map the coarse adjacency list"</font>,<font color="#666666">"none"</font>,pcbddc-&gt;coarse_adj_red,&amp;pcbddc-&gt;coarse_adj_red,NULL);
<a name="line70"> 70: </a>  <a href="../../../../../docs/manualpages/Sys/PetscOptionsTail.html#PetscOptionsTail">PetscOptionsTail</a>();
<a name="line71"> 71: </a>  <font color="#4169E1">return</font>(0);
<a name="line72"> 72: </a>}

<a name="line74"> 74: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>
<a name="line77"> 77: </a><strong><font color="#4169E1"><a name="PCView_BDDC"></a>static <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PCView_BDDC(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> pc,<a href="../../../../../docs/manualpages/Viewer/PetscViewer.html#PetscViewer">PetscViewer</a> viewer)</font></strong>
<a name="line78"> 78: </a>{
<a name="line79"> 79: </a>  PC_BDDC              *pcbddc = (PC_BDDC*)pc-&gt;data;
<a name="line80"> 80: </a>  <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a>       ierr;
<a name="line81"> 81: </a>  <a href="../../../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a>            isascii,isstring;

<a name="line84"> 84: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectTypeCompare.html#PetscObjectTypeCompare">PetscObjectTypeCompare</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)viewer,PETSCVIEWERASCII,&amp;isascii);
<a name="line85"> 85: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectTypeCompare.html#PetscObjectTypeCompare">PetscObjectTypeCompare</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)viewer,PETSCVIEWERSTRING,&amp;isstring);

<a name="line87"> 87: </a>  <font color="#B22222">/* In a braindead way, print out anything which the user can control from the command line,</font>
<a name="line88"> 88: </a><font color="#B22222">     cribbing from PCSetFromOptions_BDDC */</font>

<a name="line90"> 90: </a>  <font color="#B22222">/* Nothing printed for the String viewer */</font>

<a name="line92"> 92: </a>  <font color="#B22222">/* ASCII viewer */</font>
<a name="line93"> 93: </a>  <font color="#4169E1">if</font> (isascii) {
<a name="line94"> 94: </a>    <font color="#B22222">/* Verbose debugging */</font>
<a name="line95"> 95: </a>    <a href="../../../../../docs/manualpages/Viewer/PetscViewerASCIIPrintf.html#PetscViewerASCIIPrintf">PetscViewerASCIIPrintf</a>(viewer,    <font color="#666666">"  BDDC: Use verbose output: %d\n"</font>,pcbddc-&gt;dbg_flag);

<a name="line97"> 97: </a>    <font color="#B22222">/* Primal space customization */</font>
<a name="line98"> 98: </a>    <a href="../../../../../docs/manualpages/Viewer/PetscViewerASCIIPrintf.html#PetscViewerASCIIPrintf">PetscViewerASCIIPrintf</a>(viewer,    <font color="#666666">"  BDDC: Use local mat graph: %d\n"</font>,pcbddc-&gt;use_local_adj);
<a name="line99"> 99: </a>    <a href="../../../../../docs/manualpages/Viewer/PetscViewerASCIIPrintf.html#PetscViewerASCIIPrintf">PetscViewerASCIIPrintf</a>(viewer,    <font color="#666666">"  BDDC: Use vertices: %d\n"</font>,pcbddc-&gt;use_vertices);
<a name="line100">100: </a>    <a href="../../../../../docs/manualpages/Viewer/PetscViewerASCIIPrintf.html#PetscViewerASCIIPrintf">PetscViewerASCIIPrintf</a>(viewer,    <font color="#666666">"  BDDC: Use edges: %d\n"</font>,pcbddc-&gt;use_edges);
<a name="line101">101: </a>    <a href="../../../../../docs/manualpages/Viewer/PetscViewerASCIIPrintf.html#PetscViewerASCIIPrintf">PetscViewerASCIIPrintf</a>(viewer,    <font color="#666666">"  BDDC: Use faces: %d\n"</font>,pcbddc-&gt;use_faces);
<a name="line102">102: </a>    <a href="../../../../../docs/manualpages/Viewer/PetscViewerASCIIPrintf.html#PetscViewerASCIIPrintf">PetscViewerASCIIPrintf</a>(viewer,    <font color="#666666">"  BDDC: Use true near null space: %d\n"</font>,pcbddc-&gt;use_nnsp_true);
<a name="line103">103: </a>    <a href="../../../../../docs/manualpages/Viewer/PetscViewerASCIIPrintf.html#PetscViewerASCIIPrintf">PetscViewerASCIIPrintf</a>(viewer,    <font color="#666666">"  BDDC: Use QR for single constraints on cc: %d\n"</font>,pcbddc-&gt;use_qr_single);

<a name="line105">105: </a>    <font color="#B22222">/* Change of basis */</font>
<a name="line106">106: </a>    <a href="../../../../../docs/manualpages/Viewer/PetscViewerASCIIPrintf.html#PetscViewerASCIIPrintf">PetscViewerASCIIPrintf</a>(viewer,    <font color="#666666">"  BDDC: Use change of basis on local edge nodes: %d\n"</font>,pcbddc-&gt;use_change_of_basis);
<a name="line107">107: </a>    <a href="../../../../../docs/manualpages/Viewer/PetscViewerASCIIPrintf.html#PetscViewerASCIIPrintf">PetscViewerASCIIPrintf</a>(viewer,    <font color="#666666">"  BDDC: Use change of basis on local face nodes: %d\n"</font>,pcbddc-&gt;use_change_on_faces);

<a name="line109">109: </a>    <font color="#B22222">/* Switch between M_2 (default) and M_3 preconditioners (as defined by C. Dohrmann in the ref. article) */</font>
<a name="line110">110: </a>    <a href="../../../../../docs/manualpages/Viewer/PetscViewerASCIIPrintf.html#PetscViewerASCIIPrintf">PetscViewerASCIIPrintf</a>(viewer,    <font color="#666666">"  BDDC: Switch on static condensation ops around the interface preconditioner: %d\n"</font>,pcbddc-&gt;switch_static);
<a name="line111">111: </a>    <a href="../../../../../docs/manualpages/Viewer/PetscViewerASCIIPrintf.html#PetscViewerASCIIPrintf">PetscViewerASCIIPrintf</a>(viewer,    <font color="#666666">"  BDDC: Coarse problem restribute procs: %d\n"</font>,pcbddc-&gt;redistribute_coarse);
<a name="line112">112: </a>    <a href="../../../../../docs/manualpages/Viewer/PetscViewerASCIIPrintf.html#PetscViewerASCIIPrintf">PetscViewerASCIIPrintf</a>(viewer,    <font color="#666666">"  BDDC: Multilevel coarsening ratio: %d\n"</font>,pcbddc-&gt;coarsening_ratio);
<a name="line113">113: </a>    <a href="../../../../../docs/manualpages/Viewer/PetscViewerASCIIPrintf.html#PetscViewerASCIIPrintf">PetscViewerASCIIPrintf</a>(viewer,    <font color="#666666">"  BDDC: Multilevel max levels: %d\n"</font>,pcbddc-&gt;max_levels);
<a name="line114">114: </a>    <a href="../../../../../docs/manualpages/Viewer/PetscViewerASCIIPrintf.html#PetscViewerASCIIPrintf">PetscViewerASCIIPrintf</a>(viewer,    <font color="#666666">"  BDDC: Use estimated eigs for coarse problem: %d\n"</font>,pcbddc-&gt;use_coarse_estimates);
<a name="line115">115: </a>    <a href="../../../../../docs/manualpages/Viewer/PetscViewerASCIIPrintf.html#PetscViewerASCIIPrintf">PetscViewerASCIIPrintf</a>(viewer,    <font color="#666666">"  BDDC: Use deluxe scaling: %d\n"</font>,pcbddc-&gt;use_deluxe_scaling);
<a name="line116">116: </a>    <a href="../../../../../docs/manualpages/Viewer/PetscViewerASCIIPrintf.html#PetscViewerASCIIPrintf">PetscViewerASCIIPrintf</a>(viewer,    <font color="#666666">"  BDDC: Rebuild interface graph for Schur principal minors: %d\n"</font>,pcbddc-&gt;sub_schurs_rebuild);
<a name="line117">117: </a>    <a href="../../../../../docs/manualpages/Viewer/PetscViewerASCIIPrintf.html#PetscViewerASCIIPrintf">PetscViewerASCIIPrintf</a>(viewer,    <font color="#666666">"  BDDC: Number of dofs' layers for the computation of principal minors: %d\n"</font>,pcbddc-&gt;sub_schurs_layers);
<a name="line118">118: </a>    <a href="../../../../../docs/manualpages/Viewer/PetscViewerASCIIPrintf.html#PetscViewerASCIIPrintf">PetscViewerASCIIPrintf</a>(viewer,    <font color="#666666">"  BDDC: Use user CSR graph to compute successive layers: %d\n"</font>,pcbddc-&gt;sub_schurs_use_useradj);
<a name="line119">119: </a>    <a href="../../../../../docs/manualpages/Viewer/PetscViewerASCIIPrintf.html#PetscViewerASCIIPrintf">PetscViewerASCIIPrintf</a>(viewer,    <font color="#666666">"  BDDC: Fast deluxe scaling: %d\n"</font>,pcbddc-&gt;faster_deluxe);
<a name="line120">120: </a>    <a href="../../../../../docs/manualpages/Viewer/PetscViewerASCIIPrintf.html#PetscViewerASCIIPrintf">PetscViewerASCIIPrintf</a>(viewer,    <font color="#666666">"  BDDC: Adaptive constraint selection threshold: %g\n"</font>,pcbddc-&gt;adaptive_threshold);
<a name="line121">121: </a>    <a href="../../../../../docs/manualpages/Viewer/PetscViewerASCIIPrintf.html#PetscViewerASCIIPrintf">PetscViewerASCIIPrintf</a>(viewer,    <font color="#666666">"  BDDC: Min constraints / connected component: %d\n"</font>,pcbddc-&gt;adaptive_nmin);
<a name="line122">122: </a>    <a href="../../../../../docs/manualpages/Viewer/PetscViewerASCIIPrintf.html#PetscViewerASCIIPrintf">PetscViewerASCIIPrintf</a>(viewer,    <font color="#666666">"  BDDC: Max constraints / connected component: %d\n"</font>,pcbddc-&gt;adaptive_nmax);
<a name="line123">123: </a>    <a href="../../../../../docs/manualpages/Viewer/PetscViewerASCIIPrintf.html#PetscViewerASCIIPrintf">PetscViewerASCIIPrintf</a>(viewer,    <font color="#666666">"  BDDC: Symmetric computation of primal basis functions: %d\n"</font>,pcbddc-&gt;symmetric_primal);
<a name="line124">124: </a>    <a href="../../../../../docs/manualpages/Viewer/PetscViewerASCIIPrintf.html#PetscViewerASCIIPrintf">PetscViewerASCIIPrintf</a>(viewer,    <font color="#666666">"  BDDC: Num. Procs. to map coarse adjacency list: %d\n"</font>,pcbddc-&gt;coarse_adj_red);
<a name="line125">125: </a>  }

<a name="line127">127: </a>  <font color="#4169E1">return</font>(0);
<a name="line128">128: </a>}

<a name="line130">130: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>
<a name="line133">133: </a><strong><font color="#4169E1"><a name="PCBDDCSetChangeOfBasisMat_BDDC"></a>static <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PCBDDCSetChangeOfBasisMat_BDDC(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> pc, <a href="../../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</a> change)</font></strong>
<a name="line134">134: </a>{
<a name="line135">135: </a>  PC_BDDC        *pcbddc = (PC_BDDC*)pc-&gt;data;

<a name="line139">139: </a>  <a href="../../../../../docs/manualpages/Mat/MatDestroy.html#MatDestroy">MatDestroy</a>(&amp;pcbddc-&gt;user_ChangeOfBasisMatrix);
<a name="line140">140: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectReference.html#PetscObjectReference">PetscObjectReference</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)change);
<a name="line141">141: </a>  pcbddc-&gt;user_ChangeOfBasisMatrix = change;
<a name="line142">142: </a>  <font color="#4169E1">return</font>(0);
<a name="line143">143: </a>}
<a name="line146">146: </a><font color="#B22222">/*@</font>
<a name="line147">147: </a><font color="#B22222"> <a href="../../../../../docs/manualpages/PC/PCBDDCSetChangeOfBasisMat.html#PCBDDCSetChangeOfBasisMat">PCBDDCSetChangeOfBasisMat</a> - Set user defined change of basis for dofs</font>

<a name="line149">149: </a><font color="#B22222">   Collective on <a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a></font>

<a name="line151">151: </a><font color="#B22222">   Input Parameters:</font>
<a name="line152">152: </a><font color="#B22222">+  pc - the preconditioning context</font>
<a name="line153">153: </a><font color="#B22222">-  change - the change of basis matrix</font>

<a name="line155">155: </a><font color="#B22222">   Level: intermediate</font>

<a name="line157">157: </a><font color="#B22222">   Notes:</font>

<a name="line159">159: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</a></font>
<a name="line160">160: </a><font color="#B22222">@*/</font>
<a name="line161">161: </a><strong><font color="#4169E1"><a name="PCBDDCSetChangeOfBasisMat"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/PC/PCBDDCSetChangeOfBasisMat.html#PCBDDCSetChangeOfBasisMat">PCBDDCSetChangeOfBasisMat</a>(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> pc, <a href="../../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</a> change)</font></strong>
<a name="line162">162: </a>{

<a name="line169">169: </a>  <font color="#4169E1">if</font> (pc-&gt;mat) {
<a name="line170">170: </a>    <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> rows_c,cols_c,rows,cols;
<a name="line171">171: </a>    <a href="../../../../../docs/manualpages/Mat/MatGetSize.html#MatGetSize">MatGetSize</a>(pc-&gt;mat,&amp;rows,&amp;cols);
<a name="line172">172: </a>    <a href="../../../../../docs/manualpages/Mat/MatGetSize.html#MatGetSize">MatGetSize</a>(change,&amp;rows_c,&amp;cols_c);
<a name="line173">173: </a>    <font color="#4169E1">if</font> (rows_c != rows) <a href="../../../../../docs/manualpages/Sys/SETERRQ2.html#SETERRQ2">SETERRQ2</a>(<a href="../../../../../docs/manualpages/Sys/PetscObjectComm.html#PetscObjectComm">PetscObjectComm</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc),PETSC_ERR_SUP,<font color="#666666">"Invalid number of rows for change of basis matrix! %d != %d"</font>,rows_c,rows);
<a name="line174">174: </a>    <font color="#4169E1">if</font> (cols_c != cols) <a href="../../../../../docs/manualpages/Sys/SETERRQ2.html#SETERRQ2">SETERRQ2</a>(<a href="../../../../../docs/manualpages/Sys/PetscObjectComm.html#PetscObjectComm">PetscObjectComm</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc),PETSC_ERR_SUP,<font color="#666666">"Invalid number of columns for change of basis matrix! %d != %d"</font>,cols_c,cols);
<a name="line175">175: </a>    <a href="../../../../../docs/manualpages/Mat/MatGetLocalSize.html#MatGetLocalSize">MatGetLocalSize</a>(pc-&gt;mat,&amp;rows,&amp;cols);
<a name="line176">176: </a>    <a href="../../../../../docs/manualpages/Mat/MatGetLocalSize.html#MatGetLocalSize">MatGetLocalSize</a>(change,&amp;rows_c,&amp;cols_c);
<a name="line177">177: </a>    <font color="#4169E1">if</font> (rows_c != rows) <a href="../../../../../docs/manualpages/Sys/SETERRQ2.html#SETERRQ2">SETERRQ2</a>(<a href="../../../../../docs/manualpages/Sys/PetscObjectComm.html#PetscObjectComm">PetscObjectComm</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc),PETSC_ERR_SUP,<font color="#666666">"Invalid number of local rows for change of basis matrix! %d != %d"</font>,rows_c,rows);
<a name="line178">178: </a>    <font color="#4169E1">if</font> (cols_c != cols) <a href="../../../../../docs/manualpages/Sys/SETERRQ2.html#SETERRQ2">SETERRQ2</a>(<a href="../../../../../docs/manualpages/Sys/PetscObjectComm.html#PetscObjectComm">PetscObjectComm</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc),PETSC_ERR_SUP,<font color="#666666">"Invalid number of local columns for change of basis matrix! %d != %d"</font>,cols_c,cols);
<a name="line179">179: </a>  }
<a name="line180">180: </a>  PetscTryMethod(pc,<font color="#666666">"PCBDDCSetChangeOfBasisMat_C"</font>,(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a>,<a href="../../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</a>),(pc,change));
<a name="line181">181: </a>  <font color="#4169E1">return</font>(0);
<a name="line182">182: </a>}
<a name="line183">183: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>
<a name="line186">186: </a><strong><font color="#4169E1"><a name="PCBDDCSetPrimalVerticesLocalIS_BDDC"></a>static <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PCBDDCSetPrimalVerticesLocalIS_BDDC(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> pc, <a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a> PrimalVertices)</font></strong>
<a name="line187">187: </a>{
<a name="line188">188: </a>  PC_BDDC        *pcbddc = (PC_BDDC*)pc-&gt;data;

<a name="line192">192: </a>  <a href="../../../../../docs/manualpages/IS/ISDestroy.html#ISDestroy">ISDestroy</a>(&amp;pcbddc-&gt;user_primal_vertices);
<a name="line193">193: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectReference.html#PetscObjectReference">PetscObjectReference</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)PrimalVertices);
<a name="line194">194: </a>  pcbddc-&gt;user_primal_vertices = PrimalVertices;
<a name="line195">195: </a>  <font color="#4169E1">return</font>(0);
<a name="line196">196: </a>}
<a name="line199">199: </a><font color="#B22222">/*@</font>
<a name="line200">200: </a><font color="#B22222"> <a href="../../../../../docs/manualpages/PC/PCBDDCSetPrimalVerticesLocalIS.html#PCBDDCSetPrimalVerticesLocalIS">PCBDDCSetPrimalVerticesLocalIS</a> - Set additional user defined primal vertices in <a href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</a></font>

<a name="line202">202: </a><font color="#B22222">   Collective</font>

<a name="line204">204: </a><font color="#B22222">   Input Parameters:</font>
<a name="line205">205: </a><font color="#B22222">+  pc - the preconditioning context</font>
<a name="line206">206: </a><font color="#B22222">-  PrimalVertices - index set of primal vertices in local numbering (can be empty)</font>

<a name="line208">208: </a><font color="#B22222">   Level: intermediate</font>

<a name="line210">210: </a><font color="#B22222">   Notes:</font>

<a name="line212">212: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</a></font>
<a name="line213">213: </a><font color="#B22222">@*/</font>
<a name="line214">214: </a><strong><font color="#4169E1"><a name="PCBDDCSetPrimalVerticesLocalIS"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/PC/PCBDDCSetPrimalVerticesLocalIS.html#PCBDDCSetPrimalVerticesLocalIS">PCBDDCSetPrimalVerticesLocalIS</a>(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> pc, <a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a> PrimalVertices)</font></strong>
<a name="line215">215: </a>{

<a name="line222">222: </a>  PetscTryMethod(pc,<font color="#666666">"PCBDDCSetPrimalVerticesLocalIS_C"</font>,(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a>,<a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a>),(pc,PrimalVertices));
<a name="line223">223: </a>  <font color="#4169E1">return</font>(0);
<a name="line224">224: </a>}
<a name="line225">225: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>
<a name="line228">228: </a><strong><font color="#4169E1"><a name="PCBDDCSetCoarseningRatio_BDDC"></a>static <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PCBDDCSetCoarseningRatio_BDDC(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> pc,<a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> k)</font></strong>
<a name="line229">229: </a>{
<a name="line230">230: </a>  PC_BDDC  *pcbddc = (PC_BDDC*)pc-&gt;data;

<a name="line233">233: </a>  pcbddc-&gt;coarsening_ratio = k;
<a name="line234">234: </a>  <font color="#4169E1">return</font>(0);
<a name="line235">235: </a>}

<a name="line239">239: </a><font color="#B22222">/*@</font>
<a name="line240">240: </a><font color="#B22222"> <a href="../../../../../docs/manualpages/PC/PCBDDCSetCoarseningRatio.html#PCBDDCSetCoarseningRatio">PCBDDCSetCoarseningRatio</a> - Set coarsening ratio used in multilevel</font>

<a name="line242">242: </a><font color="#B22222">   Logically collective on <a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a></font>

<a name="line244">244: </a><font color="#B22222">   Input Parameters:</font>
<a name="line245">245: </a><font color="#B22222">+  pc - the preconditioning context</font>
<a name="line246">246: </a><font color="#B22222">-  k - coarsening ratio (H/h at the coarser level)</font>

<a name="line248">248: </a><font color="#B22222">   Options Database Keys:</font>
<a name="line249">249: </a><font color="#B22222">.    -pc_bddc_coarsening_ratio</font>

<a name="line251">251: </a><font color="#B22222">   Level: intermediate</font>

<a name="line253">253: </a><font color="#B22222">   Notes:</font>
<a name="line254">254: </a><font color="#B22222">     Approximatively k subdomains at the finer level will be aggregated into a single subdomain at the coarser level</font>

<a name="line256">256: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</a>, <a href="../../../../../docs/manualpages/PC/PCBDDCSetLevels.html#PCBDDCSetLevels">PCBDDCSetLevels</a>()</font>
<a name="line257">257: </a><font color="#B22222">@*/</font>
<a name="line258">258: </a><strong><font color="#4169E1"><a name="PCBDDCSetCoarseningRatio"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/PC/PCBDDCSetCoarseningRatio.html#PCBDDCSetCoarseningRatio">PCBDDCSetCoarseningRatio</a>(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> pc,<a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> k)</font></strong>
<a name="line259">259: </a>{

<a name="line265">265: </a>  PetscTryMethod(pc,<font color="#666666">"PCBDDCSetCoarseningRatio_C"</font>,(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a>,<a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>),(pc,k));
<a name="line266">266: </a>  <font color="#4169E1">return</font>(0);
<a name="line267">267: </a>}

<a name="line269">269: </a><font color="#B22222">/* The following functions (PCBDDCSetUseExactDirichlet PCBDDCSetLevel) are not public */</font>
<a name="line272">272: </a><strong><font color="#4169E1"><a name="PCBDDCSetUseExactDirichlet_BDDC"></a>static <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PCBDDCSetUseExactDirichlet_BDDC(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> pc,<a href="../../../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a> flg)</font></strong>
<a name="line273">273: </a>{
<a name="line274">274: </a>  PC_BDDC  *pcbddc = (PC_BDDC*)pc-&gt;data;

<a name="line277">277: </a>  pcbddc-&gt;use_exact_dirichlet_trick = flg;
<a name="line278">278: </a>  <font color="#4169E1">return</font>(0);
<a name="line279">279: </a>}

<a name="line283">283: </a><strong><font color="#4169E1"><a name="PCBDDCSetUseExactDirichlet"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PCBDDCSetUseExactDirichlet(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> pc,<a href="../../../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a> flg)</font></strong>
<a name="line284">284: </a>{

<a name="line290">290: </a>  PetscTryMethod(pc,<font color="#666666">"PCBDDCSetUseExactDirichlet_C"</font>,(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a>,<a href="../../../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a>),(pc,flg));
<a name="line291">291: </a>  <font color="#4169E1">return</font>(0);
<a name="line292">292: </a>}

<a name="line296">296: </a><strong><font color="#4169E1"><a name="PCBDDCSetLevel_BDDC"></a>static <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PCBDDCSetLevel_BDDC(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> pc,<a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> level)</font></strong>
<a name="line297">297: </a>{
<a name="line298">298: </a>  PC_BDDC  *pcbddc = (PC_BDDC*)pc-&gt;data;

<a name="line301">301: </a>  pcbddc-&gt;current_level = level;
<a name="line302">302: </a>  <font color="#4169E1">return</font>(0);
<a name="line303">303: </a>}

<a name="line307">307: </a><strong><font color="#4169E1"><a name="PCBDDCSetLevel"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PCBDDCSetLevel(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> pc,<a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> level)</font></strong>
<a name="line308">308: </a>{

<a name="line314">314: </a>  PetscTryMethod(pc,<font color="#666666">"PCBDDCSetLevel_C"</font>,(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a>,<a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>),(pc,level));
<a name="line315">315: </a>  <font color="#4169E1">return</font>(0);
<a name="line316">316: </a>}

<a name="line320">320: </a><strong><font color="#4169E1"><a name="PCBDDCSetLevels_BDDC"></a>static <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PCBDDCSetLevels_BDDC(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> pc,<a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> levels)</font></strong>
<a name="line321">321: </a>{
<a name="line322">322: </a>  PC_BDDC  *pcbddc = (PC_BDDC*)pc-&gt;data;

<a name="line325">325: </a>  pcbddc-&gt;max_levels = levels;
<a name="line326">326: </a>  <font color="#4169E1">return</font>(0);
<a name="line327">327: </a>}

<a name="line331">331: </a><font color="#B22222">/*@</font>
<a name="line332">332: </a><font color="#B22222"> <a href="../../../../../docs/manualpages/PC/PCBDDCSetLevels.html#PCBDDCSetLevels">PCBDDCSetLevels</a> - Sets the maximum number of levels for multilevel</font>

<a name="line334">334: </a><font color="#B22222">   Logically collective on <a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a></font>

<a name="line336">336: </a><font color="#B22222">   Input Parameters:</font>
<a name="line337">337: </a><font color="#B22222">+  pc - the preconditioning context</font>
<a name="line338">338: </a><font color="#B22222">-  levels - the maximum number of levels (max 9)</font>

<a name="line340">340: </a><font color="#B22222">   Options Database Keys:</font>
<a name="line341">341: </a><font color="#B22222">.    -pc_bddc_levels</font>

<a name="line343">343: </a><font color="#B22222">   Level: intermediate</font>

<a name="line345">345: </a><font color="#B22222">   Notes:</font>
<a name="line346">346: </a><font color="#B22222">     Default value is 0, i.e. traditional one-level BDDC</font>

<a name="line348">348: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</a>, <a href="../../../../../docs/manualpages/PC/PCBDDCSetCoarseningRatio.html#PCBDDCSetCoarseningRatio">PCBDDCSetCoarseningRatio</a>()</font>
<a name="line349">349: </a><font color="#B22222">@*/</font>
<a name="line350">350: </a><strong><font color="#4169E1"><a name="PCBDDCSetLevels"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/PC/PCBDDCSetLevels.html#PCBDDCSetLevels">PCBDDCSetLevels</a>(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> pc,<a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> levels)</font></strong>
<a name="line351">351: </a>{

<a name="line357">357: </a>  <font color="#4169E1">if</font> (levels &gt; 99) <a href="../../../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</a>(<a href="../../../../../docs/manualpages/Sys/PetscObjectComm.html#PetscObjectComm">PetscObjectComm</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc),PETSC_ERR_SUP,<font color="#666666">"Maximum number of levels for bddc is 99\n"</font>);
<a name="line358">358: </a>  PetscTryMethod(pc,<font color="#666666">"PCBDDCSetLevels_C"</font>,(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a>,<a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>),(pc,levels));
<a name="line359">359: </a>  <font color="#4169E1">return</font>(0);
<a name="line360">360: </a>}
<a name="line361">361: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>

<a name="line365">365: </a><strong><font color="#4169E1"><a name="PCBDDCSetNullSpace_BDDC"></a>static <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PCBDDCSetNullSpace_BDDC(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> pc,<a href="../../../../../docs/manualpages/Mat/MatNullSpace.html#MatNullSpace">MatNullSpace</a> NullSpace)</font></strong>
<a name="line366">366: </a>{
<a name="line367">367: </a>  PC_BDDC  *pcbddc = (PC_BDDC*)pc-&gt;data;

<a name="line371">371: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectReference.html#PetscObjectReference">PetscObjectReference</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)NullSpace);
<a name="line372">372: </a>  <a href="../../../../../docs/manualpages/Mat/MatNullSpaceDestroy.html#MatNullSpaceDestroy">MatNullSpaceDestroy</a>(&amp;pcbddc-&gt;NullSpace);
<a name="line373">373: </a>  pcbddc-&gt;NullSpace = NullSpace;
<a name="line374">374: </a>  <font color="#4169E1">return</font>(0);
<a name="line375">375: </a>}

<a name="line379">379: </a><font color="#B22222">/*@</font>
<a name="line380">380: </a><font color="#B22222"> <a href="../../../../../docs/manualpages/PC/PCBDDCSetNullSpace.html#PCBDDCSetNullSpace">PCBDDCSetNullSpace</a> - Set nullspace for BDDC operator</font>

<a name="line382">382: </a><font color="#B22222">   Logically collective on <a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> and <a href="../../../../../docs/manualpages/Mat/MatNullSpace.html#MatNullSpace">MatNullSpace</a></font>

<a name="line384">384: </a><font color="#B22222">   Input Parameters:</font>
<a name="line385">385: </a><font color="#B22222">+  pc - the preconditioning context</font>
<a name="line386">386: </a><font color="#B22222">-  NullSpace - Null space of the linear operator to be preconditioned (Pmat)</font>

<a name="line388">388: </a><font color="#B22222">   Level: intermediate</font>

<a name="line390">390: </a><font color="#B22222">   Notes:</font>

<a name="line392">392: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</a></font>
<a name="line393">393: </a><font color="#B22222">@*/</font>
<a name="line394">394: </a><strong><font color="#4169E1"><a name="PCBDDCSetNullSpace"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/PC/PCBDDCSetNullSpace.html#PCBDDCSetNullSpace">PCBDDCSetNullSpace</a>(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> pc,<a href="../../../../../docs/manualpages/Mat/MatNullSpace.html#MatNullSpace">MatNullSpace</a> NullSpace)</font></strong>
<a name="line395">395: </a>{

<a name="line402">402: </a>  PetscTryMethod(pc,<font color="#666666">"PCBDDCSetNullSpace_C"</font>,(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a>,<a href="../../../../../docs/manualpages/Mat/MatNullSpace.html#MatNullSpace">MatNullSpace</a>),(pc,NullSpace));
<a name="line403">403: </a>  <font color="#4169E1">return</font>(0);
<a name="line404">404: </a>}
<a name="line405">405: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>

<a name="line409">409: </a><strong><font color="#4169E1"><a name="PCBDDCSetDirichletBoundaries_BDDC"></a>static <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PCBDDCSetDirichletBoundaries_BDDC(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> pc,<a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a> DirichletBoundaries)</font></strong>
<a name="line410">410: </a>{
<a name="line411">411: </a>  PC_BDDC  *pcbddc = (PC_BDDC*)pc-&gt;data;

<a name="line415">415: </a>  <font color="#B22222">/* last user setting takes precendence -&gt; destroy any other customization */</font>
<a name="line416">416: </a>  <a href="../../../../../docs/manualpages/IS/ISDestroy.html#ISDestroy">ISDestroy</a>(&amp;pcbddc-&gt;DirichletBoundariesLocal);
<a name="line417">417: </a>  <a href="../../../../../docs/manualpages/IS/ISDestroy.html#ISDestroy">ISDestroy</a>(&amp;pcbddc-&gt;DirichletBoundaries);
<a name="line418">418: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectReference.html#PetscObjectReference">PetscObjectReference</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)DirichletBoundaries);
<a name="line419">419: </a>  pcbddc-&gt;DirichletBoundaries = DirichletBoundaries;
<a name="line420">420: </a>  pcbddc-&gt;recompute_topography = <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line421">421: </a>  <font color="#4169E1">return</font>(0);
<a name="line422">422: </a>}

<a name="line426">426: </a><font color="#B22222">/*@</font>
<a name="line427">427: </a><font color="#B22222"> <a href="../../../../../docs/manualpages/PC/PCBDDCSetDirichletBoundaries.html#PCBDDCSetDirichletBoundaries">PCBDDCSetDirichletBoundaries</a> - Set <a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a> defining Dirichlet boundaries for the global problem.</font>

<a name="line429">429: </a><font color="#B22222">   Collective</font>

<a name="line431">431: </a><font color="#B22222">   Input Parameters:</font>
<a name="line432">432: </a><font color="#B22222">+  pc - the preconditioning context</font>
<a name="line433">433: </a><font color="#B22222">-  DirichletBoundaries - parallel <a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a> defining the Dirichlet boundaries</font>

<a name="line435">435: </a><font color="#B22222">   Level: intermediate</font>

<a name="line437">437: </a><font color="#B22222">   Notes:</font>
<a name="line438">438: </a><font color="#B22222">     Provide the information if you used <a href="../../../../../docs/manualpages/Mat/MatZeroRows.html#MatZeroRows">MatZeroRows</a>/Columns routines. Any process can list any global node</font>

<a name="line440">440: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</a>, <a href="../../../../../docs/manualpages/PC/PCBDDCSetDirichletBoundariesLocal.html#PCBDDCSetDirichletBoundariesLocal">PCBDDCSetDirichletBoundariesLocal</a>(), <a href="../../../../../docs/manualpages/Mat/MatZeroRows.html#MatZeroRows">MatZeroRows</a>(), <a href="../../../../../docs/manualpages/Mat/MatZeroRowsColumns.html#MatZeroRowsColumns">MatZeroRowsColumns</a>()</font>
<a name="line441">441: </a><font color="#B22222">@*/</font>
<a name="line442">442: </a><strong><font color="#4169E1"><a name="PCBDDCSetDirichletBoundaries"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/PC/PCBDDCSetDirichletBoundaries.html#PCBDDCSetDirichletBoundaries">PCBDDCSetDirichletBoundaries</a>(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> pc,<a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a> DirichletBoundaries)</font></strong>
<a name="line443">443: </a>{

<a name="line450">450: </a>  PetscTryMethod(pc,<font color="#666666">"PCBDDCSetDirichletBoundaries_C"</font>,(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a>,<a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a>),(pc,DirichletBoundaries));
<a name="line451">451: </a>  <font color="#4169E1">return</font>(0);
<a name="line452">452: </a>}
<a name="line453">453: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>

<a name="line457">457: </a><strong><font color="#4169E1"><a name="PCBDDCSetDirichletBoundariesLocal_BDDC"></a>static <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PCBDDCSetDirichletBoundariesLocal_BDDC(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> pc,<a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a> DirichletBoundaries)</font></strong>
<a name="line458">458: </a>{
<a name="line459">459: </a>  PC_BDDC  *pcbddc = (PC_BDDC*)pc-&gt;data;

<a name="line463">463: </a>  <font color="#B22222">/* last user setting takes precendence -&gt; destroy any other customization */</font>
<a name="line464">464: </a>  <a href="../../../../../docs/manualpages/IS/ISDestroy.html#ISDestroy">ISDestroy</a>(&amp;pcbddc-&gt;DirichletBoundariesLocal);
<a name="line465">465: </a>  <a href="../../../../../docs/manualpages/IS/ISDestroy.html#ISDestroy">ISDestroy</a>(&amp;pcbddc-&gt;DirichletBoundaries);
<a name="line466">466: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectReference.html#PetscObjectReference">PetscObjectReference</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)DirichletBoundaries);
<a name="line467">467: </a>  pcbddc-&gt;DirichletBoundariesLocal = DirichletBoundaries;
<a name="line468">468: </a>  pcbddc-&gt;recompute_topography = <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line469">469: </a>  <font color="#4169E1">return</font>(0);
<a name="line470">470: </a>}

<a name="line474">474: </a><font color="#B22222">/*@</font>
<a name="line475">475: </a><font color="#B22222"> <a href="../../../../../docs/manualpages/PC/PCBDDCSetDirichletBoundariesLocal.html#PCBDDCSetDirichletBoundariesLocal">PCBDDCSetDirichletBoundariesLocal</a> - Set <a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a> defining Dirichlet boundaries for the global problem in local ordering.</font>

<a name="line477">477: </a><font color="#B22222">   Collective</font>

<a name="line479">479: </a><font color="#B22222">   Input Parameters:</font>
<a name="line480">480: </a><font color="#B22222">+  pc - the preconditioning context</font>
<a name="line481">481: </a><font color="#B22222">-  DirichletBoundaries - parallel <a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a> defining the Dirichlet boundaries (in local ordering)</font>

<a name="line483">483: </a><font color="#B22222">   Level: intermediate</font>

<a name="line485">485: </a><font color="#B22222">   Notes:</font>

<a name="line487">487: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</a>, <a href="../../../../../docs/manualpages/PC/PCBDDCSetDirichletBoundaries.html#PCBDDCSetDirichletBoundaries">PCBDDCSetDirichletBoundaries</a>(), <a href="../../../../../docs/manualpages/Mat/MatZeroRows.html#MatZeroRows">MatZeroRows</a>(), <a href="../../../../../docs/manualpages/Mat/MatZeroRowsColumns.html#MatZeroRowsColumns">MatZeroRowsColumns</a>()</font>
<a name="line488">488: </a><font color="#B22222">@*/</font>
<a name="line489">489: </a><strong><font color="#4169E1"><a name="PCBDDCSetDirichletBoundariesLocal"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/PC/PCBDDCSetDirichletBoundariesLocal.html#PCBDDCSetDirichletBoundariesLocal">PCBDDCSetDirichletBoundariesLocal</a>(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> pc,<a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a> DirichletBoundaries)</font></strong>
<a name="line490">490: </a>{

<a name="line497">497: </a>  PetscTryMethod(pc,<font color="#666666">"PCBDDCSetDirichletBoundariesLocal_C"</font>,(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a>,<a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a>),(pc,DirichletBoundaries));
<a name="line498">498: </a>  <font color="#4169E1">return</font>(0);
<a name="line499">499: </a>}
<a name="line500">500: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>

<a name="line504">504: </a><strong><font color="#4169E1"><a name="PCBDDCSetNeumannBoundaries_BDDC"></a>static <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PCBDDCSetNeumannBoundaries_BDDC(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> pc,<a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a> NeumannBoundaries)</font></strong>
<a name="line505">505: </a>{
<a name="line506">506: </a>  PC_BDDC  *pcbddc = (PC_BDDC*)pc-&gt;data;

<a name="line510">510: </a>  <font color="#B22222">/* last user setting takes precendence -&gt; destroy any other customization */</font>
<a name="line511">511: </a>  <a href="../../../../../docs/manualpages/IS/ISDestroy.html#ISDestroy">ISDestroy</a>(&amp;pcbddc-&gt;NeumannBoundariesLocal);
<a name="line512">512: </a>  <a href="../../../../../docs/manualpages/IS/ISDestroy.html#ISDestroy">ISDestroy</a>(&amp;pcbddc-&gt;NeumannBoundaries);
<a name="line513">513: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectReference.html#PetscObjectReference">PetscObjectReference</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)NeumannBoundaries);
<a name="line514">514: </a>  pcbddc-&gt;NeumannBoundaries = NeumannBoundaries;
<a name="line515">515: </a>  pcbddc-&gt;recompute_topography = <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line516">516: </a>  <font color="#4169E1">return</font>(0);
<a name="line517">517: </a>}

<a name="line521">521: </a><font color="#B22222">/*@</font>
<a name="line522">522: </a><font color="#B22222"> <a href="../../../../../docs/manualpages/PC/PCBDDCSetNeumannBoundaries.html#PCBDDCSetNeumannBoundaries">PCBDDCSetNeumannBoundaries</a> - Set <a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a> defining Neumann boundaries for the global problem.</font>

<a name="line524">524: </a><font color="#B22222">   Collective</font>

<a name="line526">526: </a><font color="#B22222">   Input Parameters:</font>
<a name="line527">527: </a><font color="#B22222">+  pc - the preconditioning context</font>
<a name="line528">528: </a><font color="#B22222">-  NeumannBoundaries - parallel <a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a> defining the Neumann boundaries</font>

<a name="line530">530: </a><font color="#B22222">   Level: intermediate</font>

<a name="line532">532: </a><font color="#B22222">   Notes:</font>
<a name="line533">533: </a><font color="#B22222">     Any process can list any global node</font>

<a name="line535">535: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</a>, <a href="../../../../../docs/manualpages/PC/PCBDDCSetNeumannBoundariesLocal.html#PCBDDCSetNeumannBoundariesLocal">PCBDDCSetNeumannBoundariesLocal</a>()</font>
<a name="line536">536: </a><font color="#B22222">@*/</font>
<a name="line537">537: </a><strong><font color="#4169E1"><a name="PCBDDCSetNeumannBoundaries"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/PC/PCBDDCSetNeumannBoundaries.html#PCBDDCSetNeumannBoundaries">PCBDDCSetNeumannBoundaries</a>(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> pc,<a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a> NeumannBoundaries)</font></strong>
<a name="line538">538: </a>{

<a name="line545">545: </a>  PetscTryMethod(pc,<font color="#666666">"PCBDDCSetNeumannBoundaries_C"</font>,(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a>,<a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a>),(pc,NeumannBoundaries));
<a name="line546">546: </a>  <font color="#4169E1">return</font>(0);
<a name="line547">547: </a>}
<a name="line548">548: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>

<a name="line552">552: </a><strong><font color="#4169E1"><a name="PCBDDCSetNeumannBoundariesLocal_BDDC"></a>static <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PCBDDCSetNeumannBoundariesLocal_BDDC(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> pc,<a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a> NeumannBoundaries)</font></strong>
<a name="line553">553: </a>{
<a name="line554">554: </a>  PC_BDDC  *pcbddc = (PC_BDDC*)pc-&gt;data;

<a name="line558">558: </a>  <font color="#B22222">/* last user setting takes precendence -&gt; destroy any other customization */</font>
<a name="line559">559: </a>  <a href="../../../../../docs/manualpages/IS/ISDestroy.html#ISDestroy">ISDestroy</a>(&amp;pcbddc-&gt;NeumannBoundariesLocal);
<a name="line560">560: </a>  <a href="../../../../../docs/manualpages/IS/ISDestroy.html#ISDestroy">ISDestroy</a>(&amp;pcbddc-&gt;NeumannBoundaries);
<a name="line561">561: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectReference.html#PetscObjectReference">PetscObjectReference</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)NeumannBoundaries);
<a name="line562">562: </a>  pcbddc-&gt;NeumannBoundariesLocal = NeumannBoundaries;
<a name="line563">563: </a>  pcbddc-&gt;recompute_topography = <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line564">564: </a>  <font color="#4169E1">return</font>(0);
<a name="line565">565: </a>}

<a name="line569">569: </a><font color="#B22222">/*@</font>
<a name="line570">570: </a><font color="#B22222"> <a href="../../../../../docs/manualpages/PC/PCBDDCSetNeumannBoundariesLocal.html#PCBDDCSetNeumannBoundariesLocal">PCBDDCSetNeumannBoundariesLocal</a> - Set <a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a> defining Neumann boundaries for the global problem in local ordering.</font>

<a name="line572">572: </a><font color="#B22222">   Collective</font>

<a name="line574">574: </a><font color="#B22222">   Input Parameters:</font>
<a name="line575">575: </a><font color="#B22222">+  pc - the preconditioning context</font>
<a name="line576">576: </a><font color="#B22222">-  NeumannBoundaries - parallel <a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a> defining the subdomain part of Neumann boundaries (in local ordering)</font>

<a name="line578">578: </a><font color="#B22222">   Level: intermediate</font>

<a name="line580">580: </a><font color="#B22222">   Notes:</font>

<a name="line582">582: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</a>, <a href="../../../../../docs/manualpages/PC/PCBDDCSetNeumannBoundaries.html#PCBDDCSetNeumannBoundaries">PCBDDCSetNeumannBoundaries</a>()</font>
<a name="line583">583: </a><font color="#B22222">@*/</font>
<a name="line584">584: </a><strong><font color="#4169E1"><a name="PCBDDCSetNeumannBoundariesLocal"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/PC/PCBDDCSetNeumannBoundariesLocal.html#PCBDDCSetNeumannBoundariesLocal">PCBDDCSetNeumannBoundariesLocal</a>(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> pc,<a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a> NeumannBoundaries)</font></strong>
<a name="line585">585: </a>{

<a name="line592">592: </a>  PetscTryMethod(pc,<font color="#666666">"PCBDDCSetNeumannBoundariesLocal_C"</font>,(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a>,<a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a>),(pc,NeumannBoundaries));
<a name="line593">593: </a>  <font color="#4169E1">return</font>(0);
<a name="line594">594: </a>}
<a name="line595">595: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>

<a name="line599">599: </a><strong><font color="#4169E1"><a name="PCBDDCGetDirichletBoundaries_BDDC"></a>static <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PCBDDCGetDirichletBoundaries_BDDC(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> pc,<a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a> *DirichletBoundaries)</font></strong>
<a name="line600">600: </a>{
<a name="line601">601: </a>  PC_BDDC  *pcbddc = (PC_BDDC*)pc-&gt;data;

<a name="line604">604: </a>  *DirichletBoundaries = pcbddc-&gt;DirichletBoundaries;
<a name="line605">605: </a>  <font color="#4169E1">return</font>(0);
<a name="line606">606: </a>}

<a name="line610">610: </a><font color="#B22222">/*@</font>
<a name="line611">611: </a><font color="#B22222"> <a href="../../../../../docs/manualpages/PC/PCBDDCGetDirichletBoundaries.html#PCBDDCGetDirichletBoundaries">PCBDDCGetDirichletBoundaries</a> - Get parallel <a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a> for Dirichlet boundaries</font>

<a name="line613">613: </a><font color="#B22222">   Collective</font>

<a name="line615">615: </a><font color="#B22222">   Input Parameters:</font>
<a name="line616">616: </a><font color="#B22222">.  pc - the preconditioning context</font>

<a name="line618">618: </a><font color="#B22222">   Output Parameters:</font>
<a name="line619">619: </a><font color="#B22222">.  DirichletBoundaries - index set defining the Dirichlet boundaries</font>

<a name="line621">621: </a><font color="#B22222">   Level: intermediate</font>

<a name="line623">623: </a><font color="#B22222">   Notes:</font>
<a name="line624">624: </a><font color="#B22222">     The <a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a> returned (if any) is the same passed in earlier by the user with <a href="../../../../../docs/manualpages/PC/PCBDDCSetDirichletBoundaries.html#PCBDDCSetDirichletBoundaries">PCBDDCSetDirichletBoundaries</a></font>

<a name="line626">626: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</a></font>
<a name="line627">627: </a><font color="#B22222">@*/</font>
<a name="line628">628: </a><strong><font color="#4169E1"><a name="PCBDDCGetDirichletBoundaries"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/PC/PCBDDCGetDirichletBoundaries.html#PCBDDCGetDirichletBoundaries">PCBDDCGetDirichletBoundaries</a>(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> pc,<a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a> *DirichletBoundaries)</font></strong>
<a name="line629">629: </a>{

<a name="line634">634: </a>  PetscUseMethod(pc,<font color="#666666">"PCBDDCGetDirichletBoundaries_C"</font>,(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a>,<a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a>*),(pc,DirichletBoundaries));
<a name="line635">635: </a>  <font color="#4169E1">return</font>(0);
<a name="line636">636: </a>}
<a name="line637">637: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>

<a name="line641">641: </a><strong><font color="#4169E1"><a name="PCBDDCGetDirichletBoundariesLocal_BDDC"></a>static <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PCBDDCGetDirichletBoundariesLocal_BDDC(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> pc,<a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a> *DirichletBoundaries)</font></strong>
<a name="line642">642: </a>{
<a name="line643">643: </a>  PC_BDDC  *pcbddc = (PC_BDDC*)pc-&gt;data;

<a name="line646">646: </a>  *DirichletBoundaries = pcbddc-&gt;DirichletBoundariesLocal;
<a name="line647">647: </a>  <font color="#4169E1">return</font>(0);
<a name="line648">648: </a>}

<a name="line652">652: </a><font color="#B22222">/*@</font>
<a name="line653">653: </a><font color="#B22222"> <a href="../../../../../docs/manualpages/PC/PCBDDCGetDirichletBoundariesLocal.html#PCBDDCGetDirichletBoundariesLocal">PCBDDCGetDirichletBoundariesLocal</a> - Get parallel <a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a> for Dirichlet boundaries (in local ordering)</font>

<a name="line655">655: </a><font color="#B22222">   Collective</font>

<a name="line657">657: </a><font color="#B22222">   Input Parameters:</font>
<a name="line658">658: </a><font color="#B22222">.  pc - the preconditioning context</font>

<a name="line660">660: </a><font color="#B22222">   Output Parameters:</font>
<a name="line661">661: </a><font color="#B22222">.  DirichletBoundaries - index set defining the subdomain part of Dirichlet boundaries</font>

<a name="line663">663: </a><font color="#B22222">   Level: intermediate</font>

<a name="line665">665: </a><font color="#B22222">   Notes:</font>
<a name="line666">666: </a><font color="#B22222">     The <a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a> returned could be the same passed in earlier by the user (if provided with <a href="../../../../../docs/manualpages/PC/PCBDDCSetDirichletBoundariesLocal.html#PCBDDCSetDirichletBoundariesLocal">PCBDDCSetDirichletBoundariesLocal</a>) or a global-to-local map of the global <a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a> (if provided with <a href="../../../../../docs/manualpages/PC/PCBDDCSetDirichletBoundaries.html#PCBDDCSetDirichletBoundaries">PCBDDCSetDirichletBoundaries</a>).</font>
<a name="line667">667: </a><font color="#B22222">          In the latter case, the <a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a> will be available after <a href="../../../../../docs/manualpages/PC/PCSetUp.html#PCSetUp">PCSetUp</a>.</font>

<a name="line669">669: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</a></font>
<a name="line670">670: </a><font color="#B22222">@*/</font>
<a name="line671">671: </a><strong><font color="#4169E1"><a name="PCBDDCGetDirichletBoundariesLocal"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/PC/PCBDDCGetDirichletBoundariesLocal.html#PCBDDCGetDirichletBoundariesLocal">PCBDDCGetDirichletBoundariesLocal</a>(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> pc,<a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a> *DirichletBoundaries)</font></strong>
<a name="line672">672: </a>{

<a name="line677">677: </a>  PetscUseMethod(pc,<font color="#666666">"PCBDDCGetDirichletBoundariesLocal_C"</font>,(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a>,<a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a>*),(pc,DirichletBoundaries));
<a name="line678">678: </a>  <font color="#4169E1">return</font>(0);
<a name="line679">679: </a>}
<a name="line680">680: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>

<a name="line684">684: </a><strong><font color="#4169E1"><a name="PCBDDCGetNeumannBoundaries_BDDC"></a>static <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PCBDDCGetNeumannBoundaries_BDDC(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> pc,<a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a> *NeumannBoundaries)</font></strong>
<a name="line685">685: </a>{
<a name="line686">686: </a>  PC_BDDC  *pcbddc = (PC_BDDC*)pc-&gt;data;

<a name="line689">689: </a>  *NeumannBoundaries = pcbddc-&gt;NeumannBoundaries;
<a name="line690">690: </a>  <font color="#4169E1">return</font>(0);
<a name="line691">691: </a>}

<a name="line695">695: </a><font color="#B22222">/*@</font>
<a name="line696">696: </a><font color="#B22222"> <a href="../../../../../docs/manualpages/PC/PCBDDCGetNeumannBoundaries.html#PCBDDCGetNeumannBoundaries">PCBDDCGetNeumannBoundaries</a> - Get parallel <a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a> for Neumann boundaries</font>

<a name="line698">698: </a><font color="#B22222">   Collective</font>

<a name="line700">700: </a><font color="#B22222">   Input Parameters:</font>
<a name="line701">701: </a><font color="#B22222">.  pc - the preconditioning context</font>

<a name="line703">703: </a><font color="#B22222">   Output Parameters:</font>
<a name="line704">704: </a><font color="#B22222">.  NeumannBoundaries - index set defining the Neumann boundaries</font>

<a name="line706">706: </a><font color="#B22222">   Level: intermediate</font>

<a name="line708">708: </a><font color="#B22222">   Notes:</font>
<a name="line709">709: </a><font color="#B22222">     The <a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a> returned (if any) is the same passed in earlier by the user with <a href="../../../../../docs/manualpages/PC/PCBDDCSetNeumannBoundaries.html#PCBDDCSetNeumannBoundaries">PCBDDCSetNeumannBoundaries</a></font>

<a name="line711">711: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</a></font>
<a name="line712">712: </a><font color="#B22222">@*/</font>
<a name="line713">713: </a><strong><font color="#4169E1"><a name="PCBDDCGetNeumannBoundaries"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/PC/PCBDDCGetNeumannBoundaries.html#PCBDDCGetNeumannBoundaries">PCBDDCGetNeumannBoundaries</a>(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> pc,<a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a> *NeumannBoundaries)</font></strong>
<a name="line714">714: </a>{

<a name="line719">719: </a>  PetscUseMethod(pc,<font color="#666666">"PCBDDCGetNeumannBoundaries_C"</font>,(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a>,<a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a>*),(pc,NeumannBoundaries));
<a name="line720">720: </a>  <font color="#4169E1">return</font>(0);
<a name="line721">721: </a>}
<a name="line722">722: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>

<a name="line726">726: </a><strong><font color="#4169E1"><a name="PCBDDCGetNeumannBoundariesLocal_BDDC"></a>static <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PCBDDCGetNeumannBoundariesLocal_BDDC(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> pc,<a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a> *NeumannBoundaries)</font></strong>
<a name="line727">727: </a>{
<a name="line728">728: </a>  PC_BDDC  *pcbddc = (PC_BDDC*)pc-&gt;data;

<a name="line731">731: </a>  *NeumannBoundaries = pcbddc-&gt;NeumannBoundariesLocal;
<a name="line732">732: </a>  <font color="#4169E1">return</font>(0);
<a name="line733">733: </a>}

<a name="line737">737: </a><font color="#B22222">/*@</font>
<a name="line738">738: </a><font color="#B22222"> <a href="../../../../../docs/manualpages/PC/PCBDDCGetNeumannBoundariesLocal.html#PCBDDCGetNeumannBoundariesLocal">PCBDDCGetNeumannBoundariesLocal</a> - Get parallel <a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a> for Neumann boundaries (in local ordering)</font>

<a name="line740">740: </a><font color="#B22222">   Collective</font>

<a name="line742">742: </a><font color="#B22222">   Input Parameters:</font>
<a name="line743">743: </a><font color="#B22222">.  pc - the preconditioning context</font>

<a name="line745">745: </a><font color="#B22222">   Output Parameters:</font>
<a name="line746">746: </a><font color="#B22222">.  NeumannBoundaries - index set defining the subdomain part of Neumann boundaries</font>

<a name="line748">748: </a><font color="#B22222">   Level: intermediate</font>

<a name="line750">750: </a><font color="#B22222">   Notes:</font>
<a name="line751">751: </a><font color="#B22222">     The <a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a> returned could be the same passed in earlier by the user (if provided with <a href="../../../../../docs/manualpages/PC/PCBDDCSetNeumannBoundariesLocal.html#PCBDDCSetNeumannBoundariesLocal">PCBDDCSetNeumannBoundariesLocal</a>) or a global-to-local map of the global <a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a> (if provided with <a href="../../../../../docs/manualpages/PC/PCBDDCSetNeumannBoundaries.html#PCBDDCSetNeumannBoundaries">PCBDDCSetNeumannBoundaries</a>).</font>
<a name="line752">752: </a><font color="#B22222">          In the latter case, the <a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a> will be available after <a href="../../../../../docs/manualpages/PC/PCSetUp.html#PCSetUp">PCSetUp</a>.</font>

<a name="line754">754: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</a></font>
<a name="line755">755: </a><font color="#B22222">@*/</font>
<a name="line756">756: </a><strong><font color="#4169E1"><a name="PCBDDCGetNeumannBoundariesLocal"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/PC/PCBDDCGetNeumannBoundariesLocal.html#PCBDDCGetNeumannBoundariesLocal">PCBDDCGetNeumannBoundariesLocal</a>(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> pc,<a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a> *NeumannBoundaries)</font></strong>
<a name="line757">757: </a>{

<a name="line762">762: </a>  PetscUseMethod(pc,<font color="#666666">"PCBDDCGetNeumannBoundariesLocal_C"</font>,(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a>,<a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a>*),(pc,NeumannBoundaries));
<a name="line763">763: </a>  <font color="#4169E1">return</font>(0);
<a name="line764">764: </a>}
<a name="line765">765: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>

<a name="line769">769: </a><strong><font color="#4169E1"><a name="PCBDDCSetLocalAdjacencyGraph_BDDC"></a>static <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PCBDDCSetLocalAdjacencyGraph_BDDC(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> pc, <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> nvtxs,const <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> xadj[],const <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> adjncy[], <a href="../../../../../docs/manualpages/Sys/PetscCopyMode.html#PetscCopyMode">PetscCopyMode</a> copymode)</font></strong>
<a name="line770">770: </a>{
<a name="line771">771: </a>  PC_BDDC        *pcbddc = (PC_BDDC*)pc-&gt;data;
<a name="line772">772: </a>  PCBDDCGraph    mat_graph = pcbddc-&gt;mat_graph;

<a name="line776">776: </a>  <font color="#B22222">/* free old CSR */</font>
<a name="line777">777: </a>  PCBDDCGraphResetCSR(mat_graph);
<a name="line778">778: </a>  <font color="#B22222">/* TODO: PCBDDCGraphSetAdjacency */</font>
<a name="line779">779: </a>  <font color="#B22222">/* get CSR into graph structure */</font>
<a name="line780">780: </a>  <font color="#4169E1">if</font> (copymode == PETSC_COPY_VALUES) {
<a name="line781">781: </a>    <a href="../../../../../docs/manualpages/Sys/PetscMalloc1.html#PetscMalloc1">PetscMalloc1</a>(nvtxs+1,&amp;mat_graph-&gt;xadj);
<a name="line782">782: </a>    <a href="../../../../../docs/manualpages/Sys/PetscMalloc1.html#PetscMalloc1">PetscMalloc1</a>(xadj[nvtxs],&amp;mat_graph-&gt;adjncy);
<a name="line783">783: </a>    <a href="../../../../../docs/manualpages/Sys/PetscMemcpy.html#PetscMemcpy">PetscMemcpy</a>(mat_graph-&gt;xadj,xadj,(nvtxs+1)*<font color="#4169E1">sizeof</font>(<a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>));
<a name="line784">784: </a>    <a href="../../../../../docs/manualpages/Sys/PetscMemcpy.html#PetscMemcpy">PetscMemcpy</a>(mat_graph-&gt;adjncy,adjncy,xadj[nvtxs]*<font color="#4169E1">sizeof</font>(<a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>));
<a name="line785">785: </a>  } <font color="#4169E1">else</font> <font color="#4169E1">if</font> (copymode == PETSC_OWN_POINTER) {
<a name="line786">786: </a>    mat_graph-&gt;xadj = (<a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>*)xadj;
<a name="line787">787: </a>    mat_graph-&gt;adjncy = (<a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>*)adjncy;
<a name="line788">788: </a>  }
<a name="line789">789: </a>  mat_graph-&gt;nvtxs_csr = nvtxs;
<a name="line790">790: </a>  <font color="#4169E1">return</font>(0);
<a name="line791">791: </a>}

<a name="line795">795: </a><font color="#B22222">/*@</font>
<a name="line796">796: </a><font color="#B22222"> <a href="../../../../../docs/manualpages/PC/PCBDDCSetLocalAdjacencyGraph.html#PCBDDCSetLocalAdjacencyGraph">PCBDDCSetLocalAdjacencyGraph</a> - Set adjacency structure (CSR graph) of the local matrix</font>

<a name="line798">798: </a><font color="#B22222">   Not collective</font>

<a name="line800">800: </a><font color="#B22222">   Input Parameters:</font>
<a name="line801">801: </a><font color="#B22222">+  pc - the preconditioning context</font>
<a name="line802">802: </a><font color="#B22222">.  nvtxs - number of local vertices of the graph (i.e., the size of the local problem)</font>
<a name="line803">803: </a><font color="#B22222">.  xadj, adjncy - the CSR graph</font>
<a name="line804">804: </a><font color="#B22222">-  copymode - either PETSC_COPY_VALUES or PETSC_OWN_POINTER.</font>

<a name="line806">806: </a><font color="#B22222">   Level: intermediate</font>

<a name="line808">808: </a><font color="#B22222">   Notes:</font>

<a name="line810">810: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</a>,<a href="../../../../../docs/manualpages/Sys/PetscCopyMode.html#PetscCopyMode">PetscCopyMode</a></font>
<a name="line811">811: </a><font color="#B22222">@*/</font>
<a name="line812">812: </a><strong><font color="#4169E1"><a name="PCBDDCSetLocalAdjacencyGraph"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/PC/PCBDDCSetLocalAdjacencyGraph.html#PCBDDCSetLocalAdjacencyGraph">PCBDDCSetLocalAdjacencyGraph</a>(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> pc,<a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> nvtxs,const <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> xadj[],const <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> adjncy[], <a href="../../../../../docs/manualpages/Sys/PetscCopyMode.html#PetscCopyMode">PetscCopyMode</a> copymode)</font></strong>
<a name="line813">813: </a>{
<a name="line814">814: </a>  void (*f)(void) = 0;

<a name="line821">821: </a>  <font color="#4169E1">if</font> (copymode != PETSC_COPY_VALUES &amp;&amp; copymode != PETSC_OWN_POINTER)  <a href="../../../../../docs/manualpages/Sys/SETERRQ1.html#SETERRQ1">SETERRQ1</a>(<a href="../../../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>,PETSC_ERR_SUP,<font color="#666666">"Unsupported copy mode %d"</font>,copymode);
<a name="line822">822: </a>  PetscTryMethod(pc,<font color="#666666">"PCBDDCSetLocalAdjacencyGraph_C"</font>,(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a>,<a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>,const <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>[],const <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>[],<a href="../../../../../docs/manualpages/Sys/PetscCopyMode.html#PetscCopyMode">PetscCopyMode</a>),(pc,nvtxs,xadj,adjncy,copymode));
<a name="line823">823: </a>  <font color="#B22222">/* free arrays if <a href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</a> is not the <a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> type */</font>
<a name="line824">824: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectQueryFunction.html#PetscObjectQueryFunction">PetscObjectQueryFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc,<font color="#666666">"PCBDDCSetLocalAdjacencyGraph_C"</font>,&amp;f);
<a name="line825">825: </a>  <font color="#4169E1">if</font> (!f &amp;&amp; copymode == PETSC_OWN_POINTER) {
<a name="line826">826: </a>    <a href="../../../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</a>(xadj);
<a name="line827">827: </a>    <a href="../../../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</a>(adjncy);
<a name="line828">828: </a>  }
<a name="line829">829: </a>  <font color="#4169E1">return</font>(0);
<a name="line830">830: </a>}
<a name="line831">831: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>

<a name="line835">835: </a><strong><font color="#4169E1"><a name="PCBDDCSetDofsSplittingLocal_BDDC"></a>static <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PCBDDCSetDofsSplittingLocal_BDDC(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> pc,<a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> n_is, <a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a> ISForDofs[])</font></strong>
<a name="line836">836: </a>{
<a name="line837">837: </a>  PC_BDDC  *pcbddc = (PC_BDDC*)pc-&gt;data;
<a name="line838">838: </a>  <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> i;

<a name="line842">842: </a>  <font color="#B22222">/* Destroy ISes if they were already set */</font>
<a name="line843">843: </a>  <font color="#4169E1">for</font> (i=0;i&lt;pcbddc-&gt;n_ISForDofsLocal;i++) {
<a name="line844">844: </a>    <a href="../../../../../docs/manualpages/IS/ISDestroy.html#ISDestroy">ISDestroy</a>(&amp;pcbddc-&gt;ISForDofsLocal[i]);
<a name="line845">845: </a>  }
<a name="line846">846: </a>  <a href="../../../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</a>(pcbddc-&gt;ISForDofsLocal);
<a name="line847">847: </a>  <font color="#B22222">/* last user setting takes precendence -&gt; destroy any other customization */</font>
<a name="line848">848: </a>  <font color="#4169E1">for</font> (i=0;i&lt;pcbddc-&gt;n_ISForDofs;i++) {
<a name="line849">849: </a>    <a href="../../../../../docs/manualpages/IS/ISDestroy.html#ISDestroy">ISDestroy</a>(&amp;pcbddc-&gt;ISForDofs[i]);
<a name="line850">850: </a>  }
<a name="line851">851: </a>  <a href="../../../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</a>(pcbddc-&gt;ISForDofs);
<a name="line852">852: </a>  pcbddc-&gt;n_ISForDofs = 0;
<a name="line853">853: </a>  <font color="#B22222">/* allocate space then set */</font>
<a name="line854">854: </a>  <font color="#4169E1">if</font> (n_is) {
<a name="line855">855: </a>    <a href="../../../../../docs/manualpages/Sys/PetscMalloc1.html#PetscMalloc1">PetscMalloc1</a>(n_is,&amp;pcbddc-&gt;ISForDofsLocal);
<a name="line856">856: </a>  }
<a name="line857">857: </a>  <font color="#4169E1">for</font> (i=0;i&lt;n_is;i++) {
<a name="line858">858: </a>    <a href="../../../../../docs/manualpages/Sys/PetscObjectReference.html#PetscObjectReference">PetscObjectReference</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)ISForDofs[i]);
<a name="line859">859: </a>    pcbddc-&gt;ISForDofsLocal[i]=ISForDofs[i];
<a name="line860">860: </a>  }
<a name="line861">861: </a>  pcbddc-&gt;n_ISForDofsLocal=n_is;
<a name="line862">862: </a>  <font color="#4169E1">if</font> (n_is) pcbddc-&gt;user_provided_isfordofs = <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line863">863: </a>  pcbddc-&gt;recompute_topography = <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line864">864: </a>  <font color="#4169E1">return</font>(0);
<a name="line865">865: </a>}

<a name="line869">869: </a><font color="#B22222">/*@</font>
<a name="line870">870: </a><font color="#B22222"> <a href="../../../../../docs/manualpages/PC/PCBDDCSetDofsSplittingLocal.html#PCBDDCSetDofsSplittingLocal">PCBDDCSetDofsSplittingLocal</a> - Set index sets defining fields of the local subdomain matrix</font>

<a name="line872">872: </a><font color="#B22222">   Collective</font>

<a name="line874">874: </a><font color="#B22222">   Input Parameters:</font>
<a name="line875">875: </a><font color="#B22222">+  pc - the preconditioning context</font>
<a name="line876">876: </a><font color="#B22222">.  n_is - number of index sets defining the fields</font>
<a name="line877">877: </a><font color="#B22222">-  ISForDofs - array of <a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a> describing the fields in local ordering</font>

<a name="line879">879: </a><font color="#B22222">   Level: intermediate</font>

<a name="line881">881: </a><font color="#B22222">   Notes:</font>
<a name="line882">882: </a><font color="#B22222">     n_is should be the same among processes. Not all nodes need to be listed: unlisted nodes will belong to the complement field.</font>

<a name="line884">884: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</a></font>
<a name="line885">885: </a><font color="#B22222">@*/</font>
<a name="line886">886: </a><strong><font color="#4169E1"><a name="PCBDDCSetDofsSplittingLocal"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/PC/PCBDDCSetDofsSplittingLocal.html#PCBDDCSetDofsSplittingLocal">PCBDDCSetDofsSplittingLocal</a>(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> pc,<a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> n_is, <a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a> ISForDofs[])</font></strong>
<a name="line887">887: </a>{
<a name="line888">888: </a>  <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>       i;

<a name="line894">894: </a>  <font color="#4169E1">for</font> (i=0;i&lt;n_is;i++) {
<a name="line897">897: </a>  }
<a name="line898">898: </a>  PetscTryMethod(pc,<font color="#666666">"PCBDDCSetDofsSplittingLocal_C"</font>,(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a>,<a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>,<a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a>[]),(pc,n_is,ISForDofs));
<a name="line899">899: </a>  <font color="#4169E1">return</font>(0);
<a name="line900">900: </a>}
<a name="line901">901: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>

<a name="line905">905: </a><strong><font color="#4169E1"><a name="PCBDDCSetDofsSplitting_BDDC"></a>static <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PCBDDCSetDofsSplitting_BDDC(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> pc,<a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> n_is, <a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a> ISForDofs[])</font></strong>
<a name="line906">906: </a>{
<a name="line907">907: </a>  PC_BDDC  *pcbddc = (PC_BDDC*)pc-&gt;data;
<a name="line908">908: </a>  <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> i;

<a name="line912">912: </a>  <font color="#B22222">/* Destroy ISes if they were already set */</font>
<a name="line913">913: </a>  <font color="#4169E1">for</font> (i=0;i&lt;pcbddc-&gt;n_ISForDofs;i++) {
<a name="line914">914: </a>    <a href="../../../../../docs/manualpages/IS/ISDestroy.html#ISDestroy">ISDestroy</a>(&amp;pcbddc-&gt;ISForDofs[i]);
<a name="line915">915: </a>  }
<a name="line916">916: </a>  <a href="../../../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</a>(pcbddc-&gt;ISForDofs);
<a name="line917">917: </a>  <font color="#B22222">/* last user setting takes precendence -&gt; destroy any other customization */</font>
<a name="line918">918: </a>  <font color="#4169E1">for</font> (i=0;i&lt;pcbddc-&gt;n_ISForDofsLocal;i++) {
<a name="line919">919: </a>    <a href="../../../../../docs/manualpages/IS/ISDestroy.html#ISDestroy">ISDestroy</a>(&amp;pcbddc-&gt;ISForDofsLocal[i]);
<a name="line920">920: </a>  }
<a name="line921">921: </a>  <a href="../../../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</a>(pcbddc-&gt;ISForDofsLocal);
<a name="line922">922: </a>  pcbddc-&gt;n_ISForDofsLocal = 0;
<a name="line923">923: </a>  <font color="#B22222">/* allocate space then set */</font>
<a name="line924">924: </a>  <font color="#4169E1">if</font> (n_is) {
<a name="line925">925: </a>    <a href="../../../../../docs/manualpages/Sys/PetscMalloc1.html#PetscMalloc1">PetscMalloc1</a>(n_is,&amp;pcbddc-&gt;ISForDofs);
<a name="line926">926: </a>  }
<a name="line927">927: </a>  <font color="#4169E1">for</font> (i=0;i&lt;n_is;i++) {
<a name="line928">928: </a>    <a href="../../../../../docs/manualpages/Sys/PetscObjectReference.html#PetscObjectReference">PetscObjectReference</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)ISForDofs[i]);
<a name="line929">929: </a>    pcbddc-&gt;ISForDofs[i]=ISForDofs[i];
<a name="line930">930: </a>  }
<a name="line931">931: </a>  pcbddc-&gt;n_ISForDofs=n_is;
<a name="line932">932: </a>  <font color="#4169E1">if</font> (n_is) pcbddc-&gt;user_provided_isfordofs = <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line933">933: </a>  pcbddc-&gt;recompute_topography = <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line934">934: </a>  <font color="#4169E1">return</font>(0);
<a name="line935">935: </a>}

<a name="line939">939: </a><font color="#B22222">/*@</font>
<a name="line940">940: </a><font color="#B22222"> <a href="../../../../../docs/manualpages/PC/PCBDDCSetDofsSplitting.html#PCBDDCSetDofsSplitting">PCBDDCSetDofsSplitting</a> - Set index sets defining fields of the global matrix</font>

<a name="line942">942: </a><font color="#B22222">   Collective</font>

<a name="line944">944: </a><font color="#B22222">   Input Parameters:</font>
<a name="line945">945: </a><font color="#B22222">+  pc - the preconditioning context</font>
<a name="line946">946: </a><font color="#B22222">.  n_is - number of index sets defining the fields</font>
<a name="line947">947: </a><font color="#B22222">-  ISForDofs - array of <a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a> describing the fields in global ordering</font>

<a name="line949">949: </a><font color="#B22222">   Level: intermediate</font>

<a name="line951">951: </a><font color="#B22222">   Notes:</font>
<a name="line952">952: </a><font color="#B22222">     Any process can list any global node. Not all nodes need to be listed: unlisted nodes will belong to the complement field.</font>

<a name="line954">954: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</a></font>
<a name="line955">955: </a><font color="#B22222">@*/</font>
<a name="line956">956: </a><strong><font color="#4169E1"><a name="PCBDDCSetDofsSplitting"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/PC/PCBDDCSetDofsSplitting.html#PCBDDCSetDofsSplitting">PCBDDCSetDofsSplitting</a>(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> pc,<a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> n_is, <a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a> ISForDofs[])</font></strong>
<a name="line957">957: </a>{
<a name="line958">958: </a>  <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>       i;

<a name="line964">964: </a>  <font color="#4169E1">for</font> (i=0;i&lt;n_is;i++) {
<a name="line967">967: </a>  }
<a name="line968">968: </a>  PetscTryMethod(pc,<font color="#666666">"PCBDDCSetDofsSplitting_C"</font>,(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a>,<a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>,<a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a>[]),(pc,n_is,ISForDofs));
<a name="line969">969: </a>  <font color="#4169E1">return</font>(0);
<a name="line970">970: </a>}

<a name="line972">972: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>
<a name="line975">975: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>
<a name="line976">976: </a><font color="#B22222">/*</font>
<a name="line977">977: </a><font color="#B22222">   PCPreSolve_BDDC - Changes the right hand side and (if necessary) the initial</font>
<a name="line978">978: </a><font color="#B22222">                     guess if a transformation of basis approach has been selected.</font>

<a name="line980">980: </a><font color="#B22222">   Input Parameter:</font>
<a name="line981">981: </a><font color="#B22222">+  pc - the preconditioner contex</font>

<a name="line983">983: </a><font color="#B22222">   Application Interface Routine: <a href="../../../../../docs/manualpages/PC/PCPreSolve.html#PCPreSolve">PCPreSolve</a>()</font>

<a name="line985">985: </a><font color="#B22222">   Notes:</font>
<a name="line986">986: </a><font color="#B22222">     The interface routine <a href="../../../../../docs/manualpages/PC/PCPreSolve.html#PCPreSolve">PCPreSolve</a>() is not usually called directly by</font>
<a name="line987">987: </a><font color="#B22222">   the user, but instead is called by <a href="../../../../../docs/manualpages/KSP/KSPSolve.html#KSPSolve">KSPSolve</a>().</font>
<a name="line988">988: </a><font color="#B22222">*/</font>
<a name="line989">989: </a><strong><font color="#4169E1"><a name="PCPreSolve_BDDC"></a>static <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PCPreSolve_BDDC(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> pc, <a href="../../../../../docs/manualpages/KSP/KSP.html#KSP">KSP</a> ksp, <a href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a> rhs, <a href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a> x)</font></strong>
<a name="line990">990: </a>{
<a name="line992">992: </a>  PC_BDDC        *pcbddc = (PC_BDDC*)pc-&gt;data;
<a name="line993">993: </a>  PC_IS          *pcis = (PC_IS*)(pc-&gt;data);
<a name="line994">994: </a>  <a href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a>            used_vec;
<a name="line995">995: </a>  <a href="../../../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a>      copy_rhs = <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;

<a name="line998">998: </a>  <font color="#B22222">/* if we are working with cg, one dirichlet solve can be avoided during Krylov iterations */</font>
<a name="line999">999: </a>  <font color="#4169E1">if</font> (ksp) {
<a name="line1000">1000: </a>    <a href="../../../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a> iscg;
<a name="line1001">1001: </a>    <a href="../../../../../docs/manualpages/Sys/PetscObjectTypeCompare.html#PetscObjectTypeCompare">PetscObjectTypeCompare</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)ksp,<a href="../../../../../docs/manualpages/KSP/KSPCG.html#KSPCG">KSPCG</a>,&amp;iscg);
<a name="line1002">1002: </a>    <font color="#4169E1">if</font> (!iscg) {
<a name="line1003">1003: </a>      PCBDDCSetUseExactDirichlet(pc,<a href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>);
<a name="line1004">1004: </a>    }
<a name="line1005">1005: </a>  }
<a name="line1006">1006: </a>  <font color="#B22222">/* Creates parallel work vectors used in presolve */</font>
<a name="line1007">1007: </a>  <font color="#4169E1">if</font> (!pcbddc-&gt;original_rhs) {
<a name="line1008">1008: </a>    <a href="../../../../../docs/manualpages/Vec/VecDuplicate.html#VecDuplicate">VecDuplicate</a>(pcis-&gt;vec1_global,&amp;pcbddc-&gt;original_rhs);
<a name="line1009">1009: </a>  }
<a name="line1010">1010: </a>  <font color="#4169E1">if</font> (!pcbddc-&gt;temp_solution) {
<a name="line1011">1011: </a>    <a href="../../../../../docs/manualpages/Vec/VecDuplicate.html#VecDuplicate">VecDuplicate</a>(pcis-&gt;vec1_global,&amp;pcbddc-&gt;temp_solution);
<a name="line1012">1012: </a>  }

<a name="line1014">1014: </a>  <font color="#4169E1">if</font> (x) {
<a name="line1015">1015: </a>    <a href="../../../../../docs/manualpages/Sys/PetscObjectReference.html#PetscObjectReference">PetscObjectReference</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)x);
<a name="line1016">1016: </a>    used_vec = x;
<a name="line1017">1017: </a>  } <font color="#4169E1">else</font> { <font color="#B22222">/* it can only happen when calling <a href="../../../../../docs/manualpages/PC/PCBDDCMatFETIDPGetRHS.html#PCBDDCMatFETIDPGetRHS">PCBDDCMatFETIDPGetRHS</a> */</font>
<a name="line1018">1018: </a>    <a href="../../../../../docs/manualpages/Sys/PetscObjectReference.html#PetscObjectReference">PetscObjectReference</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pcbddc-&gt;temp_solution);
<a name="line1019">1019: </a>    used_vec = pcbddc-&gt;temp_solution;
<a name="line1020">1020: </a>    <a href="../../../../../docs/manualpages/Vec/VecSet.html#VecSet">VecSet</a>(used_vec,0.0);
<a name="line1021">1021: </a>  }

<a name="line1023">1023: </a>  <font color="#B22222">/* hack into ksp data structure since <a href="../../../../../docs/manualpages/PC/PCPreSolve.html#PCPreSolve">PCPreSolve</a> comes earlier than setting to zero the guess in src/ksp/ksp/interface/itfunc.c */</font>
<a name="line1024">1024: </a>  <font color="#4169E1">if</font> (ksp) {
<a name="line1025">1025: </a>    <font color="#B22222">/* store the flag for the initial guess since it will be restored back during PCPostSolve_BDDC */</font>
<a name="line1026">1026: </a>    <a href="../../../../../docs/manualpages/KSP/KSPGetInitialGuessNonzero.html#KSPGetInitialGuessNonzero">KSPGetInitialGuessNonzero</a>(ksp,&amp;pcbddc-&gt;ksp_guess_nonzero);
<a name="line1027">1027: </a>    <font color="#4169E1">if</font> (!pcbddc-&gt;ksp_guess_nonzero) {
<a name="line1028">1028: </a>      <a href="../../../../../docs/manualpages/Vec/VecSet.html#VecSet">VecSet</a>(used_vec,0.0);
<a name="line1029">1029: </a>    }
<a name="line1030">1030: </a>  }

<a name="line1032">1032: </a>  pcbddc-&gt;rhs_change = <a href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;

<a name="line1034">1034: </a>  <font color="#B22222">/* Take into account zeroed rows -&gt; change rhs and store solution removed */</font>
<a name="line1035">1035: </a>  <font color="#4169E1">if</font> (rhs) {
<a name="line1036">1036: </a>    <a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a> dirIS = NULL;

<a name="line1038">1038: </a>    <font color="#B22222">/* DirichletBoundariesLocal may not be consistent among neighbours; gets a dirichlet dofs <a href="../../../../../docs/manualpages/IS/IS.html#IS">IS</a> from graph (may be cached) */</font>
<a name="line1039">1039: </a>    PCBDDCGraphGetDirichletDofs(pcbddc-&gt;mat_graph,&amp;dirIS);
<a name="line1040">1040: </a>    <font color="#4169E1">if</font> (dirIS) {
<a name="line1041">1041: </a>      Mat_IS            *matis = (Mat_IS*)pc-&gt;pmat-&gt;data;
<a name="line1042">1042: </a>      <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>          dirsize,i,*is_indices;
<a name="line1043">1043: </a>      <a href="../../../../../docs/manualpages/Sys/PetscScalar.html#PetscScalar">PetscScalar</a>       *array_x;
<a name="line1044">1044: </a>      const <a href="../../../../../docs/manualpages/Sys/PetscScalar.html#PetscScalar">PetscScalar</a> *array_diagonal;

<a name="line1046">1046: </a>      <a href="../../../../../docs/manualpages/Mat/MatGetDiagonal.html#MatGetDiagonal">MatGetDiagonal</a>(pc-&gt;pmat,pcis-&gt;vec1_global);
<a name="line1047">1047: </a>      <a href="../../../../../docs/manualpages/Vec/VecPointwiseDivide.html#VecPointwiseDivide">VecPointwiseDivide</a>(pcis-&gt;vec1_global,rhs,pcis-&gt;vec1_global);
<a name="line1048">1048: </a>      <a href="../../../../../docs/manualpages/Vec/VecScatterBegin.html#VecScatterBegin">VecScatterBegin</a>(matis-&gt;rctx,pcis-&gt;vec1_global,pcis-&gt;vec2_N,<a href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</a>,<a href="../../../../../docs/manualpages/Vec/SCATTER_FORWARD.html#SCATTER_FORWARD">SCATTER_FORWARD</a>);
<a name="line1049">1049: </a>      <a href="../../../../../docs/manualpages/Vec/VecScatterEnd.html#VecScatterEnd">VecScatterEnd</a>(matis-&gt;rctx,pcis-&gt;vec1_global,pcis-&gt;vec2_N,<a href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</a>,<a href="../../../../../docs/manualpages/Vec/SCATTER_FORWARD.html#SCATTER_FORWARD">SCATTER_FORWARD</a>);
<a name="line1050">1050: </a>      <a href="../../../../../docs/manualpages/Vec/VecScatterBegin.html#VecScatterBegin">VecScatterBegin</a>(matis-&gt;rctx,used_vec,pcis-&gt;vec1_N,<a href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</a>,<a href="../../../../../docs/manualpages/Vec/SCATTER_FORWARD.html#SCATTER_FORWARD">SCATTER_FORWARD</a>);
<a name="line1051">1051: </a>      <a href="../../../../../docs/manualpages/Vec/VecScatterEnd.html#VecScatterEnd">VecScatterEnd</a>(matis-&gt;rctx,used_vec,pcis-&gt;vec1_N,<a href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</a>,<a href="../../../../../docs/manualpages/Vec/SCATTER_FORWARD.html#SCATTER_FORWARD">SCATTER_FORWARD</a>);
<a name="line1052">1052: </a>      <a href="../../../../../docs/manualpages/IS/ISGetLocalSize.html#ISGetLocalSize">ISGetLocalSize</a>(dirIS,&amp;dirsize);
<a name="line1053">1053: </a>      <a href="../../../../../docs/manualpages/Vec/VecGetArray.html#VecGetArray">VecGetArray</a>(pcis-&gt;vec1_N,&amp;array_x);
<a name="line1054">1054: </a>      <a href="../../../../../docs/manualpages/Vec/VecGetArrayRead.html#VecGetArrayRead">VecGetArrayRead</a>(pcis-&gt;vec2_N,&amp;array_diagonal);
<a name="line1055">1055: </a>      <a href="../../../../../docs/manualpages/IS/ISGetIndices.html#ISGetIndices">ISGetIndices</a>(dirIS,(const <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>**)&amp;is_indices);
<a name="line1056">1056: </a>      <font color="#4169E1">for</font> (i=0; i&lt;dirsize; i++) array_x[is_indices[i]] = array_diagonal[is_indices[i]];
<a name="line1057">1057: </a>      <a href="../../../../../docs/manualpages/IS/ISRestoreIndices.html#ISRestoreIndices">ISRestoreIndices</a>(dirIS,(const <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>**)&amp;is_indices);
<a name="line1058">1058: </a>      <a href="../../../../../docs/manualpages/Vec/VecRestoreArrayRead.html#VecRestoreArrayRead">VecRestoreArrayRead</a>(pcis-&gt;vec2_N,&amp;array_diagonal);
<a name="line1059">1059: </a>      <a href="../../../../../docs/manualpages/Vec/VecRestoreArray.html#VecRestoreArray">VecRestoreArray</a>(pcis-&gt;vec1_N,&amp;array_x);
<a name="line1060">1060: </a>      <a href="../../../../../docs/manualpages/Vec/VecScatterBegin.html#VecScatterBegin">VecScatterBegin</a>(matis-&gt;rctx,pcis-&gt;vec1_N,used_vec,<a href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</a>,<a href="../../../../../docs/manualpages/Vec/SCATTER_REVERSE.html#SCATTER_REVERSE">SCATTER_REVERSE</a>);
<a name="line1061">1061: </a>      <a href="../../../../../docs/manualpages/Vec/VecScatterEnd.html#VecScatterEnd">VecScatterEnd</a>(matis-&gt;rctx,pcis-&gt;vec1_N,used_vec,<a href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</a>,<a href="../../../../../docs/manualpages/Vec/SCATTER_REVERSE.html#SCATTER_REVERSE">SCATTER_REVERSE</a>);
<a name="line1062">1062: </a>      pcbddc-&gt;rhs_change = <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line1063">1063: </a>      <a href="../../../../../docs/manualpages/IS/ISDestroy.html#ISDestroy">ISDestroy</a>(&amp;dirIS);
<a name="line1064">1064: </a>    }
<a name="line1065">1065: </a>  }

<a name="line1067">1067: </a>  <font color="#B22222">/* remove the computed solution or the initial guess from the rhs */</font>
<a name="line1068">1068: </a>  <font color="#4169E1">if</font> (pcbddc-&gt;rhs_change || (ksp &amp;&amp; pcbddc-&gt;ksp_guess_nonzero) ) {
<a name="line1069">1069: </a>    <font color="#B22222">/* store the original rhs */</font>
<a name="line1070">1070: </a>    <font color="#4169E1">if</font> (copy_rhs) {
<a name="line1071">1071: </a>      <a href="../../../../../docs/manualpages/Vec/VecCopy.html#VecCopy">VecCopy</a>(rhs,pcbddc-&gt;original_rhs);
<a name="line1072">1072: </a>      copy_rhs = <a href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line1073">1073: </a>    }
<a name="line1074">1074: </a>    pcbddc-&gt;rhs_change = <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line1075">1075: </a>    <a href="../../../../../docs/manualpages/Vec/VecScale.html#VecScale">VecScale</a>(used_vec,-1.0);
<a name="line1076">1076: </a>    <a href="../../../../../docs/manualpages/Mat/MatMultAdd.html#MatMultAdd">MatMultAdd</a>(pc-&gt;pmat,used_vec,rhs,rhs);
<a name="line1077">1077: </a>    <a href="../../../../../docs/manualpages/Vec/VecScale.html#VecScale">VecScale</a>(used_vec,-1.0);
<a name="line1078">1078: </a>    <a href="../../../../../docs/manualpages/Vec/VecCopy.html#VecCopy">VecCopy</a>(used_vec,pcbddc-&gt;temp_solution);
<a name="line1079">1079: </a>    <font color="#4169E1">if</font> (ksp) {
<a name="line1080">1080: </a>      <a href="../../../../../docs/manualpages/KSP/KSPSetInitialGuessNonzero.html#KSPSetInitialGuessNonzero">KSPSetInitialGuessNonzero</a>(ksp,<a href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>);
<a name="line1081">1081: </a>    }
<a name="line1082">1082: </a>  }
<a name="line1083">1083: </a>  <a href="../../../../../docs/manualpages/Vec/VecDestroy.html#VecDestroy">VecDestroy</a>(&amp;used_vec);

<a name="line1085">1085: </a>  <font color="#B22222">/* store partially computed solution and set initial guess */</font>
<a name="line1086">1086: </a>  <font color="#4169E1">if</font> (x &amp;&amp; pcbddc-&gt;use_exact_dirichlet_trick) {
<a name="line1087">1087: </a>    <a href="../../../../../docs/manualpages/Vec/VecSet.html#VecSet">VecSet</a>(x,0.0);
<a name="line1088">1088: </a>    <a href="../../../../../docs/manualpages/Vec/VecScatterBegin.html#VecScatterBegin">VecScatterBegin</a>(pcis-&gt;global_to_D,rhs,pcis-&gt;vec1_D,<a href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</a>,<a href="../../../../../docs/manualpages/Vec/SCATTER_FORWARD.html#SCATTER_FORWARD">SCATTER_FORWARD</a>);
<a name="line1089">1089: </a>    <a href="../../../../../docs/manualpages/Vec/VecScatterEnd.html#VecScatterEnd">VecScatterEnd</a>(pcis-&gt;global_to_D,rhs,pcis-&gt;vec1_D,<a href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</a>,<a href="../../../../../docs/manualpages/Vec/SCATTER_FORWARD.html#SCATTER_FORWARD">SCATTER_FORWARD</a>);
<a name="line1090">1090: </a>    <a href="../../../../../docs/manualpages/KSP/KSPSolve.html#KSPSolve">KSPSolve</a>(pcbddc-&gt;ksp_D,pcis-&gt;vec1_D,pcis-&gt;vec2_D);
<a name="line1091">1091: </a>    <a href="../../../../../docs/manualpages/Vec/VecScatterBegin.html#VecScatterBegin">VecScatterBegin</a>(pcis-&gt;global_to_D,pcis-&gt;vec2_D,x,<a href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</a>,<a href="../../../../../docs/manualpages/Vec/SCATTER_REVERSE.html#SCATTER_REVERSE">SCATTER_REVERSE</a>);
<a name="line1092">1092: </a>    <a href="../../../../../docs/manualpages/Vec/VecScatterEnd.html#VecScatterEnd">VecScatterEnd</a>(pcis-&gt;global_to_D,pcis-&gt;vec2_D,x,<a href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</a>,<a href="../../../../../docs/manualpages/Vec/SCATTER_REVERSE.html#SCATTER_REVERSE">SCATTER_REVERSE</a>);
<a name="line1093">1093: </a>    <font color="#4169E1">if</font> (ksp) {
<a name="line1094">1094: </a>      <a href="../../../../../docs/manualpages/KSP/KSPSetInitialGuessNonzero.html#KSPSetInitialGuessNonzero">KSPSetInitialGuessNonzero</a>(ksp,<a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>);
<a name="line1095">1095: </a>    }
<a name="line1096">1096: </a>  }

<a name="line1098">1098: </a>  <font color="#4169E1">if</font> (pcbddc-&gt;ChangeOfBasisMatrix) {
<a name="line1099">1099: </a>    PCBDDCChange_ctx change_ctx;

<a name="line1101">1101: </a>    <font color="#B22222">/* get change ctx */</font>
<a name="line1102">1102: </a>    <a href="../../../../../docs/manualpages/Mat/MatShellGetContext.html#MatShellGetContext">MatShellGetContext</a>(pcbddc-&gt;new_global_mat,&amp;change_ctx);

<a name="line1104">1104: </a>    <font color="#B22222">/* set current iteration matrix inside change context (change of basis has been already set into the ctx during <a href="../../../../../docs/manualpages/PC/PCSetUp.html#PCSetUp">PCSetUp</a>) */</font>
<a name="line1105">1105: </a>    <a href="../../../../../docs/manualpages/Mat/MatDestroy.html#MatDestroy">MatDestroy</a>(&amp;change_ctx-&gt;original_mat);
<a name="line1106">1106: </a>    <a href="../../../../../docs/manualpages/Sys/PetscObjectReference.html#PetscObjectReference">PetscObjectReference</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc-&gt;mat);
<a name="line1107">1107: </a>    change_ctx-&gt;original_mat = pc-&gt;mat;

<a name="line1109">1109: </a>    <font color="#B22222">/* change iteration matrix */</font>
<a name="line1110">1110: </a>    <a href="../../../../../docs/manualpages/Mat/MatDestroy.html#MatDestroy">MatDestroy</a>(&amp;pc-&gt;mat);
<a name="line1111">1111: </a>    <a href="../../../../../docs/manualpages/Sys/PetscObjectReference.html#PetscObjectReference">PetscObjectReference</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pcbddc-&gt;new_global_mat);
<a name="line1112">1112: </a>    pc-&gt;mat = pcbddc-&gt;new_global_mat;

<a name="line1114">1114: </a>    <font color="#B22222">/* store the original rhs */</font>
<a name="line1115">1115: </a>    <font color="#4169E1">if</font> (copy_rhs) {
<a name="line1116">1116: </a>      <a href="../../../../../docs/manualpages/Vec/VecCopy.html#VecCopy">VecCopy</a>(rhs,pcbddc-&gt;original_rhs);
<a name="line1117">1117: </a>      copy_rhs = <a href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line1118">1118: </a>    }

<a name="line1120">1120: </a>    <font color="#B22222">/* change rhs */</font>
<a name="line1121">1121: </a>    <a href="../../../../../docs/manualpages/Mat/MatMultTranspose.html#MatMultTranspose">MatMultTranspose</a>(change_ctx-&gt;global_change,rhs,pcis-&gt;vec1_global);
<a name="line1122">1122: </a>    <a href="../../../../../docs/manualpages/Vec/VecCopy.html#VecCopy">VecCopy</a>(pcis-&gt;vec1_global,rhs);
<a name="line1123">1123: </a>    pcbddc-&gt;rhs_change = <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line1124">1124: </a>  }

<a name="line1126">1126: </a>  <font color="#B22222">/* remove nullspace if present */</font>
<a name="line1127">1127: </a>  <font color="#4169E1">if</font> (ksp &amp;&amp; x &amp;&amp; pcbddc-&gt;NullSpace) {
<a name="line1128">1128: </a>    <a href="../../../../../docs/manualpages/Mat/MatNullSpaceRemove.html#MatNullSpaceRemove">MatNullSpaceRemove</a>(pcbddc-&gt;NullSpace,x);
<a name="line1129">1129: </a>    <font color="#B22222">/* store the original rhs */</font>
<a name="line1130">1130: </a>    <font color="#4169E1">if</font> (copy_rhs) {
<a name="line1131">1131: </a>      <a href="../../../../../docs/manualpages/Vec/VecCopy.html#VecCopy">VecCopy</a>(rhs,pcbddc-&gt;original_rhs);
<a name="line1132">1132: </a>    }
<a name="line1133">1133: </a>    pcbddc-&gt;rhs_change = <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line1134">1134: </a>    <a href="../../../../../docs/manualpages/Mat/MatNullSpaceRemove.html#MatNullSpaceRemove">MatNullSpaceRemove</a>(pcbddc-&gt;NullSpace,rhs);
<a name="line1135">1135: </a>  }
<a name="line1136">1136: </a>  <font color="#4169E1">return</font>(0);
<a name="line1137">1137: </a>}

<a name="line1139">1139: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>
<a name="line1142">1142: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>
<a name="line1143">1143: </a><font color="#B22222">/*</font>
<a name="line1144">1144: </a><font color="#B22222">   PCPostSolve_BDDC - Changes the computed solution if a transformation of basis</font>
<a name="line1145">1145: </a><font color="#B22222">                     approach has been selected. Also, restores rhs to its original state.</font>

<a name="line1147">1147: </a><font color="#B22222">   Input Parameter:</font>
<a name="line1148">1148: </a><font color="#B22222">+  pc - the preconditioner contex</font>

<a name="line1150">1150: </a><font color="#B22222">   Application Interface Routine: <a href="../../../../../docs/manualpages/PC/PCPostSolve.html#PCPostSolve">PCPostSolve</a>()</font>

<a name="line1152">1152: </a><font color="#B22222">   Notes:</font>
<a name="line1153">1153: </a><font color="#B22222">     The interface routine <a href="../../../../../docs/manualpages/PC/PCPostSolve.html#PCPostSolve">PCPostSolve</a>() is not usually called directly by</font>
<a name="line1154">1154: </a><font color="#B22222">     the user, but instead is called by <a href="../../../../../docs/manualpages/KSP/KSPSolve.html#KSPSolve">KSPSolve</a>().</font>
<a name="line1155">1155: </a><font color="#B22222">*/</font>
<a name="line1156">1156: </a><strong><font color="#4169E1"><a name="PCPostSolve_BDDC"></a>static <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PCPostSolve_BDDC(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> pc, <a href="../../../../../docs/manualpages/KSP/KSP.html#KSP">KSP</a> ksp, <a href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a> rhs, <a href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a> x)</font></strong>
<a name="line1157">1157: </a>{
<a name="line1159">1159: </a>  PC_BDDC        *pcbddc = (PC_BDDC*)pc-&gt;data;

<a name="line1162">1162: </a>  <font color="#4169E1">if</font> (pcbddc-&gt;ChangeOfBasisMatrix) {
<a name="line1163">1163: </a>    PCBDDCChange_ctx change_ctx;

<a name="line1165">1165: </a>    <font color="#B22222">/* get change ctx */</font>
<a name="line1166">1166: </a>    <a href="../../../../../docs/manualpages/Mat/MatShellGetContext.html#MatShellGetContext">MatShellGetContext</a>(pcbddc-&gt;new_global_mat,&amp;change_ctx);

<a name="line1168">1168: </a>    <font color="#B22222">/* restore iteration matrix */</font>
<a name="line1169">1169: </a>    <a href="../../../../../docs/manualpages/Mat/MatDestroy.html#MatDestroy">MatDestroy</a>(&amp;pc-&gt;mat);
<a name="line1170">1170: </a>    <a href="../../../../../docs/manualpages/Sys/PetscObjectReference.html#PetscObjectReference">PetscObjectReference</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)change_ctx-&gt;original_mat);
<a name="line1171">1171: </a>    pc-&gt;mat = change_ctx-&gt;original_mat;

<a name="line1173">1173: </a>    <font color="#B22222">/* get solution in original basis */</font>
<a name="line1174">1174: </a>    <font color="#4169E1">if</font> (x) {
<a name="line1175">1175: </a>      PC_IS *pcis = (PC_IS*)(pc-&gt;data);
<a name="line1176">1176: </a>      <a href="../../../../../docs/manualpages/Mat/MatMult.html#MatMult">MatMult</a>(change_ctx-&gt;global_change,x,pcis-&gt;vec1_global);
<a name="line1177">1177: </a>      <a href="../../../../../docs/manualpages/Vec/VecCopy.html#VecCopy">VecCopy</a>(pcis-&gt;vec1_global,x);
<a name="line1178">1178: </a>    }
<a name="line1179">1179: </a>  }

<a name="line1181">1181: </a>  <font color="#B22222">/* add solution removed in presolve */</font>
<a name="line1182">1182: </a>  <font color="#4169E1">if</font> (x &amp;&amp; pcbddc-&gt;rhs_change) {
<a name="line1183">1183: </a>    <a href="../../../../../docs/manualpages/Vec/VecAXPY.html#VecAXPY">VecAXPY</a>(x,1.0,pcbddc-&gt;temp_solution);
<a name="line1184">1184: </a>  }

<a name="line1186">1186: </a>  <font color="#B22222">/* restore rhs to its original state */</font>
<a name="line1187">1187: </a>  <font color="#4169E1">if</font> (rhs &amp;&amp; pcbddc-&gt;rhs_change) {
<a name="line1188">1188: </a>    <a href="../../../../../docs/manualpages/Vec/VecCopy.html#VecCopy">VecCopy</a>(pcbddc-&gt;original_rhs,rhs);
<a name="line1189">1189: </a>  }
<a name="line1190">1190: </a>  pcbddc-&gt;rhs_change = <a href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;

<a name="line1192">1192: </a>  <font color="#B22222">/* restore ksp guess state */</font>
<a name="line1193">1193: </a>  <font color="#4169E1">if</font> (ksp) {
<a name="line1194">1194: </a>    <a href="../../../../../docs/manualpages/KSP/KSPSetInitialGuessNonzero.html#KSPSetInitialGuessNonzero">KSPSetInitialGuessNonzero</a>(ksp,pcbddc-&gt;ksp_guess_nonzero);
<a name="line1195">1195: </a>  }
<a name="line1196">1196: </a>  <font color="#4169E1">return</font>(0);
<a name="line1197">1197: </a>}
<a name="line1198">1198: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>
<a name="line1201">1201: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>
<a name="line1202">1202: </a><font color="#B22222">/*</font>
<a name="line1203">1203: </a><font color="#B22222">   PCSetUp_BDDC - Prepares for the use of the BDDC preconditioner</font>
<a name="line1204">1204: </a><font color="#B22222">                  by setting data structures and options.</font>

<a name="line1206">1206: </a><font color="#B22222">   Input Parameter:</font>
<a name="line1207">1207: </a><font color="#B22222">+  pc - the preconditioner context</font>

<a name="line1209">1209: </a><font color="#B22222">   Application Interface Routine: <a href="../../../../../docs/manualpages/PC/PCSetUp.html#PCSetUp">PCSetUp</a>()</font>

<a name="line1211">1211: </a><font color="#B22222">   Notes:</font>
<a name="line1212">1212: </a><font color="#B22222">     The interface routine <a href="../../../../../docs/manualpages/PC/PCSetUp.html#PCSetUp">PCSetUp</a>() is not usually called directly by</font>
<a name="line1213">1213: </a><font color="#B22222">     the user, but instead is called by <a href="../../../../../docs/manualpages/PC/PCApply.html#PCApply">PCApply</a>() if necessary.</font>
<a name="line1214">1214: </a><font color="#B22222">*/</font>
<a name="line1215">1215: </a><strong><font color="#4169E1"><a name="PCSetUp_BDDC"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PCSetUp_BDDC(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> pc)</font></strong>
<a name="line1216">1216: </a>{
<a name="line1218">1218: </a>  PC_BDDC*       pcbddc = (PC_BDDC*)pc-&gt;data;
<a name="line1219">1219: </a>  Mat_IS*        matis;
<a name="line1220">1220: </a>  <a href="../../../../../docs/manualpages/Mat/MatNullSpace.html#MatNullSpace">MatNullSpace</a>   nearnullspace;
<a name="line1221">1221: </a>  <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>       nrows,ncols;
<a name="line1222">1222: </a>  <a href="../../../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a>      computetopography,computesolvers,computesubschurs;
<a name="line1223">1223: </a>  <a href="../../../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a>      computeconstraintsmatrix;
<a name="line1224">1224: </a>  <a href="../../../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a>      new_nearnullspace_provided,ismatis;

<a name="line1227">1227: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectTypeCompare.html#PetscObjectTypeCompare">PetscObjectTypeCompare</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc-&gt;pmat,<a href="../../../../../docs/manualpages/Mat/MATIS.html#MATIS">MATIS</a>,&amp;ismatis);
<a name="line1228">1228: </a>  <font color="#4169E1">if</font> (!ismatis) <a href="../../../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</a>(<a href="../../../../../docs/manualpages/Sys/PetscObjectComm.html#PetscObjectComm">PetscObjectComm</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc),PETSC_ERR_ARG_WRONG,<font color="#666666">"<a href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</a> preconditioner requires matrix of type <a href="../../../../../docs/manualpages/Mat/MATIS.html#MATIS">MATIS</a>"</font>);
<a name="line1229">1229: </a>  <a href="../../../../../docs/manualpages/Mat/MatGetSize.html#MatGetSize">MatGetSize</a>(pc-&gt;pmat,&amp;nrows,&amp;ncols);
<a name="line1230">1230: </a>  <font color="#4169E1">if</font> (nrows != ncols) <a href="../../../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</a>(<a href="../../../../../docs/manualpages/Sys/PetscObjectComm.html#PetscObjectComm">PetscObjectComm</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc),PETSC_ERR_SUP,<font color="#666666">"<a href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</a> preconditioner requires a square preconditioning matrix"</font>);
<a name="line1231">1231: </a>  matis = (Mat_IS*)pc-&gt;pmat-&gt;data;
<a name="line1232">1232: </a>  <font color="#B22222">/* the following lines of code should be replaced by a better logic between PCIS, <a href="../../../../../docs/manualpages/PC/PCNN.html#PCNN">PCNN</a>, <a href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</a> and other future nonoverlapping preconditioners */</font>
<a name="line1233">1233: </a>  <font color="#B22222">/* For BDDC we need to define a local "Neumann" problem different to that defined in PCISSetup</font>
<a name="line1234">1234: </a><font color="#B22222">     Also, BDDC directly build the Dirichlet problem */</font>
<a name="line1235">1235: </a>  <font color="#B22222">/* split work */</font>
<a name="line1236">1236: </a>  <font color="#4169E1">if</font> (pc-&gt;setupcalled) {
<a name="line1237">1237: </a>    <font color="#4169E1">if</font> (pc-&gt;flag == SAME_NONZERO_PATTERN) {
<a name="line1238">1238: </a>      computetopography = <a href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line1239">1239: </a>      computesolvers = <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line1240">1240: </a>    } <font color="#4169E1">else</font> { <font color="#B22222">/* DIFFERENT_NONZERO_PATTERN */</font>
<a name="line1241">1241: </a>      computetopography = <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line1242">1242: </a>      computesolvers = <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line1243">1243: </a>    }
<a name="line1244">1244: </a>  } <font color="#4169E1">else</font> {
<a name="line1245">1245: </a>    computetopography = <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line1246">1246: </a>    computesolvers = <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line1247">1247: </a>  }
<a name="line1248">1248: </a>  <font color="#4169E1">if</font> (pcbddc-&gt;recompute_topography) {
<a name="line1249">1249: </a>    computetopography = <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line1250">1250: </a>  }
<a name="line1251">1251: </a>  computeconstraintsmatrix = <a href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line1252">1252: </a>  <font color="#4169E1">if</font> (pcbddc-&gt;adaptive_threshold &gt; 0.0 &amp;&amp; !pcbddc-&gt;use_deluxe_scaling) <a href="../../../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</a>(<a href="../../../../../docs/manualpages/Sys/PetscObjectComm.html#PetscObjectComm">PetscObjectComm</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc),PETSC_ERR_SUP,<font color="#666666">"Cannot compute adaptive constraints without deluxe scaling. Rerun with -pc_bddc_use_deluxe_scaling"</font>);
<a name="line1253">1253: </a>  pcbddc-&gt;adaptive_selection = (<a href="../../../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a>)(pcbddc-&gt;adaptive_threshold &gt; 0.0 &amp;&amp; pcbddc-&gt;use_deluxe_scaling);
<a name="line1254">1254: </a>  <font color="#4169E1">if</font> (pcbddc-&gt;adaptive_selection) pcbddc-&gt;use_faces = <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;

<a name="line1256">1256: </a>  computesubschurs = (<a href="../../../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a>)(pcbddc-&gt;adaptive_selection || pcbddc-&gt;use_deluxe_scaling);
<a name="line1257">1257: </a>  <font color="#4169E1">if</font> (pcbddc-&gt;faster_deluxe &amp;&amp; pcbddc-&gt;adaptive_selection &amp;&amp; pcbddc-&gt;use_change_of_basis) <a href="../../../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</a>(<a href="../../../../../docs/manualpages/Sys/PetscObjectComm.html#PetscObjectComm">PetscObjectComm</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc),PETSC_ERR_SUP,<font color="#666666">"Cannot compute faster deluxe if adaptivity and change of basis are both requested. Rerun with -pc_bddc_deluxe_faster false"</font>);

<a name="line1259">1259: </a>  <font color="#B22222">/* Get stdout for dbg */</font>
<a name="line1260">1260: </a>  <font color="#4169E1">if</font> (pcbddc-&gt;dbg_flag) {
<a name="line1261">1261: </a>    <font color="#4169E1">if</font> (!pcbddc-&gt;dbg_viewer) {
<a name="line1262">1262: </a>      pcbddc-&gt;dbg_viewer = <a href="../../../../../docs/manualpages/Viewer/PETSC_VIEWER_STDOUT_.html#PETSC_VIEWER_STDOUT_">PETSC_VIEWER_STDOUT_</a>(<a href="../../../../../docs/manualpages/Sys/PetscObjectComm.html#PetscObjectComm">PetscObjectComm</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc));
<a name="line1263">1263: </a>      <a href="../../../../../docs/manualpages/Viewer/PetscViewerASCIIPushSynchronized.html#PetscViewerASCIIPushSynchronized">PetscViewerASCIIPushSynchronized</a>(pcbddc-&gt;dbg_viewer);
<a name="line1264">1264: </a>    }
<a name="line1265">1265: </a>    <a href="../../../../../docs/manualpages/Viewer/PetscViewerASCIIAddTab.html#PetscViewerASCIIAddTab">PetscViewerASCIIAddTab</a>(pcbddc-&gt;dbg_viewer,2*pcbddc-&gt;current_level);
<a name="line1266">1266: </a>  }

<a name="line1268">1268: </a>  <font color="#4169E1">if</font> (pcbddc-&gt;user_ChangeOfBasisMatrix) {
<a name="line1269">1269: </a>    <font color="#B22222">/* use_change_of_basis flag is used to automatically compute a change of basis from constraints */</font>
<a name="line1270">1270: </a>    pcbddc-&gt;use_change_of_basis = <a href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line1271">1271: </a>    PCBDDCComputeLocalMatrix(pc,pcbddc-&gt;user_ChangeOfBasisMatrix);
<a name="line1272">1272: </a>  } <font color="#4169E1">else</font> {
<a name="line1273">1273: </a>    <a href="../../../../../docs/manualpages/Mat/MatDestroy.html#MatDestroy">MatDestroy</a>(&amp;pcbddc-&gt;local_mat);
<a name="line1274">1274: </a>    <a href="../../../../../docs/manualpages/Sys/PetscObjectReference.html#PetscObjectReference">PetscObjectReference</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)matis-&gt;A);
<a name="line1275">1275: </a>    pcbddc-&gt;local_mat = matis-&gt;A;
<a name="line1276">1276: </a>  }

<a name="line1278">1278: </a>  <font color="#B22222">/* workaround for reals */</font>
<a name="line1279">1279: </a><font color="#A020F0">#if !defined(PETSC_USE_COMPLEX)</font>
<a name="line1280">1280: </a>  <font color="#4169E1">if</font> (matis-&gt;A-&gt;symmetric_set) {
<a name="line1281">1281: </a>    <a href="../../../../../docs/manualpages/Mat/MatSetOption.html#MatSetOption">MatSetOption</a>(pcbddc-&gt;local_mat,MAT_HERMITIAN,matis-&gt;A-&gt;symmetric);
<a name="line1282">1282: </a>  }
<a name="line1283">1283: </a><font color="#A020F0">#endif</font>

<a name="line1285">1285: </a>  <font color="#B22222">/* Set up all the "iterative substructuring" common block without computing solvers */</font>
<a name="line1286">1286: </a>  {
<a name="line1287">1287: </a>    <a href="../../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</a> temp_mat;

<a name="line1289">1289: </a>    temp_mat = matis-&gt;A;
<a name="line1290">1290: </a>    matis-&gt;A = pcbddc-&gt;local_mat;
<a name="line1291">1291: </a>    PCISSetUp(pc,<a href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>);
<a name="line1292">1292: </a>    pcbddc-&gt;local_mat = matis-&gt;A;
<a name="line1293">1293: </a>    matis-&gt;A = temp_mat;
<a name="line1294">1294: </a>  }

<a name="line1296">1296: </a>  <font color="#B22222">/* Analyze interface and setup sub_schurs data */</font>
<a name="line1297">1297: </a>  <font color="#4169E1">if</font> (computetopography) {
<a name="line1298">1298: </a>    PCBDDCAnalyzeInterface(pc);
<a name="line1299">1299: </a>    computeconstraintsmatrix = <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line1300">1300: </a>  }

<a name="line1302">1302: </a>  <font color="#B22222">/* Setup local dirichlet solver ksp_D and sub_schurs solvers */</font>
<a name="line1303">1303: </a>  <font color="#4169E1">if</font> (computesolvers) {
<a name="line1304">1304: </a>    PCBDDCSubSchurs sub_schurs=pcbddc-&gt;sub_schurs;

<a name="line1306">1306: </a>    <font color="#4169E1">if</font> (computesubschurs &amp;&amp; computetopography) {
<a name="line1307">1307: </a>      PCBDDCInitSubSchurs(pc);
<a name="line1308">1308: </a>    }
<a name="line1309">1309: </a>    <font color="#4169E1">if</font> (sub_schurs-&gt;use_mumps) {
<a name="line1310">1310: </a>      <font color="#4169E1">if</font> (computesubschurs) {
<a name="line1311">1311: </a>        PCBDDCSetUpSubSchurs(pc);
<a name="line1312">1312: </a>      }
<a name="line1313">1313: </a>      PCBDDCSetUpLocalSolvers(pc,<a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>,<a href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>);
<a name="line1314">1314: </a>    } <font color="#4169E1">else</font> {
<a name="line1315">1315: </a>      PCBDDCSetUpLocalSolvers(pc,<a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>,<a href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>);
<a name="line1316">1316: </a>      <font color="#4169E1">if</font> (computesubschurs) {
<a name="line1317">1317: </a>        PCBDDCSetUpSubSchurs(pc);
<a name="line1318">1318: </a>      }
<a name="line1319">1319: </a>    }
<a name="line1320">1320: </a>    <font color="#4169E1">if</font> (pcbddc-&gt;adaptive_selection) {
<a name="line1321">1321: </a>      PCBDDCAdaptiveSelection(pc);
<a name="line1322">1322: </a>      computeconstraintsmatrix = <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line1323">1323: </a>    }
<a name="line1324">1324: </a>  }

<a name="line1326">1326: </a>  <font color="#B22222">/* infer if NullSpace object attached to <a href="../../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</a> via <a href="../../../../../docs/manualpages/Mat/MatSetNearNullSpace.html#MatSetNearNullSpace">MatSetNearNullSpace</a> has changed */</font>
<a name="line1327">1327: </a>  new_nearnullspace_provided = <a href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line1328">1328: </a>  <a href="../../../../../docs/manualpages/Mat/MatGetNearNullSpace.html#MatGetNearNullSpace">MatGetNearNullSpace</a>(pc-&gt;pmat,&amp;nearnullspace);
<a name="line1329">1329: </a>  <font color="#4169E1">if</font> (pcbddc-&gt;onearnullspace) { <font color="#B22222">/* already used nearnullspace */</font>
<a name="line1330">1330: </a>    <font color="#4169E1">if</font> (!nearnullspace) { <font color="#B22222">/* near null space attached to mat has been destroyed */</font>
<a name="line1331">1331: </a>      new_nearnullspace_provided = <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line1332">1332: </a>    } <font color="#4169E1">else</font> {
<a name="line1333">1333: </a>      <font color="#B22222">/* determine if the two nullspaces are different (should be lightweight) */</font>
<a name="line1334">1334: </a>      <font color="#4169E1">if</font> (nearnullspace != pcbddc-&gt;onearnullspace) {
<a name="line1335">1335: </a>        new_nearnullspace_provided = <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line1336">1336: </a>      } <font color="#4169E1">else</font> { <font color="#B22222">/* maybe the user has changed the content of the nearnullspace so check vectors ObjectStateId */</font>
<a name="line1337">1337: </a>        <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>         i;
<a name="line1338">1338: </a>        const <a href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a>        *nearnullvecs;
<a name="line1339">1339: </a>        <a href="../../../../../docs/manualpages/Sys/PetscObjectState.html#PetscObjectState">PetscObjectState</a> state;
<a name="line1340">1340: </a>        <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>         nnsp_size;
<a name="line1341">1341: </a>        <a href="../../../../../docs/manualpages/Mat/MatNullSpaceGetVecs.html#MatNullSpaceGetVecs">MatNullSpaceGetVecs</a>(nearnullspace,NULL,&amp;nnsp_size,&amp;nearnullvecs);
<a name="line1342">1342: </a>        <font color="#4169E1">for</font> (i=0;i&lt;nnsp_size;i++) {
<a name="line1343">1343: </a>          <a href="../../../../../docs/manualpages/Sys/PetscObjectStateGet.html#PetscObjectStateGet">PetscObjectStateGet</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)nearnullvecs[i],&amp;state);
<a name="line1344">1344: </a>          <font color="#4169E1">if</font> (pcbddc-&gt;onearnullvecs_state[i] != state) {
<a name="line1345">1345: </a>            new_nearnullspace_provided = <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line1346">1346: </a>            <font color="#4169E1">break</font>;
<a name="line1347">1347: </a>          }
<a name="line1348">1348: </a>        }
<a name="line1349">1349: </a>      }
<a name="line1350">1350: </a>    }
<a name="line1351">1351: </a>  } <font color="#4169E1">else</font> {
<a name="line1352">1352: </a>    <font color="#4169E1">if</font> (!nearnullspace) { <font color="#B22222">/* both nearnullspaces are null */</font>
<a name="line1353">1353: </a>      new_nearnullspace_provided = <a href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line1354">1354: </a>    } <font color="#4169E1">else</font> { <font color="#B22222">/* nearnullspace attached later */</font>
<a name="line1355">1355: </a>      new_nearnullspace_provided = <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line1356">1356: </a>    }
<a name="line1357">1357: </a>  }

<a name="line1359">1359: </a>  <font color="#B22222">/* Setup constraints and related work vectors */</font>
<a name="line1360">1360: </a>  <font color="#B22222">/* reset primal space flags */</font>
<a name="line1361">1361: </a>  pcbddc-&gt;new_primal_space = <a href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line1362">1362: </a>  pcbddc-&gt;new_primal_space_local = <a href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line1363">1363: </a>  <font color="#4169E1">if</font> (computeconstraintsmatrix || new_nearnullspace_provided) {
<a name="line1364">1364: </a>    <font color="#B22222">/* It also sets the primal space flags */</font>
<a name="line1365">1365: </a>    PCBDDCConstraintsSetUp(pc);
<a name="line1366">1366: </a>    <font color="#B22222">/* Allocate needed local vectors (which depends on quantities defined during ConstraintsSetUp) */</font>
<a name="line1367">1367: </a>    PCBDDCSetUpLocalWorkVectors(pc);
<a name="line1368">1368: </a>  }

<a name="line1370">1370: </a>  <font color="#4169E1">if</font> (computesolvers || pcbddc-&gt;new_primal_space) {
<a name="line1371">1371: </a>    <font color="#4169E1">if</font> (pcbddc-&gt;use_change_of_basis) {
<a name="line1372">1372: </a>      PC_IS *pcis = (PC_IS*)(pc-&gt;data);

<a name="line1374">1374: </a>      PCBDDCComputeLocalMatrix(pc,pcbddc-&gt;ChangeOfBasisMatrix);
<a name="line1375">1375: </a>      <font color="#B22222">/* get submatrices */</font>
<a name="line1376">1376: </a>      <a href="../../../../../docs/manualpages/Mat/MatDestroy.html#MatDestroy">MatDestroy</a>(&amp;pcis-&gt;A_IB);
<a name="line1377">1377: </a>      <a href="../../../../../docs/manualpages/Mat/MatDestroy.html#MatDestroy">MatDestroy</a>(&amp;pcis-&gt;A_BI);
<a name="line1378">1378: </a>      <a href="../../../../../docs/manualpages/Mat/MatDestroy.html#MatDestroy">MatDestroy</a>(&amp;pcis-&gt;A_BB);
<a name="line1379">1379: </a>      <a href="../../../../../docs/manualpages/Mat/MatGetSubMatrix.html#MatGetSubMatrix">MatGetSubMatrix</a>(pcbddc-&gt;local_mat,pcis-&gt;is_B_local,pcis-&gt;is_B_local,MAT_INITIAL_MATRIX,&amp;pcis-&gt;A_BB);
<a name="line1380">1380: </a>      <a href="../../../../../docs/manualpages/Mat/MatGetSubMatrix.html#MatGetSubMatrix">MatGetSubMatrix</a>(pcbddc-&gt;local_mat,pcis-&gt;is_I_local,pcis-&gt;is_B_local,MAT_INITIAL_MATRIX,&amp;pcis-&gt;A_IB);
<a name="line1381">1381: </a>      <a href="../../../../../docs/manualpages/Mat/MatGetSubMatrix.html#MatGetSubMatrix">MatGetSubMatrix</a>(pcbddc-&gt;local_mat,pcis-&gt;is_B_local,pcis-&gt;is_I_local,MAT_INITIAL_MATRIX,&amp;pcis-&gt;A_BI);
<a name="line1382">1382: </a>      <font color="#B22222">/* set flag in pcis to not reuse submatrices during PCISCreate */</font>
<a name="line1383">1383: </a>      pcis-&gt;reusesubmatrices = <a href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line1384">1384: </a>    } <font color="#4169E1">else</font> <font color="#4169E1">if</font> (!pcbddc-&gt;user_ChangeOfBasisMatrix) {
<a name="line1385">1385: </a>      <a href="../../../../../docs/manualpages/Mat/MatDestroy.html#MatDestroy">MatDestroy</a>(&amp;pcbddc-&gt;local_mat);
<a name="line1386">1386: </a>      <a href="../../../../../docs/manualpages/Sys/PetscObjectReference.html#PetscObjectReference">PetscObjectReference</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)matis-&gt;A);
<a name="line1387">1387: </a>      pcbddc-&gt;local_mat = matis-&gt;A;
<a name="line1388">1388: </a>    }
<a name="line1389">1389: </a>    <font color="#B22222">/* SetUp coarse and local Neumann solvers */</font>
<a name="line1390">1390: </a>    PCBDDCSetUpSolvers(pc);
<a name="line1391">1391: </a>    <font color="#B22222">/* SetUp Scaling operator */</font>
<a name="line1392">1392: </a>    PCBDDCScalingSetUp(pc);
<a name="line1393">1393: </a>  }

<a name="line1395">1395: </a>  <font color="#4169E1">if</font> (pcbddc-&gt;dbg_flag) {
<a name="line1396">1396: </a>    <a href="../../../../../docs/manualpages/Viewer/PetscViewerASCIISubtractTab.html#PetscViewerASCIISubtractTab">PetscViewerASCIISubtractTab</a>(pcbddc-&gt;dbg_viewer,2*pcbddc-&gt;current_level);
<a name="line1397">1397: </a>  }
<a name="line1398">1398: </a>  <font color="#4169E1">return</font>(0);
<a name="line1399">1399: </a>}

<a name="line1401">1401: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>
<a name="line1402">1402: </a><font color="#B22222">/*</font>
<a name="line1403">1403: </a><font color="#B22222">   PCApply_BDDC - Applies the BDDC operator to a vector.</font>

<a name="line1405">1405: </a><font color="#B22222">   Input Parameters:</font>
<a name="line1406">1406: </a><font color="#B22222">+  pc - the preconditioner context</font>
<a name="line1407">1407: </a><font color="#B22222">-  r - input vector (global)</font>

<a name="line1409">1409: </a><font color="#B22222">   Output Parameter:</font>
<a name="line1410">1410: </a><font color="#B22222">.  z - output vector (global)</font>

<a name="line1412">1412: </a><font color="#B22222">   Application Interface Routine: <a href="../../../../../docs/manualpages/PC/PCApply.html#PCApply">PCApply</a>()</font>
<a name="line1413">1413: </a><font color="#B22222"> */</font>
<a name="line1416">1416: </a><strong><font color="#4169E1"><a name="PCApply_BDDC"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PCApply_BDDC(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> pc,<a href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a> r,<a href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a> z)</font></strong>
<a name="line1417">1417: </a>{
<a name="line1418">1418: </a>  PC_IS             *pcis = (PC_IS*)(pc-&gt;data);
<a name="line1419">1419: </a>  PC_BDDC           *pcbddc = (PC_BDDC*)(pc-&gt;data);
<a name="line1420">1420: </a>  <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>          n_B = pcis-&gt;n_B, n_D = pcis-&gt;n - n_B;
<a name="line1421">1421: </a>  <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a>    ierr;
<a name="line1422">1422: </a>  const <a href="../../../../../docs/manualpages/Sys/PetscScalar.html#PetscScalar">PetscScalar</a> one = 1.0;
<a name="line1423">1423: </a>  const <a href="../../../../../docs/manualpages/Sys/PetscScalar.html#PetscScalar">PetscScalar</a> m_one = -1.0;
<a name="line1424">1424: </a>  const <a href="../../../../../docs/manualpages/Sys/PetscScalar.html#PetscScalar">PetscScalar</a> zero = 0.0;

<a name="line1426">1426: </a><font color="#B22222">/* This code is similar to that provided in nn.c for <a href="../../../../../docs/manualpages/PC/PCNN.html#PCNN">PCNN</a></font>
<a name="line1427">1427: </a><font color="#B22222">   NN interface preconditioner changed to BDDC</font>
<a name="line1428">1428: </a><font color="#B22222">   Added support for M_3 preconditioner in the reference article (code is active if pcbddc-&gt;switch_static == <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>) */</font>

<a name="line1431">1431: </a>  <font color="#4169E1">if</font> (!pcbddc-&gt;use_exact_dirichlet_trick) {
<a name="line1432">1432: </a>    <a href="../../../../../docs/manualpages/Vec/VecCopy.html#VecCopy">VecCopy</a>(r,z);
<a name="line1433">1433: </a>    <font color="#B22222">/* First Dirichlet solve */</font>
<a name="line1434">1434: </a>    <a href="../../../../../docs/manualpages/Vec/VecScatterBegin.html#VecScatterBegin">VecScatterBegin</a>(pcis-&gt;global_to_D,r,pcis-&gt;vec1_D,<a href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</a>,<a href="../../../../../docs/manualpages/Vec/SCATTER_FORWARD.html#SCATTER_FORWARD">SCATTER_FORWARD</a>);
<a name="line1435">1435: </a>    <a href="../../../../../docs/manualpages/Vec/VecScatterEnd.html#VecScatterEnd">VecScatterEnd</a>(pcis-&gt;global_to_D,r,pcis-&gt;vec1_D,<a href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</a>,<a href="../../../../../docs/manualpages/Vec/SCATTER_FORWARD.html#SCATTER_FORWARD">SCATTER_FORWARD</a>);
<a name="line1436">1436: </a>    <font color="#B22222">/*</font>
<a name="line1437">1437: </a><font color="#B22222">      Assembling right hand side for BDDC operator</font>
<a name="line1438">1438: </a><font color="#B22222">      - pcis-&gt;vec1_D for the Dirichlet part (if needed, i.e. pcbddc-&gt;switch_static == <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>)</font>
<a name="line1439">1439: </a><font color="#B22222">      - pcis-&gt;vec1_B the interface part of the global vector z</font>
<a name="line1440">1440: </a><font color="#B22222">    */</font>
<a name="line1441">1441: </a>    <font color="#4169E1">if</font> (n_D) {
<a name="line1442">1442: </a>      <a href="../../../../../docs/manualpages/KSP/KSPSolve.html#KSPSolve">KSPSolve</a>(pcbddc-&gt;ksp_D,pcis-&gt;vec1_D,pcis-&gt;vec2_D);
<a name="line1443">1443: </a>      <a href="../../../../../docs/manualpages/Vec/VecScale.html#VecScale">VecScale</a>(pcis-&gt;vec2_D,m_one);
<a name="line1444">1444: </a>      <font color="#4169E1">if</font> (pcbddc-&gt;switch_static) { <a href="../../../../../docs/manualpages/Mat/MatMultAdd.html#MatMultAdd">MatMultAdd</a>(pcis-&gt;A_II,pcis-&gt;vec2_D,pcis-&gt;vec1_D,pcis-&gt;vec1_D); }
<a name="line1445">1445: </a>      <a href="../../../../../docs/manualpages/Mat/MatMult.html#MatMult">MatMult</a>(pcis-&gt;A_BI,pcis-&gt;vec2_D,pcis-&gt;vec1_B);
<a name="line1446">1446: </a>    } <font color="#4169E1">else</font> {
<a name="line1447">1447: </a>      <a href="../../../../../docs/manualpages/Vec/VecSet.html#VecSet">VecSet</a>(pcis-&gt;vec1_B,zero);
<a name="line1448">1448: </a>    }
<a name="line1449">1449: </a>    <a href="../../../../../docs/manualpages/Vec/VecScatterBegin.html#VecScatterBegin">VecScatterBegin</a>(pcis-&gt;global_to_B,pcis-&gt;vec1_B,z,<a href="../../../../../docs/manualpages/Sys/ADD_VALUES.html#ADD_VALUES">ADD_VALUES</a>,<a href="../../../../../docs/manualpages/Vec/SCATTER_REVERSE.html#SCATTER_REVERSE">SCATTER_REVERSE</a>);
<a name="line1450">1450: </a>    <a href="../../../../../docs/manualpages/Vec/VecScatterEnd.html#VecScatterEnd">VecScatterEnd</a>(pcis-&gt;global_to_B,pcis-&gt;vec1_B,z,<a href="../../../../../docs/manualpages/Sys/ADD_VALUES.html#ADD_VALUES">ADD_VALUES</a>,<a href="../../../../../docs/manualpages/Vec/SCATTER_REVERSE.html#SCATTER_REVERSE">SCATTER_REVERSE</a>);
<a name="line1451">1451: </a>    PCBDDCScalingRestriction(pc,z,pcis-&gt;vec1_B);
<a name="line1452">1452: </a>  } <font color="#4169E1">else</font> {
<a name="line1453">1453: </a>    <font color="#4169E1">if</font> (pcbddc-&gt;switch_static) {
<a name="line1454">1454: </a>      <a href="../../../../../docs/manualpages/Vec/VecSet.html#VecSet">VecSet</a>(pcis-&gt;vec1_D,zero);
<a name="line1455">1455: </a>    }
<a name="line1456">1456: </a>    PCBDDCScalingRestriction(pc,r,pcis-&gt;vec1_B);
<a name="line1457">1457: </a>  }

<a name="line1459">1459: </a>  <font color="#B22222">/* Apply interface preconditioner</font>
<a name="line1460">1460: </a><font color="#B22222">     input/output vecs: pcis-&gt;vec1_B and pcis-&gt;vec1_D */</font>
<a name="line1461">1461: </a>  PCBDDCApplyInterfacePreconditioner(pc,<a href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>);

<a name="line1463">1463: </a>  <font color="#B22222">/* Apply transpose of partition of unity operator */</font>
<a name="line1464">1464: </a>  PCBDDCScalingExtension(pc,pcis-&gt;vec1_B,z);

<a name="line1466">1466: </a>  <font color="#B22222">/* Second Dirichlet solve and assembling of output */</font>
<a name="line1467">1467: </a>  <a href="../../../../../docs/manualpages/Vec/VecScatterBegin.html#VecScatterBegin">VecScatterBegin</a>(pcis-&gt;global_to_B,z,pcis-&gt;vec1_B,<a href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</a>,<a href="../../../../../docs/manualpages/Vec/SCATTER_FORWARD.html#SCATTER_FORWARD">SCATTER_FORWARD</a>);
<a name="line1468">1468: </a>  <a href="../../../../../docs/manualpages/Vec/VecScatterEnd.html#VecScatterEnd">VecScatterEnd</a>(pcis-&gt;global_to_B,z,pcis-&gt;vec1_B,<a href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</a>,<a href="../../../../../docs/manualpages/Vec/SCATTER_FORWARD.html#SCATTER_FORWARD">SCATTER_FORWARD</a>);
<a name="line1469">1469: </a>  <font color="#4169E1">if</font> (n_B) {
<a name="line1470">1470: </a>    <a href="../../../../../docs/manualpages/Mat/MatMult.html#MatMult">MatMult</a>(pcis-&gt;A_IB,pcis-&gt;vec1_B,pcis-&gt;vec3_D);
<a name="line1471">1471: </a>    <font color="#4169E1">if</font> (pcbddc-&gt;switch_static) { <a href="../../../../../docs/manualpages/Mat/MatMultAdd.html#MatMultAdd">MatMultAdd</a>(pcis-&gt;A_II,pcis-&gt;vec1_D,pcis-&gt;vec3_D,pcis-&gt;vec3_D); }
<a name="line1472">1472: </a>  } <font color="#4169E1">else</font> <font color="#4169E1">if</font> (pcbddc-&gt;switch_static) {
<a name="line1473">1473: </a>    <a href="../../../../../docs/manualpages/Mat/MatMult.html#MatMult">MatMult</a>(pcis-&gt;A_II,pcis-&gt;vec1_D,pcis-&gt;vec3_D);
<a name="line1474">1474: </a>  }
<a name="line1475">1475: </a>  <a href="../../../../../docs/manualpages/KSP/KSPSolve.html#KSPSolve">KSPSolve</a>(pcbddc-&gt;ksp_D,pcis-&gt;vec3_D,pcis-&gt;vec4_D);
<a name="line1476">1476: </a>  <font color="#4169E1">if</font> (!pcbddc-&gt;use_exact_dirichlet_trick) {
<a name="line1477">1477: </a>    <font color="#4169E1">if</font> (pcbddc-&gt;switch_static) {
<a name="line1478">1478: </a>      <a href="../../../../../docs/manualpages/Vec/VecAXPBYPCZ.html#VecAXPBYPCZ">VecAXPBYPCZ</a>(pcis-&gt;vec2_D,m_one,one,m_one,pcis-&gt;vec4_D,pcis-&gt;vec1_D);
<a name="line1479">1479: </a>    } <font color="#4169E1">else</font> {
<a name="line1480">1480: </a>      <a href="../../../../../docs/manualpages/Vec/VecAXPBY.html#VecAXPBY">VecAXPBY</a>(pcis-&gt;vec2_D,m_one,m_one,pcis-&gt;vec4_D);
<a name="line1481">1481: </a>    }
<a name="line1482">1482: </a>    <a href="../../../../../docs/manualpages/Vec/VecScatterBegin.html#VecScatterBegin">VecScatterBegin</a>(pcis-&gt;global_to_D,pcis-&gt;vec2_D,z,<a href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</a>,<a href="../../../../../docs/manualpages/Vec/SCATTER_REVERSE.html#SCATTER_REVERSE">SCATTER_REVERSE</a>);
<a name="line1483">1483: </a>    <a href="../../../../../docs/manualpages/Vec/VecScatterEnd.html#VecScatterEnd">VecScatterEnd</a>(pcis-&gt;global_to_D,pcis-&gt;vec2_D,z,<a href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</a>,<a href="../../../../../docs/manualpages/Vec/SCATTER_REVERSE.html#SCATTER_REVERSE">SCATTER_REVERSE</a>);
<a name="line1484">1484: </a>  } <font color="#4169E1">else</font> {
<a name="line1485">1485: </a>    <font color="#4169E1">if</font> (pcbddc-&gt;switch_static) {
<a name="line1486">1486: </a>      <a href="../../../../../docs/manualpages/Vec/VecAXPBY.html#VecAXPBY">VecAXPBY</a>(pcis-&gt;vec4_D,one,m_one,pcis-&gt;vec1_D);
<a name="line1487">1487: </a>    } <font color="#4169E1">else</font> {
<a name="line1488">1488: </a>      <a href="../../../../../docs/manualpages/Vec/VecScale.html#VecScale">VecScale</a>(pcis-&gt;vec4_D,m_one);
<a name="line1489">1489: </a>    }
<a name="line1490">1490: </a>    <a href="../../../../../docs/manualpages/Vec/VecScatterBegin.html#VecScatterBegin">VecScatterBegin</a>(pcis-&gt;global_to_D,pcis-&gt;vec4_D,z,<a href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</a>,<a href="../../../../../docs/manualpages/Vec/SCATTER_REVERSE.html#SCATTER_REVERSE">SCATTER_REVERSE</a>);
<a name="line1491">1491: </a>    <a href="../../../../../docs/manualpages/Vec/VecScatterEnd.html#VecScatterEnd">VecScatterEnd</a>(pcis-&gt;global_to_D,pcis-&gt;vec4_D,z,<a href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</a>,<a href="../../../../../docs/manualpages/Vec/SCATTER_REVERSE.html#SCATTER_REVERSE">SCATTER_REVERSE</a>);
<a name="line1492">1492: </a>  }
<a name="line1493">1493: </a>  <font color="#4169E1">return</font>(0);
<a name="line1494">1494: </a>}

<a name="line1496">1496: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>
<a name="line1497">1497: </a><font color="#B22222">/*</font>
<a name="line1498">1498: </a><font color="#B22222">   PCApplyTranspose_BDDC - Applies the transpose of the BDDC operator to a vector.</font>

<a name="line1500">1500: </a><font color="#B22222">   Input Parameters:</font>
<a name="line1501">1501: </a><font color="#B22222">+  pc - the preconditioner context</font>
<a name="line1502">1502: </a><font color="#B22222">-  r - input vector (global)</font>

<a name="line1504">1504: </a><font color="#B22222">   Output Parameter:</font>
<a name="line1505">1505: </a><font color="#B22222">.  z - output vector (global)</font>

<a name="line1507">1507: </a><font color="#B22222">   Application Interface Routine: <a href="../../../../../docs/manualpages/PC/PCApplyTranspose.html#PCApplyTranspose">PCApplyTranspose</a>()</font>
<a name="line1508">1508: </a><font color="#B22222"> */</font>
<a name="line1511">1511: </a><strong><font color="#4169E1"><a name="PCApplyTranspose_BDDC"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PCApplyTranspose_BDDC(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> pc,<a href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a> r,<a href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a> z)</font></strong>
<a name="line1512">1512: </a>{
<a name="line1513">1513: </a>  PC_IS             *pcis = (PC_IS*)(pc-&gt;data);
<a name="line1514">1514: </a>  PC_BDDC           *pcbddc = (PC_BDDC*)(pc-&gt;data);
<a name="line1515">1515: </a>  <a href="../../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>          n_B = pcis-&gt;n_B, n_D = pcis-&gt;n - n_B;
<a name="line1516">1516: </a>  <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a>    ierr;
<a name="line1517">1517: </a>  const <a href="../../../../../docs/manualpages/Sys/PetscScalar.html#PetscScalar">PetscScalar</a> one = 1.0;
<a name="line1518">1518: </a>  const <a href="../../../../../docs/manualpages/Sys/PetscScalar.html#PetscScalar">PetscScalar</a> m_one = -1.0;
<a name="line1519">1519: </a>  const <a href="../../../../../docs/manualpages/Sys/PetscScalar.html#PetscScalar">PetscScalar</a> zero = 0.0;

<a name="line1522">1522: </a>  <font color="#4169E1">if</font> (!pcbddc-&gt;use_exact_dirichlet_trick) {
<a name="line1523">1523: </a>    <a href="../../../../../docs/manualpages/Vec/VecCopy.html#VecCopy">VecCopy</a>(r,z);
<a name="line1524">1524: </a>    <font color="#B22222">/* First Dirichlet solve */</font>
<a name="line1525">1525: </a>    <a href="../../../../../docs/manualpages/Vec/VecScatterBegin.html#VecScatterBegin">VecScatterBegin</a>(pcis-&gt;global_to_D,r,pcis-&gt;vec1_D,<a href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</a>,<a href="../../../../../docs/manualpages/Vec/SCATTER_FORWARD.html#SCATTER_FORWARD">SCATTER_FORWARD</a>);
<a name="line1526">1526: </a>    <a href="../../../../../docs/manualpages/Vec/VecScatterEnd.html#VecScatterEnd">VecScatterEnd</a>(pcis-&gt;global_to_D,r,pcis-&gt;vec1_D,<a href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</a>,<a href="../../../../../docs/manualpages/Vec/SCATTER_FORWARD.html#SCATTER_FORWARD">SCATTER_FORWARD</a>);
<a name="line1527">1527: </a>    <font color="#B22222">/*</font>
<a name="line1528">1528: </a><font color="#B22222">      Assembling right hand side for BDDC operator</font>
<a name="line1529">1529: </a><font color="#B22222">      - pcis-&gt;vec1_D for the Dirichlet part (if needed, i.e. pcbddc-&gt;switch_static == <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>)</font>
<a name="line1530">1530: </a><font color="#B22222">      - pcis-&gt;vec1_B the interface part of the global vector z</font>
<a name="line1531">1531: </a><font color="#B22222">    */</font>
<a name="line1532">1532: </a>    <font color="#4169E1">if</font> (n_D) {
<a name="line1533">1533: </a>      <a href="../../../../../docs/manualpages/KSP/KSPSolveTranspose.html#KSPSolveTranspose">KSPSolveTranspose</a>(pcbddc-&gt;ksp_D,pcis-&gt;vec1_D,pcis-&gt;vec2_D);
<a name="line1534">1534: </a>      <a href="../../../../../docs/manualpages/Vec/VecScale.html#VecScale">VecScale</a>(pcis-&gt;vec2_D,m_one);
<a name="line1535">1535: </a>      <font color="#4169E1">if</font> (pcbddc-&gt;switch_static) { <a href="../../../../../docs/manualpages/Mat/MatMultTransposeAdd.html#MatMultTransposeAdd">MatMultTransposeAdd</a>(pcis-&gt;A_II,pcis-&gt;vec2_D,pcis-&gt;vec1_D,pcis-&gt;vec1_D); }
<a name="line1536">1536: </a>      <a href="../../../../../docs/manualpages/Mat/MatMultTranspose.html#MatMultTranspose">MatMultTranspose</a>(pcis-&gt;A_IB,pcis-&gt;vec2_D,pcis-&gt;vec1_B);
<a name="line1537">1537: </a>    } <font color="#4169E1">else</font> {
<a name="line1538">1538: </a>      <a href="../../../../../docs/manualpages/Vec/VecSet.html#VecSet">VecSet</a>(pcis-&gt;vec1_B,zero);
<a name="line1539">1539: </a>    }
<a name="line1540">1540: </a>    <a href="../../../../../docs/manualpages/Vec/VecScatterBegin.html#VecScatterBegin">VecScatterBegin</a>(pcis-&gt;global_to_B,pcis-&gt;vec1_B,z,<a href="../../../../../docs/manualpages/Sys/ADD_VALUES.html#ADD_VALUES">ADD_VALUES</a>,<a href="../../../../../docs/manualpages/Vec/SCATTER_REVERSE.html#SCATTER_REVERSE">SCATTER_REVERSE</a>);
<a name="line1541">1541: </a>    <a href="../../../../../docs/manualpages/Vec/VecScatterEnd.html#VecScatterEnd">VecScatterEnd</a>(pcis-&gt;global_to_B,pcis-&gt;vec1_B,z,<a href="../../../../../docs/manualpages/Sys/ADD_VALUES.html#ADD_VALUES">ADD_VALUES</a>,<a href="../../../../../docs/manualpages/Vec/SCATTER_REVERSE.html#SCATTER_REVERSE">SCATTER_REVERSE</a>);
<a name="line1542">1542: </a>    PCBDDCScalingRestriction(pc,z,pcis-&gt;vec1_B);
<a name="line1543">1543: </a>  } <font color="#4169E1">else</font> {
<a name="line1544">1544: </a>    <font color="#4169E1">if</font> (pcbddc-&gt;switch_static) {
<a name="line1545">1545: </a>      <a href="../../../../../docs/manualpages/Vec/VecSet.html#VecSet">VecSet</a>(pcis-&gt;vec1_D,zero);
<a name="line1546">1546: </a>    }
<a name="line1547">1547: </a>    PCBDDCScalingRestriction(pc,r,pcis-&gt;vec1_B);
<a name="line1548">1548: </a>  }

<a name="line1550">1550: </a>  <font color="#B22222">/* Apply interface preconditioner</font>
<a name="line1551">1551: </a><font color="#B22222">     input/output vecs: pcis-&gt;vec1_B and pcis-&gt;vec1_D */</font>
<a name="line1552">1552: </a>  PCBDDCApplyInterfacePreconditioner(pc,<a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>);

<a name="line1554">1554: </a>  <font color="#B22222">/* Apply transpose of partition of unity operator */</font>
<a name="line1555">1555: </a>  PCBDDCScalingExtension(pc,pcis-&gt;vec1_B,z);

<a name="line1557">1557: </a>  <font color="#B22222">/* Second Dirichlet solve and assembling of output */</font>
<a name="line1558">1558: </a>  <a href="../../../../../docs/manualpages/Vec/VecScatterBegin.html#VecScatterBegin">VecScatterBegin</a>(pcis-&gt;global_to_B,z,pcis-&gt;vec1_B,<a href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</a>,<a href="../../../../../docs/manualpages/Vec/SCATTER_FORWARD.html#SCATTER_FORWARD">SCATTER_FORWARD</a>);
<a name="line1559">1559: </a>  <a href="../../../../../docs/manualpages/Vec/VecScatterEnd.html#VecScatterEnd">VecScatterEnd</a>(pcis-&gt;global_to_B,z,pcis-&gt;vec1_B,<a href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</a>,<a href="../../../../../docs/manualpages/Vec/SCATTER_FORWARD.html#SCATTER_FORWARD">SCATTER_FORWARD</a>);
<a name="line1560">1560: </a>  <font color="#4169E1">if</font> (n_B) {
<a name="line1561">1561: </a>    <a href="../../../../../docs/manualpages/Mat/MatMultTranspose.html#MatMultTranspose">MatMultTranspose</a>(pcis-&gt;A_BI,pcis-&gt;vec1_B,pcis-&gt;vec3_D);
<a name="line1562">1562: </a>    <font color="#4169E1">if</font> (pcbddc-&gt;switch_static) { <a href="../../../../../docs/manualpages/Mat/MatMultTransposeAdd.html#MatMultTransposeAdd">MatMultTransposeAdd</a>(pcis-&gt;A_II,pcis-&gt;vec1_D,pcis-&gt;vec3_D,pcis-&gt;vec3_D); }
<a name="line1563">1563: </a>  } <font color="#4169E1">else</font> <font color="#4169E1">if</font> (pcbddc-&gt;switch_static) {
<a name="line1564">1564: </a>    <a href="../../../../../docs/manualpages/Mat/MatMultTranspose.html#MatMultTranspose">MatMultTranspose</a>(pcis-&gt;A_II,pcis-&gt;vec1_D,pcis-&gt;vec3_D);
<a name="line1565">1565: </a>  }
<a name="line1566">1566: </a>  <a href="../../../../../docs/manualpages/KSP/KSPSolveTranspose.html#KSPSolveTranspose">KSPSolveTranspose</a>(pcbddc-&gt;ksp_D,pcis-&gt;vec3_D,pcis-&gt;vec4_D);
<a name="line1567">1567: </a>  <font color="#4169E1">if</font> (!pcbddc-&gt;use_exact_dirichlet_trick) {
<a name="line1568">1568: </a>    <font color="#4169E1">if</font> (pcbddc-&gt;switch_static) {
<a name="line1569">1569: </a>      <a href="../../../../../docs/manualpages/Vec/VecAXPBYPCZ.html#VecAXPBYPCZ">VecAXPBYPCZ</a>(pcis-&gt;vec2_D,m_one,one,m_one,pcis-&gt;vec4_D,pcis-&gt;vec1_D);
<a name="line1570">1570: </a>    } <font color="#4169E1">else</font> {
<a name="line1571">1571: </a>      <a href="../../../../../docs/manualpages/Vec/VecAXPBY.html#VecAXPBY">VecAXPBY</a>(pcis-&gt;vec2_D,m_one,m_one,pcis-&gt;vec4_D);
<a name="line1572">1572: </a>    }
<a name="line1573">1573: </a>    <a href="../../../../../docs/manualpages/Vec/VecScatterBegin.html#VecScatterBegin">VecScatterBegin</a>(pcis-&gt;global_to_D,pcis-&gt;vec2_D,z,<a href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</a>,<a href="../../../../../docs/manualpages/Vec/SCATTER_REVERSE.html#SCATTER_REVERSE">SCATTER_REVERSE</a>);
<a name="line1574">1574: </a>    <a href="../../../../../docs/manualpages/Vec/VecScatterEnd.html#VecScatterEnd">VecScatterEnd</a>(pcis-&gt;global_to_D,pcis-&gt;vec2_D,z,<a href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</a>,<a href="../../../../../docs/manualpages/Vec/SCATTER_REVERSE.html#SCATTER_REVERSE">SCATTER_REVERSE</a>);
<a name="line1575">1575: </a>  } <font color="#4169E1">else</font> {
<a name="line1576">1576: </a>    <font color="#4169E1">if</font> (pcbddc-&gt;switch_static) {
<a name="line1577">1577: </a>      <a href="../../../../../docs/manualpages/Vec/VecAXPBY.html#VecAXPBY">VecAXPBY</a>(pcis-&gt;vec4_D,one,m_one,pcis-&gt;vec1_D);
<a name="line1578">1578: </a>    } <font color="#4169E1">else</font> {
<a name="line1579">1579: </a>      <a href="../../../../../docs/manualpages/Vec/VecScale.html#VecScale">VecScale</a>(pcis-&gt;vec4_D,m_one);
<a name="line1580">1580: </a>    }
<a name="line1581">1581: </a>    <a href="../../../../../docs/manualpages/Vec/VecScatterBegin.html#VecScatterBegin">VecScatterBegin</a>(pcis-&gt;global_to_D,pcis-&gt;vec4_D,z,<a href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</a>,<a href="../../../../../docs/manualpages/Vec/SCATTER_REVERSE.html#SCATTER_REVERSE">SCATTER_REVERSE</a>);
<a name="line1582">1582: </a>    <a href="../../../../../docs/manualpages/Vec/VecScatterEnd.html#VecScatterEnd">VecScatterEnd</a>(pcis-&gt;global_to_D,pcis-&gt;vec4_D,z,<a href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</a>,<a href="../../../../../docs/manualpages/Vec/SCATTER_REVERSE.html#SCATTER_REVERSE">SCATTER_REVERSE</a>);
<a name="line1583">1583: </a>  }
<a name="line1584">1584: </a>  <font color="#4169E1">return</font>(0);
<a name="line1585">1585: </a>}
<a name="line1586">1586: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>

<a name="line1590">1590: </a><strong><font color="#4169E1"><a name="PCDestroy_BDDC"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PCDestroy_BDDC(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> pc)</font></strong>
<a name="line1591">1591: </a>{
<a name="line1592">1592: </a>  PC_BDDC        *pcbddc = (PC_BDDC*)pc-&gt;data;

<a name="line1596">1596: </a>  <font color="#B22222">/* free data created by PCIS */</font>
<a name="line1597">1597: </a>  PCISDestroy(pc);
<a name="line1598">1598: </a>  <font color="#B22222">/* free BDDC custom data  */</font>
<a name="line1599">1599: </a>  PCBDDCResetCustomization(pc);
<a name="line1600">1600: </a>  <font color="#B22222">/* destroy objects related to topography */</font>
<a name="line1601">1601: </a>  PCBDDCResetTopography(pc);
<a name="line1602">1602: </a>  <font color="#B22222">/* free allocated graph structure */</font>
<a name="line1603">1603: </a>  <a href="../../../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</a>(pcbddc-&gt;mat_graph);
<a name="line1604">1604: </a>  <font color="#B22222">/* free allocated sub schurs structure */</font>
<a name="line1605">1605: </a>  <a href="../../../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</a>(pcbddc-&gt;sub_schurs);
<a name="line1606">1606: </a>  <font color="#B22222">/* destroy objects for scaling operator */</font>
<a name="line1607">1607: </a>  PCBDDCScalingDestroy(pc);
<a name="line1608">1608: </a>  <a href="../../../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</a>(pcbddc-&gt;deluxe_ctx);
<a name="line1609">1609: </a>  <font color="#B22222">/* free solvers stuff */</font>
<a name="line1610">1610: </a>  PCBDDCResetSolvers(pc);
<a name="line1611">1611: </a>  <font color="#B22222">/* free global vectors needed in presolve */</font>
<a name="line1612">1612: </a>  <a href="../../../../../docs/manualpages/Vec/VecDestroy.html#VecDestroy">VecDestroy</a>(&amp;pcbddc-&gt;temp_solution);
<a name="line1613">1613: </a>  <a href="../../../../../docs/manualpages/Vec/VecDestroy.html#VecDestroy">VecDestroy</a>(&amp;pcbddc-&gt;original_rhs);
<a name="line1614">1614: </a>  <font color="#B22222">/* free stuff for change of basis hooks */</font>
<a name="line1615">1615: </a>  <font color="#4169E1">if</font> (pcbddc-&gt;new_global_mat) {
<a name="line1616">1616: </a>    PCBDDCChange_ctx change_ctx;
<a name="line1617">1617: </a>    <a href="../../../../../docs/manualpages/Mat/MatShellGetContext.html#MatShellGetContext">MatShellGetContext</a>(pcbddc-&gt;new_global_mat,&amp;change_ctx);
<a name="line1618">1618: </a>    <a href="../../../../../docs/manualpages/Mat/MatDestroy.html#MatDestroy">MatDestroy</a>(&amp;change_ctx-&gt;original_mat);
<a name="line1619">1619: </a>    <a href="../../../../../docs/manualpages/Mat/MatDestroy.html#MatDestroy">MatDestroy</a>(&amp;change_ctx-&gt;global_change);
<a name="line1620">1620: </a>    <a href="../../../../../docs/manualpages/Vec/VecDestroyVecs.html#VecDestroyVecs">VecDestroyVecs</a>(2,&amp;change_ctx-&gt;work);
<a name="line1621">1621: </a>    <a href="../../../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</a>(change_ctx);
<a name="line1622">1622: </a>  }
<a name="line1623">1623: </a>  <a href="../../../../../docs/manualpages/Mat/MatDestroy.html#MatDestroy">MatDestroy</a>(&amp;pcbddc-&gt;new_global_mat);
<a name="line1624">1624: </a>  <font color="#B22222">/* remove functions */</font>
<a name="line1625">1625: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc,<font color="#666666">"PCBDDCSetChangeOfBasisMat_C"</font>,NULL);
<a name="line1626">1626: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc,<font color="#666666">"PCBDDCSetPrimalVerticesLocalIS_C"</font>,NULL);
<a name="line1627">1627: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc,<font color="#666666">"PCBDDCSetCoarseningRatio_C"</font>,NULL);
<a name="line1628">1628: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc,<font color="#666666">"PCBDDCSetLevel_C"</font>,NULL);
<a name="line1629">1629: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc,<font color="#666666">"PCBDDCSetUseExactDirichlet_C"</font>,NULL);
<a name="line1630">1630: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc,<font color="#666666">"PCBDDCSetLevels_C"</font>,NULL);
<a name="line1631">1631: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc,<font color="#666666">"PCBDDCSetNullSpace_C"</font>,NULL);
<a name="line1632">1632: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc,<font color="#666666">"PCBDDCSetDirichletBoundaries_C"</font>,NULL);
<a name="line1633">1633: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc,<font color="#666666">"PCBDDCSetDirichletBoundariesLocal_C"</font>,NULL);
<a name="line1634">1634: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc,<font color="#666666">"PCBDDCSetNeumannBoundaries_C"</font>,NULL);
<a name="line1635">1635: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc,<font color="#666666">"PCBDDCSetNeumannBoundariesLocal_C"</font>,NULL);
<a name="line1636">1636: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc,<font color="#666666">"PCBDDCGetDirichletBoundaries_C"</font>,NULL);
<a name="line1637">1637: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc,<font color="#666666">"PCBDDCGetDirichletBoundariesLocal_C"</font>,NULL);
<a name="line1638">1638: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc,<font color="#666666">"PCBDDCGetNeumannBoundaries_C"</font>,NULL);
<a name="line1639">1639: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc,<font color="#666666">"PCBDDCGetNeumannBoundariesLocal_C"</font>,NULL);
<a name="line1640">1640: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc,<font color="#666666">"PCBDDCSetDofsSplitting_C"</font>,NULL);
<a name="line1641">1641: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc,<font color="#666666">"PCBDDCSetDofsSplittingLocal_C"</font>,NULL);
<a name="line1642">1642: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc,<font color="#666666">"PCBDDCSetLocalAdjacencyGraph_C"</font>,NULL);
<a name="line1643">1643: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc,<font color="#666666">"PCBDDCCreateFETIDPOperators_C"</font>,NULL);
<a name="line1644">1644: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc,<font color="#666666">"PCBDDCMatFETIDPGetRHS_C"</font>,NULL);
<a name="line1645">1645: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc,<font color="#666666">"PCBDDCMatFETIDPGetSolution_C"</font>,NULL);
<a name="line1646">1646: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc,<font color="#666666">"PCPreSolveChangeRHS_C"</font>,NULL);
<a name="line1647">1647: </a>  <font color="#B22222">/* Free the private data structure */</font>
<a name="line1648">1648: </a>  <a href="../../../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</a>(pc-&gt;data);
<a name="line1649">1649: </a>  <font color="#4169E1">return</font>(0);
<a name="line1650">1650: </a>}
<a name="line1651">1651: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>

<a name="line1655">1655: </a><strong><font color="#4169E1"><a name="PCPreSolveChangeRHS_BDDC"></a>static <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PCPreSolveChangeRHS_BDDC(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> pc, <a href="../../../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a>* change)</font></strong>
<a name="line1656">1656: </a>{
<a name="line1658">1658: </a>  *change = <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line1659">1659: </a>  <font color="#4169E1">return</font>(0);
<a name="line1660">1660: </a>}

<a name="line1664">1664: </a><strong><font color="#4169E1"><a name="PCBDDCMatFETIDPGetRHS_BDDC"></a>static <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PCBDDCMatFETIDPGetRHS_BDDC(<a href="../../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</a> fetidp_mat, <a href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a> standard_rhs, <a href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a> fetidp_flux_rhs)</font></strong>
<a name="line1665">1665: </a>{
<a name="line1666">1666: </a>  FETIDPMat_ctx  mat_ctx;
<a name="line1667">1667: </a>  <a href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a>            copy_standard_rhs;
<a name="line1668">1668: </a>  PC_IS*         pcis;
<a name="line1669">1669: </a>  PC_BDDC*       pcbddc;

<a name="line1673">1673: </a>  <a href="../../../../../docs/manualpages/Mat/MatShellGetContext.html#MatShellGetContext">MatShellGetContext</a>(fetidp_mat,&amp;mat_ctx);
<a name="line1674">1674: </a>  pcis = (PC_IS*)mat_ctx-&gt;pc-&gt;data;
<a name="line1675">1675: </a>  pcbddc = (PC_BDDC*)mat_ctx-&gt;pc-&gt;data;

<a name="line1677">1677: </a>  <font color="#B22222">/*</font>
<a name="line1678">1678: </a><font color="#B22222">     change of basis for physical rhs if needed</font>
<a name="line1679">1679: </a><font color="#B22222">     It also changes the rhs in case of dirichlet boundaries</font>
<a name="line1680">1680: </a><font color="#B22222">     TODO: better management when FETIDP will have its own class</font>
<a name="line1681">1681: </a><font color="#B22222">  */</font>
<a name="line1682">1682: </a>  <a href="../../../../../docs/manualpages/Vec/VecDuplicate.html#VecDuplicate">VecDuplicate</a>(standard_rhs,&amp;copy_standard_rhs);
<a name="line1683">1683: </a>  <a href="../../../../../docs/manualpages/Vec/VecCopy.html#VecCopy">VecCopy</a>(standard_rhs,copy_standard_rhs);
<a name="line1684">1684: </a>  PCPreSolve_BDDC(mat_ctx-&gt;pc,NULL,copy_standard_rhs,NULL);
<a name="line1685">1685: </a>  <font color="#B22222">/* store vectors for computation of fetidp final solution */</font>
<a name="line1686">1686: </a>  <a href="../../../../../docs/manualpages/Vec/VecScatterBegin.html#VecScatterBegin">VecScatterBegin</a>(pcis-&gt;global_to_D,copy_standard_rhs,mat_ctx-&gt;temp_solution_D,<a href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</a>,<a href="../../../../../docs/manualpages/Vec/SCATTER_FORWARD.html#SCATTER_FORWARD">SCATTER_FORWARD</a>);
<a name="line1687">1687: </a>  <a href="../../../../../docs/manualpages/Vec/VecScatterEnd.html#VecScatterEnd">VecScatterEnd</a>(pcis-&gt;global_to_D,copy_standard_rhs,mat_ctx-&gt;temp_solution_D,<a href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</a>,<a href="../../../../../docs/manualpages/Vec/SCATTER_FORWARD.html#SCATTER_FORWARD">SCATTER_FORWARD</a>);
<a name="line1688">1688: </a>  <font color="#B22222">/* scale rhs since it should be unassembled */</font>
<a name="line1689">1689: </a>  <font color="#B22222">/* TODO use counter scaling? (also below) */</font>
<a name="line1690">1690: </a>  <a href="../../../../../docs/manualpages/Vec/VecScatterBegin.html#VecScatterBegin">VecScatterBegin</a>(pcis-&gt;global_to_B,copy_standard_rhs,mat_ctx-&gt;temp_solution_B,<a href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</a>,<a href="../../../../../docs/manualpages/Vec/SCATTER_FORWARD.html#SCATTER_FORWARD">SCATTER_FORWARD</a>);
<a name="line1691">1691: </a>  <a href="../../../../../docs/manualpages/Vec/VecScatterEnd.html#VecScatterEnd">VecScatterEnd</a>(pcis-&gt;global_to_B,copy_standard_rhs,mat_ctx-&gt;temp_solution_B,<a href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</a>,<a href="../../../../../docs/manualpages/Vec/SCATTER_FORWARD.html#SCATTER_FORWARD">SCATTER_FORWARD</a>);
<a name="line1692">1692: </a>  <font color="#B22222">/* Apply partition of unity */</font>
<a name="line1693">1693: </a>  <a href="../../../../../docs/manualpages/Vec/VecPointwiseMult.html#VecPointwiseMult">VecPointwiseMult</a>(mat_ctx-&gt;temp_solution_B,pcis-&gt;D,mat_ctx-&gt;temp_solution_B);
<a name="line1694">1694: </a>  <font color="#B22222">/* PCBDDCScalingRestriction(mat_ctx-&gt;pc,copy_standard_rhs,mat_ctx-&gt;temp_solution_B); */</font>
<a name="line1695">1695: </a>  <font color="#4169E1">if</font> (!pcbddc-&gt;switch_static) {
<a name="line1696">1696: </a>    <font color="#B22222">/* compute partially subassembled Schur complement right-hand side */</font>
<a name="line1697">1697: </a>    <a href="../../../../../docs/manualpages/KSP/KSPSolve.html#KSPSolve">KSPSolve</a>(pcbddc-&gt;ksp_D,mat_ctx-&gt;temp_solution_D,pcis-&gt;vec1_D);
<a name="line1698">1698: </a>    <a href="../../../../../docs/manualpages/Mat/MatMult.html#MatMult">MatMult</a>(pcis-&gt;A_BI,pcis-&gt;vec1_D,pcis-&gt;vec1_B);
<a name="line1699">1699: </a>    <a href="../../../../../docs/manualpages/Vec/VecAXPY.html#VecAXPY">VecAXPY</a>(mat_ctx-&gt;temp_solution_B,-1.0,pcis-&gt;vec1_B);
<a name="line1700">1700: </a>    <a href="../../../../../docs/manualpages/Vec/VecSet.html#VecSet">VecSet</a>(copy_standard_rhs,0.0);
<a name="line1701">1701: </a>    <a href="../../../../../docs/manualpages/Vec/VecScatterBegin.html#VecScatterBegin">VecScatterBegin</a>(pcis-&gt;global_to_B,mat_ctx-&gt;temp_solution_B,copy_standard_rhs,<a href="../../../../../docs/manualpages/Sys/ADD_VALUES.html#ADD_VALUES">ADD_VALUES</a>,<a href="../../../../../docs/manualpages/Vec/SCATTER_REVERSE.html#SCATTER_REVERSE">SCATTER_REVERSE</a>);
<a name="line1702">1702: </a>    <a href="../../../../../docs/manualpages/Vec/VecScatterEnd.html#VecScatterEnd">VecScatterEnd</a>(pcis-&gt;global_to_B,mat_ctx-&gt;temp_solution_B,copy_standard_rhs,<a href="../../../../../docs/manualpages/Sys/ADD_VALUES.html#ADD_VALUES">ADD_VALUES</a>,<a href="../../../../../docs/manualpages/Vec/SCATTER_REVERSE.html#SCATTER_REVERSE">SCATTER_REVERSE</a>);
<a name="line1703">1703: </a>    <font color="#B22222">/* PCBDDCScalingRestriction(mat_ctx-&gt;pc,copy_standard_rhs,mat_ctx-&gt;temp_solution_B); */</font>
<a name="line1704">1704: </a>    <a href="../../../../../docs/manualpages/Vec/VecScatterBegin.html#VecScatterBegin">VecScatterBegin</a>(pcis-&gt;global_to_B,copy_standard_rhs,mat_ctx-&gt;temp_solution_B,<a href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</a>,<a href="../../../../../docs/manualpages/Vec/SCATTER_FORWARD.html#SCATTER_FORWARD">SCATTER_FORWARD</a>);
<a name="line1705">1705: </a>    <a href="../../../../../docs/manualpages/Vec/VecScatterEnd.html#VecScatterEnd">VecScatterEnd</a>(pcis-&gt;global_to_B,copy_standard_rhs,mat_ctx-&gt;temp_solution_B,<a href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</a>,<a href="../../../../../docs/manualpages/Vec/SCATTER_FORWARD.html#SCATTER_FORWARD">SCATTER_FORWARD</a>);
<a name="line1706">1706: </a>    <a href="../../../../../docs/manualpages/Vec/VecPointwiseMult.html#VecPointwiseMult">VecPointwiseMult</a>(mat_ctx-&gt;temp_solution_B,pcis-&gt;D,mat_ctx-&gt;temp_solution_B);
<a name="line1707">1707: </a>  }
<a name="line1708">1708: </a>  <a href="../../../../../docs/manualpages/Vec/VecDestroy.html#VecDestroy">VecDestroy</a>(&amp;copy_standard_rhs);
<a name="line1709">1709: </a>  <font color="#B22222">/* BDDC rhs */</font>
<a name="line1710">1710: </a>  <a href="../../../../../docs/manualpages/Vec/VecCopy.html#VecCopy">VecCopy</a>(mat_ctx-&gt;temp_solution_B,pcis-&gt;vec1_B);
<a name="line1711">1711: </a>  <font color="#4169E1">if</font> (pcbddc-&gt;switch_static) {
<a name="line1712">1712: </a>    <a href="../../../../../docs/manualpages/Vec/VecCopy.html#VecCopy">VecCopy</a>(mat_ctx-&gt;temp_solution_D,pcis-&gt;vec1_D);
<a name="line1713">1713: </a>  }
<a name="line1714">1714: </a>  <font color="#B22222">/* apply BDDC */</font>
<a name="line1715">1715: </a>  PCBDDCApplyInterfacePreconditioner(mat_ctx-&gt;pc,<a href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>);
<a name="line1716">1716: </a>  <font color="#B22222">/* Application of B_delta and assembling of rhs for fetidp fluxes */</font>
<a name="line1717">1717: </a>  <a href="../../../../../docs/manualpages/Vec/VecSet.html#VecSet">VecSet</a>(fetidp_flux_rhs,0.0);
<a name="line1718">1718: </a>  <a href="../../../../../docs/manualpages/Mat/MatMult.html#MatMult">MatMult</a>(mat_ctx-&gt;B_delta,pcis-&gt;vec1_B,mat_ctx-&gt;lambda_local);
<a name="line1719">1719: </a>  <a href="../../../../../docs/manualpages/Vec/VecScatterBegin.html#VecScatterBegin">VecScatterBegin</a>(mat_ctx-&gt;l2g_lambda,mat_ctx-&gt;lambda_local,fetidp_flux_rhs,<a href="../../../../../docs/manualpages/Sys/ADD_VALUES.html#ADD_VALUES">ADD_VALUES</a>,<a href="../../../../../docs/manualpages/Vec/SCATTER_FORWARD.html#SCATTER_FORWARD">SCATTER_FORWARD</a>);
<a name="line1720">1720: </a>  <a href="../../../../../docs/manualpages/Vec/VecScatterEnd.html#VecScatterEnd">VecScatterEnd</a>(mat_ctx-&gt;l2g_lambda,mat_ctx-&gt;lambda_local,fetidp_flux_rhs,<a href="../../../../../docs/manualpages/Sys/ADD_VALUES.html#ADD_VALUES">ADD_VALUES</a>,<a href="../../../../../docs/manualpages/Vec/SCATTER_FORWARD.html#SCATTER_FORWARD">SCATTER_FORWARD</a>);
<a name="line1721">1721: </a>  <font color="#4169E1">return</font>(0);
<a name="line1722">1722: </a>}

<a name="line1726">1726: </a><font color="#B22222">/*@</font>
<a name="line1727">1727: </a><font color="#B22222"> <a href="../../../../../docs/manualpages/PC/PCBDDCMatFETIDPGetRHS.html#PCBDDCMatFETIDPGetRHS">PCBDDCMatFETIDPGetRHS</a> - Compute the right-hand side for FETI-DP linear system using the physical right-hand side</font>

<a name="line1729">1729: </a><font color="#B22222">   Collective</font>

<a name="line1731">1731: </a><font color="#B22222">   Input Parameters:</font>
<a name="line1732">1732: </a><font color="#B22222">+  fetidp_mat      - the FETI-DP matrix object obtained by a call to <a href="../../../../../docs/manualpages/PC/PCBDDCCreateFETIDPOperators.html#PCBDDCCreateFETIDPOperators">PCBDDCCreateFETIDPOperators</a></font>
<a name="line1733">1733: </a><font color="#B22222">-  standard_rhs    - the right-hand side of the original linear system</font>

<a name="line1735">1735: </a><font color="#B22222">   Output Parameters:</font>
<a name="line1736">1736: </a><font color="#B22222">.  fetidp_flux_rhs - the right-hand side for the FETI-DP linear system</font>

<a name="line1738">1738: </a><font color="#B22222">   Level: developer</font>

<a name="line1740">1740: </a><font color="#B22222">   Notes:</font>

<a name="line1742">1742: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</a>, <a href="../../../../../docs/manualpages/PC/PCBDDCCreateFETIDPOperators.html#PCBDDCCreateFETIDPOperators">PCBDDCCreateFETIDPOperators</a>, <a href="../../../../../docs/manualpages/PC/PCBDDCMatFETIDPGetSolution.html#PCBDDCMatFETIDPGetSolution">PCBDDCMatFETIDPGetSolution</a></font>
<a name="line1743">1743: </a><font color="#B22222">@*/</font>
<a name="line1744">1744: </a><strong><font color="#4169E1"><a name="PCBDDCMatFETIDPGetRHS"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/PC/PCBDDCMatFETIDPGetRHS.html#PCBDDCMatFETIDPGetRHS">PCBDDCMatFETIDPGetRHS</a>(<a href="../../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</a> fetidp_mat, <a href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a> standard_rhs, <a href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a> fetidp_flux_rhs)</font></strong>
<a name="line1745">1745: </a>{
<a name="line1746">1746: </a>  FETIDPMat_ctx  mat_ctx;

<a name="line1750">1750: </a>  <a href="../../../../../docs/manualpages/Mat/MatShellGetContext.html#MatShellGetContext">MatShellGetContext</a>(fetidp_mat,&amp;mat_ctx);
<a name="line1751">1751: </a>  PetscUseMethod(mat_ctx-&gt;pc,<font color="#666666">"PCBDDCMatFETIDPGetRHS_C"</font>,(<a href="../../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</a>,<a href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a>,<a href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a>),(fetidp_mat,standard_rhs,fetidp_flux_rhs));
<a name="line1752">1752: </a>  <font color="#4169E1">return</font>(0);
<a name="line1753">1753: </a>}
<a name="line1754">1754: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>

<a name="line1758">1758: </a><strong><font color="#4169E1"><a name="PCBDDCMatFETIDPGetSolution_BDDC"></a>static <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PCBDDCMatFETIDPGetSolution_BDDC(<a href="../../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</a> fetidp_mat, <a href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a> fetidp_flux_sol, <a href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a> standard_sol)</font></strong>
<a name="line1759">1759: </a>{
<a name="line1760">1760: </a>  FETIDPMat_ctx  mat_ctx;
<a name="line1761">1761: </a>  PC_IS*         pcis;
<a name="line1762">1762: </a>  PC_BDDC*       pcbddc;

<a name="line1766">1766: </a>  <a href="../../../../../docs/manualpages/Mat/MatShellGetContext.html#MatShellGetContext">MatShellGetContext</a>(fetidp_mat,&amp;mat_ctx);
<a name="line1767">1767: </a>  pcis = (PC_IS*)mat_ctx-&gt;pc-&gt;data;
<a name="line1768">1768: </a>  pcbddc = (PC_BDDC*)mat_ctx-&gt;pc-&gt;data;

<a name="line1770">1770: </a>  <font color="#B22222">/* apply B_delta^T */</font>
<a name="line1771">1771: </a>  <a href="../../../../../docs/manualpages/Vec/VecScatterBegin.html#VecScatterBegin">VecScatterBegin</a>(mat_ctx-&gt;l2g_lambda,fetidp_flux_sol,mat_ctx-&gt;lambda_local,<a href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</a>,<a href="../../../../../docs/manualpages/Vec/SCATTER_REVERSE.html#SCATTER_REVERSE">SCATTER_REVERSE</a>);
<a name="line1772">1772: </a>  <a href="../../../../../docs/manualpages/Vec/VecScatterEnd.html#VecScatterEnd">VecScatterEnd</a>  (mat_ctx-&gt;l2g_lambda,fetidp_flux_sol,mat_ctx-&gt;lambda_local,<a href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</a>,<a href="../../../../../docs/manualpages/Vec/SCATTER_REVERSE.html#SCATTER_REVERSE">SCATTER_REVERSE</a>);
<a name="line1773">1773: </a>  <a href="../../../../../docs/manualpages/Mat/MatMultTranspose.html#MatMultTranspose">MatMultTranspose</a>(mat_ctx-&gt;B_delta,mat_ctx-&gt;lambda_local,pcis-&gt;vec1_B);
<a name="line1774">1774: </a>  <font color="#B22222">/* compute rhs for BDDC application */</font>
<a name="line1775">1775: </a>  <a href="../../../../../docs/manualpages/Vec/VecAYPX.html#VecAYPX">VecAYPX</a>(pcis-&gt;vec1_B,-1.0,mat_ctx-&gt;temp_solution_B);
<a name="line1776">1776: </a>  <font color="#4169E1">if</font> (pcbddc-&gt;switch_static) {
<a name="line1777">1777: </a>    <a href="../../../../../docs/manualpages/Vec/VecCopy.html#VecCopy">VecCopy</a>(mat_ctx-&gt;temp_solution_D,pcis-&gt;vec1_D);
<a name="line1778">1778: </a>  }
<a name="line1779">1779: </a>  <font color="#B22222">/* apply BDDC */</font>
<a name="line1780">1780: </a>  PCBDDCApplyInterfacePreconditioner(mat_ctx-&gt;pc,<a href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>);
<a name="line1781">1781: </a>  <font color="#B22222">/* put values into standard global vector */</font>
<a name="line1782">1782: </a>  <a href="../../../../../docs/manualpages/Vec/VecScatterBegin.html#VecScatterBegin">VecScatterBegin</a>(pcis-&gt;global_to_B,pcis-&gt;vec1_B,standard_sol,<a href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</a>,<a href="../../../../../docs/manualpages/Vec/SCATTER_REVERSE.html#SCATTER_REVERSE">SCATTER_REVERSE</a>);
<a name="line1783">1783: </a>  <a href="../../../../../docs/manualpages/Vec/VecScatterEnd.html#VecScatterEnd">VecScatterEnd</a>  (pcis-&gt;global_to_B,pcis-&gt;vec1_B,standard_sol,<a href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</a>,<a href="../../../../../docs/manualpages/Vec/SCATTER_REVERSE.html#SCATTER_REVERSE">SCATTER_REVERSE</a>);
<a name="line1784">1784: </a>  <font color="#4169E1">if</font> (!pcbddc-&gt;switch_static) {
<a name="line1785">1785: </a>    <font color="#B22222">/* compute values into the interior if solved for the partially subassembled Schur complement */</font>
<a name="line1786">1786: </a>    <a href="../../../../../docs/manualpages/Mat/MatMult.html#MatMult">MatMult</a>(pcis-&gt;A_IB,pcis-&gt;vec1_B,pcis-&gt;vec1_D);
<a name="line1787">1787: </a>    <a href="../../../../../docs/manualpages/Vec/VecAXPY.html#VecAXPY">VecAXPY</a>(mat_ctx-&gt;temp_solution_D,-1.0,pcis-&gt;vec1_D);
<a name="line1788">1788: </a>    <a href="../../../../../docs/manualpages/KSP/KSPSolve.html#KSPSolve">KSPSolve</a>(pcbddc-&gt;ksp_D,mat_ctx-&gt;temp_solution_D,pcis-&gt;vec1_D);
<a name="line1789">1789: </a>  }
<a name="line1790">1790: </a>  <a href="../../../../../docs/manualpages/Vec/VecScatterBegin.html#VecScatterBegin">VecScatterBegin</a>(pcis-&gt;global_to_D,pcis-&gt;vec1_D,standard_sol,<a href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</a>,<a href="../../../../../docs/manualpages/Vec/SCATTER_REVERSE.html#SCATTER_REVERSE">SCATTER_REVERSE</a>);
<a name="line1791">1791: </a>  <a href="../../../../../docs/manualpages/Vec/VecScatterEnd.html#VecScatterEnd">VecScatterEnd</a>  (pcis-&gt;global_to_D,pcis-&gt;vec1_D,standard_sol,<a href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</a>,<a href="../../../../../docs/manualpages/Vec/SCATTER_REVERSE.html#SCATTER_REVERSE">SCATTER_REVERSE</a>);
<a name="line1792">1792: </a>  <font color="#B22222">/* final change of basis if needed</font>
<a name="line1793">1793: </a><font color="#B22222">     Is also sums the dirichlet part removed during RHS assembling */</font>
<a name="line1794">1794: </a>  PCPostSolve_BDDC(mat_ctx-&gt;pc,NULL,NULL,standard_sol);
<a name="line1795">1795: </a>  <font color="#4169E1">return</font>(0);
<a name="line1796">1796: </a>}

<a name="line1800">1800: </a><font color="#B22222">/*@</font>
<a name="line1801">1801: </a><font color="#B22222"> <a href="../../../../../docs/manualpages/PC/PCBDDCMatFETIDPGetSolution.html#PCBDDCMatFETIDPGetSolution">PCBDDCMatFETIDPGetSolution</a> - Compute the physical solution using the solution of the FETI-DP linear system</font>

<a name="line1803">1803: </a><font color="#B22222">   Collective</font>

<a name="line1805">1805: </a><font color="#B22222">   Input Parameters:</font>
<a name="line1806">1806: </a><font color="#B22222">+  fetidp_mat      - the FETI-DP matrix obtained by a call to <a href="../../../../../docs/manualpages/PC/PCBDDCCreateFETIDPOperators.html#PCBDDCCreateFETIDPOperators">PCBDDCCreateFETIDPOperators</a></font>
<a name="line1807">1807: </a><font color="#B22222">-  fetidp_flux_sol - the solution of the FETI-DP linear system</font>

<a name="line1809">1809: </a><font color="#B22222">   Output Parameters:</font>
<a name="line1810">1810: </a><font color="#B22222">.  standard_sol    - the solution defined on the physical domain</font>

<a name="line1812">1812: </a><font color="#B22222">   Level: developer</font>

<a name="line1814">1814: </a><font color="#B22222">   Notes:</font>

<a name="line1816">1816: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</a>, <a href="../../../../../docs/manualpages/PC/PCBDDCCreateFETIDPOperators.html#PCBDDCCreateFETIDPOperators">PCBDDCCreateFETIDPOperators</a>, <a href="../../../../../docs/manualpages/PC/PCBDDCMatFETIDPGetRHS.html#PCBDDCMatFETIDPGetRHS">PCBDDCMatFETIDPGetRHS</a></font>
<a name="line1817">1817: </a><font color="#B22222">@*/</font>
<a name="line1818">1818: </a><strong><font color="#4169E1"><a name="PCBDDCMatFETIDPGetSolution"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/PC/PCBDDCMatFETIDPGetSolution.html#PCBDDCMatFETIDPGetSolution">PCBDDCMatFETIDPGetSolution</a>(<a href="../../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</a> fetidp_mat, <a href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a> fetidp_flux_sol, <a href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a> standard_sol)</font></strong>
<a name="line1819">1819: </a>{
<a name="line1820">1820: </a>  FETIDPMat_ctx  mat_ctx;

<a name="line1824">1824: </a>  <a href="../../../../../docs/manualpages/Mat/MatShellGetContext.html#MatShellGetContext">MatShellGetContext</a>(fetidp_mat,&amp;mat_ctx);
<a name="line1825">1825: </a>  PetscUseMethod(mat_ctx-&gt;pc,<font color="#666666">"PCBDDCMatFETIDPGetSolution_C"</font>,(<a href="../../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</a>,<a href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a>,<a href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a>),(fetidp_mat,fetidp_flux_sol,standard_sol));
<a name="line1826">1826: </a>  <font color="#4169E1">return</font>(0);
<a name="line1827">1827: </a>}
<a name="line1828">1828: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>

<a name="line1830">1830: </a><strong><font color="#4169E1">extern <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> FETIDPMatMult(<a href="../../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</a>,<a href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a>,<a href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a>)</font></strong>;
<a name="line1831">1831: </a><strong><font color="#4169E1">extern <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> FETIDPMatMultTranspose(<a href="../../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</a>,<a href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a>,<a href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a>)</font></strong>;
<a name="line1832">1832: </a><strong><font color="#4169E1">extern <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PCBDDCDestroyFETIDPMat(<a href="../../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</a>)</font></strong>;
<a name="line1833">1833: </a><strong><font color="#4169E1">extern <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> FETIDPPCApply(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a>,<a href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a>,<a href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a>)</font></strong>;
<a name="line1834">1834: </a><strong><font color="#4169E1">extern <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> FETIDPPCApplyTranspose(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a>,<a href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a>,<a href="../../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a>)</font></strong>;
<a name="line1835">1835: </a><strong><font color="#4169E1">extern <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PCBDDCDestroyFETIDPPC(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a>)</font></strong>;

<a name="line1839">1839: </a><strong><font color="#4169E1"><a name="PCBDDCCreateFETIDPOperators_BDDC"></a>static <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PCBDDCCreateFETIDPOperators_BDDC(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> pc, <a href="../../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</a> *fetidp_mat, <a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> *fetidp_pc)</font></strong>
<a name="line1840">1840: </a>{

<a name="line1842">1842: </a>  FETIDPMat_ctx  fetidpmat_ctx;
<a name="line1843">1843: </a>  <a href="../../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</a>            newmat;
<a name="line1844">1844: </a>  FETIDPPC_ctx   fetidppc_ctx;
<a name="line1845">1845: </a>  <a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a>             newpc;
<a name="line1846">1846: </a>  <a href="../../../../../docs/manualpages/Sys/MPI_Comm.html#MPI_Comm">MPI_Comm</a>       comm;

<a name="line1850">1850: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectGetComm.html#PetscObjectGetComm">PetscObjectGetComm</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc,&amp;comm);
<a name="line1851">1851: </a>  <font color="#B22222">/* FETIDP linear matrix */</font>
<a name="line1852">1852: </a>  PCBDDCCreateFETIDPMatContext(pc,&amp;fetidpmat_ctx);
<a name="line1853">1853: </a>  PCBDDCSetupFETIDPMatContext(fetidpmat_ctx);
<a name="line1854">1854: </a>  <a href="../../../../../docs/manualpages/Mat/MatCreateShell.html#MatCreateShell">MatCreateShell</a>(comm,<a href="../../../../../docs/manualpages/Sys/PETSC_DECIDE.html#PETSC_DECIDE">PETSC_DECIDE</a>,<a href="../../../../../docs/manualpages/Sys/PETSC_DECIDE.html#PETSC_DECIDE">PETSC_DECIDE</a>,fetidpmat_ctx-&gt;n_lambda,fetidpmat_ctx-&gt;n_lambda,fetidpmat_ctx,&amp;newmat);
<a name="line1855">1855: </a>  <a href="../../../../../docs/manualpages/Mat/MatShellSetOperation.html#MatShellSetOperation">MatShellSetOperation</a>(newmat,MATOP_MULT,(void (*)(void))FETIDPMatMult);
<a name="line1856">1856: </a>  <a href="../../../../../docs/manualpages/Mat/MatShellSetOperation.html#MatShellSetOperation">MatShellSetOperation</a>(newmat,MATOP_MULT_TRANSPOSE,(void (*)(void))FETIDPMatMultTranspose);
<a name="line1857">1857: </a>  <a href="../../../../../docs/manualpages/Mat/MatShellSetOperation.html#MatShellSetOperation">MatShellSetOperation</a>(newmat,MATOP_DESTROY,(void (*)(void))PCBDDCDestroyFETIDPMat);
<a name="line1858">1858: </a>  <a href="../../../../../docs/manualpages/Mat/MatSetUp.html#MatSetUp">MatSetUp</a>(newmat);
<a name="line1859">1859: </a>  <font color="#B22222">/* FETIDP preconditioner */</font>
<a name="line1860">1860: </a>  PCBDDCCreateFETIDPPCContext(pc,&amp;fetidppc_ctx);
<a name="line1861">1861: </a>  PCBDDCSetupFETIDPPCContext(newmat,fetidppc_ctx);
<a name="line1862">1862: </a>  <a href="../../../../../docs/manualpages/PC/PCCreate.html#PCCreate">PCCreate</a>(comm,&amp;newpc);
<a name="line1863">1863: </a>  <a href="../../../../../docs/manualpages/PC/PCSetType.html#PCSetType">PCSetType</a>(newpc,<a href="../../../../../docs/manualpages/PC/PCSHELL.html#PCSHELL">PCSHELL</a>);
<a name="line1864">1864: </a>  <a href="../../../../../docs/manualpages/PC/PCShellSetContext.html#PCShellSetContext">PCShellSetContext</a>(newpc,fetidppc_ctx);
<a name="line1865">1865: </a>  <a href="../../../../../docs/manualpages/PC/PCShellSetApply.html#PCShellSetApply">PCShellSetApply</a>(newpc,FETIDPPCApply);
<a name="line1866">1866: </a>  <a href="../../../../../docs/manualpages/PC/PCShellSetApplyTranspose.html#PCShellSetApplyTranspose">PCShellSetApplyTranspose</a>(newpc,FETIDPPCApplyTranspose);
<a name="line1867">1867: </a>  <a href="../../../../../docs/manualpages/PC/PCShellSetDestroy.html#PCShellSetDestroy">PCShellSetDestroy</a>(newpc,PCBDDCDestroyFETIDPPC);
<a name="line1868">1868: </a>  <a href="../../../../../docs/manualpages/PC/PCSetOperators.html#PCSetOperators">PCSetOperators</a>(newpc,newmat,newmat);
<a name="line1869">1869: </a>  <a href="../../../../../docs/manualpages/PC/PCSetUp.html#PCSetUp">PCSetUp</a>(newpc);
<a name="line1870">1870: </a>  <font color="#B22222">/* return pointers for objects created */</font>
<a name="line1871">1871: </a>  *fetidp_mat=newmat;
<a name="line1872">1872: </a>  *fetidp_pc=newpc;
<a name="line1873">1873: </a>  <font color="#4169E1">return</font>(0);
<a name="line1874">1874: </a>}

<a name="line1878">1878: </a><font color="#B22222">/*@</font>
<a name="line1879">1879: </a><font color="#B22222"> <a href="../../../../../docs/manualpages/PC/PCBDDCCreateFETIDPOperators.html#PCBDDCCreateFETIDPOperators">PCBDDCCreateFETIDPOperators</a> - Create FETI-DP operators</font>

<a name="line1881">1881: </a><font color="#B22222">   Collective</font>

<a name="line1883">1883: </a><font color="#B22222">   Input Parameters:</font>
<a name="line1884">1884: </a><font color="#B22222">.  pc - the BDDC preconditioning context (setup should have been called before)</font>

<a name="line1886">1886: </a><font color="#B22222">   Output Parameters:</font>
<a name="line1887">1887: </a><font color="#B22222">+  fetidp_mat - shell FETI-DP matrix object</font>
<a name="line1888">1888: </a><font color="#B22222">-  fetidp_pc  - shell Dirichlet preconditioner for FETI-DP matrix</font>

<a name="line1890">1890: </a><font color="#B22222">   Options Database Keys:</font>
<a name="line1891">1891: </a><font color="#B22222">.    -fetidp_fullyredundant &lt;false&gt; - use or not a fully redundant set of Lagrange multipliers</font>

<a name="line1893">1893: </a><font color="#B22222">   Level: developer</font>

<a name="line1895">1895: </a><font color="#B22222">   Notes:</font>
<a name="line1896">1896: </a><font color="#B22222">     Currently the only operations provided for FETI-DP matrix are <a href="../../../../../docs/manualpages/Mat/MatMult.html#MatMult">MatMult</a> and <a href="../../../../../docs/manualpages/Mat/MatMultTranspose.html#MatMultTranspose">MatMultTranspose</a></font>

<a name="line1898">1898: </a><font color="#B22222">.seealso: <a href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</a>, <a href="../../../../../docs/manualpages/PC/PCBDDCMatFETIDPGetRHS.html#PCBDDCMatFETIDPGetRHS">PCBDDCMatFETIDPGetRHS</a>, <a href="../../../../../docs/manualpages/PC/PCBDDCMatFETIDPGetSolution.html#PCBDDCMatFETIDPGetSolution">PCBDDCMatFETIDPGetSolution</a></font>
<a name="line1899">1899: </a><font color="#B22222">@*/</font>
<a name="line1900">1900: </a><strong><font color="#4169E1"><a name="PCBDDCCreateFETIDPOperators"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../../docs/manualpages/PC/PCBDDCCreateFETIDPOperators.html#PCBDDCCreateFETIDPOperators">PCBDDCCreateFETIDPOperators</a>(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> pc, <a href="../../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</a> *fetidp_mat, <a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> *fetidp_pc)</font></strong>
<a name="line1901">1901: </a>{

<a name="line1906">1906: </a>  <font color="#4169E1">if</font> (pc-&gt;setupcalled) {
<a name="line1907">1907: </a>    PetscUseMethod(pc,<font color="#666666">"PCBDDCCreateFETIDPOperators_C"</font>,(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a>,<a href="../../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</a>*,<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a>*),(pc,fetidp_mat,fetidp_pc));
<a name="line1908">1908: </a>  } <font color="#4169E1">else</font> <a href="../../../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</a>(<a href="../../../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>,PETSC_ERR_SUP,<font color="#666666">"You must call PCSetup_BDDC() first \n"</font>);
<a name="line1909">1909: </a>  <font color="#4169E1">return</font>(0);
<a name="line1910">1910: </a>}
<a name="line1911">1911: </a><font color="#B22222">/* -------------------------------------------------------------------------- */</font>
<a name="line1912">1912: </a><font color="#B22222">/*MC</font>
<a name="line1913">1913: </a><font color="#B22222">   <a href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</a> - Balancing Domain Decomposition by Constraints.</font>

<a name="line1915">1915: </a><font color="#B22222">   An implementation of the BDDC preconditioner based on</font>

<a name="line1917">1917: </a><font color="#B22222">.vb</font>
<a name="line1918">1918: </a><font color="#B22222">   [1] C. R. Dohrmann. "An approximate BDDC preconditioner", Numerical Linear Algebra with Applications Volume 14, Issue 2, pages 149-168, March 2007</font>
<a name="line1919">1919: </a><font color="#B22222">   [2] A. Klawonn and O. B. Widlund. "Dual-Primal FETI Methods for Linear Elasticity", http://cs.nyu.edu/csweb/Research/TechReports/TR2004-855/TR2004-855.pdf</font>
<a name="line1920">1920: </a><font color="#B22222">   [3] J. Mandel, B. Sousedik, C. R. Dohrmann. "Multispace and Multilevel BDDC", http://arxiv.org/abs/0712.3977</font>
<a name="line1921">1921: </a><font color="#B22222">   [4] C. Pechstein and C. R. Dohrmann. "Modern domain decomposition methods BDDC, deluxe scaling, and an algebraic approach", Seminar talk, Linz, December 2013, http://people.ricam.oeaw.ac.at/c.pechstein/pechstein-bddc2013.pdf</font>
<a name="line1922">1922: </a><font color="#B22222">.ve</font>

<a name="line1924">1924: </a><font color="#B22222">   The matrix to be preconditioned (Pmat) must be of type <a href="../../../../../docs/manualpages/Mat/MATIS.html#MATIS">MATIS</a>.</font>

<a name="line1926">1926: </a><font color="#B22222">   Currently works with <a href="../../../../../docs/manualpages/Mat/MATIS.html#MATIS">MATIS</a> matrices with local matrices of type <a href="../../../../../docs/manualpages/Mat/MATSEQAIJ.html#MATSEQAIJ">MATSEQAIJ</a>, <a href="../../../../../docs/manualpages/Mat/MATSEQBAIJ.html#MATSEQBAIJ">MATSEQBAIJ</a> or <a href="../../../../../docs/manualpages/Mat/MATSEQSBAIJ.html#MATSEQSBAIJ">MATSEQSBAIJ</a>, either with real or complex numbers.</font>

<a name="line1928">1928: </a><font color="#B22222">   It also works with unsymmetric and indefinite problems.</font>

<a name="line1930">1930: </a><font color="#B22222">   Unlike 'conventional' interface preconditioners, <a href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</a> iterates over all degrees of freedom, not just those on the interface. This allows the use of approximate solvers on the subdomains.</font>

<a name="line1932">1932: </a><font color="#B22222">   Approximate local solvers are automatically adapted for singular linear problems (see [1]) if the user has provided the nullspace using <a href="../../../../../docs/manualpages/PC/PCBDDCSetNullSpace.html#PCBDDCSetNullSpace">PCBDDCSetNullSpace</a>()</font>

<a name="line1934">1934: </a><font color="#B22222">   Boundary nodes are split in vertices, edges and faces classes using information from the local to global mapping of dofs and the local connectivity graph of nodes. The latter can be customized by using <a href="../../../../../docs/manualpages/PC/PCBDDCSetLocalAdjacencyGraph.html#PCBDDCSetLocalAdjacencyGraph">PCBDDCSetLocalAdjacencyGraph</a>()</font>
<a name="line1935">1935: </a><font color="#B22222">   Additional information on dofs can be provided by using <a href="../../../../../docs/manualpages/PC/PCBDDCSetDofsSplitting.html#PCBDDCSetDofsSplitting">PCBDDCSetDofsSplitting</a>(), <a href="../../../../../docs/manualpages/PC/PCBDDCSetDirichletBoundaries.html#PCBDDCSetDirichletBoundaries">PCBDDCSetDirichletBoundaries</a>(), <a href="../../../../../docs/manualpages/PC/PCBDDCSetNeumannBoundaries.html#PCBDDCSetNeumannBoundaries">PCBDDCSetNeumannBoundaries</a>(), and <a href="../../../../../docs/manualpages/PC/PCBDDCSetPrimalVerticesLocalIS.html#PCBDDCSetPrimalVerticesLocalIS">PCBDDCSetPrimalVerticesLocalIS</a>()</font>

<a name="line1937">1937: </a><font color="#B22222">   Constraints can be customized by attaching a <a href="../../../../../docs/manualpages/Mat/MatNullSpace.html#MatNullSpace">MatNullSpace</a> object to the <a href="../../../../../docs/manualpages/Mat/MATIS.html#MATIS">MATIS</a> matrix via <a href="../../../../../docs/manualpages/Mat/MatSetNearNullSpace.html#MatSetNearNullSpace">MatSetNearNullSpace</a>(). Non-singular modes are retained via SVD.</font>

<a name="line1939">1939: </a><font color="#B22222">   Change of basis is performed similarly to [2] when requested. When more than one constraint is present on a single connected component (i.e. an edge or a face), a robust method based on local QR factorizations is used.</font>
<a name="line1940">1940: </a><font color="#B22222">   User defined change of basis can be passed to <a href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</a> by using <a href="../../../../../docs/manualpages/PC/PCBDDCSetChangeOfBasisMat.html#PCBDDCSetChangeOfBasisMat">PCBDDCSetChangeOfBasisMat</a>()</font>

<a name="line1942">1942: </a><font color="#B22222">   The PETSc implementation also supports multilevel BDDC [3]. Coarse grids are partitioned using a <a href="../../../../../docs/manualpages/Mat/MatPartitioning.html#MatPartitioning">MatPartitioning</a> object.</font>

<a name="line1944">1944: </a><font color="#B22222">   Adaptive selection of primal constraints [4] is supported for SPD systems with high-contrast in the coefficients if MUMPS is present. Future versions of the code will also consider using MKL_PARDISO or PASTIX.</font>

<a name="line1946">1946: </a><font color="#B22222">   An experimental interface to the FETI-DP method is available. FETI-DP operators could be created using <a href="../../../../../docs/manualpages/PC/PCBDDCCreateFETIDPOperators.html#PCBDDCCreateFETIDPOperators">PCBDDCCreateFETIDPOperators</a>(). A stand-alone class for the FETI-DP method will be provided in the next releases.</font>
<a name="line1947">1947: </a><font color="#B22222">   Deluxe scaling is not supported yet for FETI-DP.</font>

<a name="line1949">1949: </a><font color="#B22222">   Options Database Keys (some of them, run with -h for a complete list):</font>

<a name="line1951">1951: </a><font color="#B22222">.    -pc_bddc_use_vertices &lt;true&gt; - use or not vertices in primal space</font>
<a name="line1952">1952: </a><font color="#B22222">.    -pc_bddc_use_edges &lt;true&gt; - use or not edges in primal space</font>
<a name="line1953">1953: </a><font color="#B22222">.    -pc_bddc_use_faces &lt;false&gt; - use or not faces in primal space</font>
<a name="line1954">1954: </a><font color="#B22222">.    -pc_bddc_symmetric &lt;true&gt; - symmetric computation of primal basis functions. Specify false for unsymmetric problems</font>
<a name="line1955">1955: </a><font color="#B22222">.    -pc_bddc_use_change_of_basis &lt;false&gt; - use change of basis approach (on edges only)</font>
<a name="line1956">1956: </a><font color="#B22222">.    -pc_bddc_use_change_on_faces &lt;false&gt; - use change of basis approach on faces if change of basis has been requested</font>
<a name="line1957">1957: </a><font color="#B22222">.    -pc_bddc_switch_static &lt;false&gt; - switches from M_2 (default) to M_3 operator (see reference article [1])</font>
<a name="line1958">1958: </a><font color="#B22222">.    -pc_bddc_levels &lt;0&gt; - maximum number of levels for multilevel</font>
<a name="line1959">1959: </a><font color="#B22222">.    -pc_bddc_coarsening_ratio &lt;8&gt; - number of subdomains which will be aggregated together at the coarser level (e.g. H/h ratio at the coarser level, significative only in the multilevel case)</font>
<a name="line1960">1960: </a><font color="#B22222">.    -pc_bddc_redistribute &lt;0&gt; - size of a subset of processors where the coarse problem will be remapped (the value is ignored if not at the coarsest level)</font>
<a name="line1961">1961: </a><font color="#B22222">.    -pc_bddc_use_deluxe_scaling &lt;false&gt; - use deluxe scaling</font>
<a name="line1962">1962: </a><font color="#B22222">.    -pc_bddc_schur_layers &lt;-1&gt; - select the economic version of deluxe scaling by specifying the number of layers (-1 corresponds to the original deluxe scaling)</font>
<a name="line1963">1963: </a><font color="#B22222">.    -pc_bddc_adaptive_threshold &lt;0.0&gt; - when a value greater than one is specified, adaptive selection of constraints is performed on edges and faces (requires deluxe scaling and MUMPS installed)</font>
<a name="line1964">1964: </a><font color="#B22222">-    -pc_bddc_check_level &lt;0&gt; - set verbosity level of debugging output</font>

<a name="line1966">1966: </a><font color="#B22222">   Options for Dirichlet, Neumann or coarse solver can be set with</font>
<a name="line1967">1967: </a><font color="#B22222">.vb</font>
<a name="line1968">1968: </a><font color="#B22222">      -pc_bddc_dirichlet_</font>
<a name="line1969">1969: </a><font color="#B22222">      -pc_bddc_neumann_</font>
<a name="line1970">1970: </a><font color="#B22222">      -pc_bddc_coarse_</font>
<a name="line1971">1971: </a><font color="#B22222">.ve</font>
<a name="line1972">1972: </a><font color="#B22222">   e.g -pc_bddc_dirichlet_ksp_type richardson -pc_bddc_dirichlet_pc_type gamg. <a href="../../../../../docs/manualpages/PC/PCBDDC.html#PCBDDC">PCBDDC</a> uses by default KPSPREONLY and <a href="../../../../../docs/manualpages/PC/PCLU.html#PCLU">PCLU</a>.</font>

<a name="line1974">1974: </a><font color="#B22222">   When using a multilevel approach, solvers' options at the N-th level (N &gt; 1) can be specified as</font>
<a name="line1975">1975: </a><font color="#B22222">.vb</font>
<a name="line1976">1976: </a><font color="#B22222">      -pc_bddc_dirichlet_lN_</font>
<a name="line1977">1977: </a><font color="#B22222">      -pc_bddc_neumann_lN_</font>
<a name="line1978">1978: </a><font color="#B22222">      -pc_bddc_coarse_lN_</font>
<a name="line1979">1979: </a><font color="#B22222">.ve</font>
<a name="line1980">1980: </a><font color="#B22222">   Note that level number ranges from the finest (0) to the coarsest (N).</font>
<a name="line1981">1981: </a><font color="#B22222">   In order to specify options for the BDDC operators at the coarser levels (and not for the solvers), prepend -pc_bddc_coarse_ or -pc_bddc_coarse_l to the option, e.g.</font>
<a name="line1982">1982: </a><font color="#B22222">.vb</font>
<a name="line1983">1983: </a><font color="#B22222">     -pc_bddc_coarse_pc_bddc_adaptive_threshold 5 -pc_bddc_coarse_l1_pc_bddc_redistribute 3</font>
<a name="line1984">1984: </a><font color="#B22222">.ve</font>
<a name="line1985">1985: </a><font color="#B22222">   will use a threshold of 5 for constraints' selection at the first coarse level and will redistribute the coarse problem of the first coarse level on 3 processors</font>

<a name="line1987">1987: </a><font color="#B22222">   Level: intermediate</font>

<a name="line1989">1989: </a><font color="#B22222">   Developer notes:</font>

<a name="line1991">1991: </a><font color="#B22222">   Contributed by Stefano Zampini</font>

<a name="line1993">1993: </a><font color="#B22222">.seealso:  <a href="../../../../../docs/manualpages/PC/PCCreate.html#PCCreate">PCCreate</a>(), <a href="../../../../../docs/manualpages/PC/PCSetType.html#PCSetType">PCSetType</a>(), <a href="../../../../../docs/manualpages/PC/PCType.html#PCType">PCType</a> (for list of available types), <a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a>,  <a href="../../../../../docs/manualpages/Mat/MATIS.html#MATIS">MATIS</a></font>
<a name="line1994">1994: </a><font color="#B22222">M*/</font>

<a name="line1998">1998: </a><strong><font color="#4169E1"><a name="PCCreate_BDDC"></a>PETSC_EXTERN <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PCCreate_BDDC(<a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> pc)</font></strong>
<a name="line1999">1999: </a>{
<a name="line2000">2000: </a>  <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a>      ierr;
<a name="line2001">2001: </a>  PC_BDDC             *pcbddc;

<a name="line2004">2004: </a>  <font color="#B22222">/* Creates the private data structure for this preconditioner and attach it to the <a href="../../../../../docs/manualpages/PC/PC.html#PC">PC</a> object. */</font>
<a name="line2005">2005: </a>  <a href="../../../../../docs/manualpages/Sys/PetscNewLog.html#PetscNewLog">PetscNewLog</a>(pc,&amp;pcbddc);
<a name="line2006">2006: </a>  pc-&gt;data  = (void*)pcbddc;

<a name="line2008">2008: </a>  <font color="#B22222">/* create PCIS data structure */</font>
<a name="line2009">2009: </a>  PCISCreate(pc);

<a name="line2011">2011: </a>  <font color="#B22222">/* BDDC customization */</font>
<a name="line2012">2012: </a>  pcbddc-&gt;use_local_adj       = <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line2013">2013: </a>  pcbddc-&gt;use_vertices        = <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line2014">2014: </a>  pcbddc-&gt;use_edges           = <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line2015">2015: </a>  pcbddc-&gt;use_faces           = <a href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line2016">2016: </a>  pcbddc-&gt;use_change_of_basis = <a href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line2017">2017: </a>  pcbddc-&gt;use_change_on_faces = <a href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line2018">2018: </a>  pcbddc-&gt;switch_static       = <a href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line2019">2019: </a>  pcbddc-&gt;use_nnsp_true       = <a href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line2020">2020: </a>  pcbddc-&gt;use_qr_single       = <a href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line2021">2021: </a>  pcbddc-&gt;symmetric_primal    = <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line2022">2022: </a>  pcbddc-&gt;dbg_flag            = 0;
<a name="line2023">2023: </a>  <font color="#B22222">/* private */</font>
<a name="line2024">2024: </a>  pcbddc-&gt;local_primal_size          = 0;
<a name="line2025">2025: </a>  pcbddc-&gt;local_primal_size_cc       = 0;
<a name="line2026">2026: </a>  pcbddc-&gt;local_primal_ref_node      = 0;
<a name="line2027">2027: </a>  pcbddc-&gt;local_primal_ref_mult      = 0;
<a name="line2028">2028: </a>  pcbddc-&gt;n_vertices                 = 0;
<a name="line2029">2029: </a>  pcbddc-&gt;primal_indices_local_idxs  = 0;
<a name="line2030">2030: </a>  pcbddc-&gt;recompute_topography       = <a href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line2031">2031: </a>  pcbddc-&gt;coarse_size                = -1;
<a name="line2032">2032: </a>  pcbddc-&gt;new_primal_space           = <a href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line2033">2033: </a>  pcbddc-&gt;new_primal_space_local     = <a href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line2034">2034: </a>  pcbddc-&gt;global_primal_indices      = 0;
<a name="line2035">2035: </a>  pcbddc-&gt;onearnullspace             = 0;
<a name="line2036">2036: </a>  pcbddc-&gt;onearnullvecs_state        = 0;
<a name="line2037">2037: </a>  pcbddc-&gt;user_primal_vertices       = 0;
<a name="line2038">2038: </a>  pcbddc-&gt;NullSpace                  = 0;
<a name="line2039">2039: </a>  pcbddc-&gt;temp_solution              = 0;
<a name="line2040">2040: </a>  pcbddc-&gt;original_rhs               = 0;
<a name="line2041">2041: </a>  pcbddc-&gt;local_mat                  = 0;
<a name="line2042">2042: </a>  pcbddc-&gt;ChangeOfBasisMatrix        = 0;
<a name="line2043">2043: </a>  pcbddc-&gt;user_ChangeOfBasisMatrix   = 0;
<a name="line2044">2044: </a>  pcbddc-&gt;new_global_mat             = 0;
<a name="line2045">2045: </a>  pcbddc-&gt;coarse_vec                 = 0;
<a name="line2046">2046: </a>  pcbddc-&gt;coarse_ksp                 = 0;
<a name="line2047">2047: </a>  pcbddc-&gt;coarse_phi_B               = 0;
<a name="line2048">2048: </a>  pcbddc-&gt;coarse_phi_D               = 0;
<a name="line2049">2049: </a>  pcbddc-&gt;coarse_psi_B               = 0;
<a name="line2050">2050: </a>  pcbddc-&gt;coarse_psi_D               = 0;
<a name="line2051">2051: </a>  pcbddc-&gt;vec1_P                     = 0;
<a name="line2052">2052: </a>  pcbddc-&gt;vec1_R                     = 0;
<a name="line2053">2053: </a>  pcbddc-&gt;vec2_R                     = 0;
<a name="line2054">2054: </a>  pcbddc-&gt;local_auxmat1              = 0;
<a name="line2055">2055: </a>  pcbddc-&gt;local_auxmat2              = 0;
<a name="line2056">2056: </a>  pcbddc-&gt;R_to_B                     = 0;
<a name="line2057">2057: </a>  pcbddc-&gt;R_to_D                     = 0;
<a name="line2058">2058: </a>  pcbddc-&gt;ksp_D                      = 0;
<a name="line2059">2059: </a>  pcbddc-&gt;ksp_R                      = 0;
<a name="line2060">2060: </a>  pcbddc-&gt;NeumannBoundaries          = 0;
<a name="line2061">2061: </a>  pcbddc-&gt;NeumannBoundariesLocal     = 0;
<a name="line2062">2062: </a>  pcbddc-&gt;DirichletBoundaries        = 0;
<a name="line2063">2063: </a>  pcbddc-&gt;DirichletBoundariesLocal   = 0;
<a name="line2064">2064: </a>  pcbddc-&gt;user_provided_isfordofs    = <a href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line2065">2065: </a>  pcbddc-&gt;n_ISForDofs                = 0;
<a name="line2066">2066: </a>  pcbddc-&gt;n_ISForDofsLocal           = 0;
<a name="line2067">2067: </a>  pcbddc-&gt;ISForDofs                  = 0;
<a name="line2068">2068: </a>  pcbddc-&gt;ISForDofsLocal             = 0;
<a name="line2069">2069: </a>  pcbddc-&gt;ConstraintMatrix           = 0;
<a name="line2070">2070: </a>  pcbddc-&gt;use_exact_dirichlet_trick  = <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line2071">2071: </a>  pcbddc-&gt;coarse_loc_to_glob         = 0;
<a name="line2072">2072: </a>  pcbddc-&gt;coarsening_ratio           = 8;
<a name="line2073">2073: </a>  pcbddc-&gt;coarse_adj_red             = 0;
<a name="line2074">2074: </a>  pcbddc-&gt;current_level              = 0;
<a name="line2075">2075: </a>  pcbddc-&gt;max_levels                 = 0;
<a name="line2076">2076: </a>  pcbddc-&gt;use_coarse_estimates       = <a href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line2077">2077: </a>  pcbddc-&gt;redistribute_coarse        = 0;
<a name="line2078">2078: </a>  pcbddc-&gt;coarse_subassembling       = 0;
<a name="line2079">2079: </a>  pcbddc-&gt;coarse_subassembling_init  = 0;

<a name="line2081">2081: </a>  <font color="#B22222">/* create local graph structure */</font>
<a name="line2082">2082: </a>  PCBDDCGraphCreate(&amp;pcbddc-&gt;mat_graph);

<a name="line2084">2084: </a>  <font color="#B22222">/* scaling */</font>
<a name="line2085">2085: </a>  pcbddc-&gt;work_scaling          = 0;
<a name="line2086">2086: </a>  pcbddc-&gt;use_deluxe_scaling    = <a href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line2087">2087: </a>  pcbddc-&gt;faster_deluxe         = <a href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;

<a name="line2089">2089: </a>  <font color="#B22222">/* create sub schurs structure */</font>
<a name="line2090">2090: </a>  PCBDDCSubSchursCreate(&amp;pcbddc-&gt;sub_schurs);
<a name="line2091">2091: </a>  pcbddc-&gt;sub_schurs_rebuild     = <a href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line2092">2092: </a>  pcbddc-&gt;sub_schurs_layers      = -1;
<a name="line2093">2093: </a>  pcbddc-&gt;sub_schurs_use_useradj = <a href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;

<a name="line2095">2095: </a>  pcbddc-&gt;computed_rowadj = <a href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;

<a name="line2097">2097: </a>  <font color="#B22222">/* adaptivity */</font>
<a name="line2098">2098: </a>  pcbddc-&gt;adaptive_threshold      = 0.0;
<a name="line2099">2099: </a>  pcbddc-&gt;adaptive_nmax           = 0;
<a name="line2100">2100: </a>  pcbddc-&gt;adaptive_nmin           = 0;

<a name="line2102">2102: </a>  <font color="#B22222">/* function pointers */</font>
<a name="line2103">2103: </a>  pc-&gt;ops-&gt;apply               = PCApply_BDDC;
<a name="line2104">2104: </a>  pc-&gt;ops-&gt;applytranspose      = PCApplyTranspose_BDDC;
<a name="line2105">2105: </a>  pc-&gt;ops-&gt;setup               = PCSetUp_BDDC;
<a name="line2106">2106: </a>  pc-&gt;ops-&gt;destroy             = PCDestroy_BDDC;
<a name="line2107">2107: </a>  pc-&gt;ops-&gt;setfromoptions      = PCSetFromOptions_BDDC;
<a name="line2108">2108: </a>  pc-&gt;ops-&gt;view                = PCView_BDDC;
<a name="line2109">2109: </a>  pc-&gt;ops-&gt;applyrichardson     = 0;
<a name="line2110">2110: </a>  pc-&gt;ops-&gt;applysymmetricleft  = 0;
<a name="line2111">2111: </a>  pc-&gt;ops-&gt;applysymmetricright = 0;
<a name="line2112">2112: </a>  pc-&gt;ops-&gt;presolve            = PCPreSolve_BDDC;
<a name="line2113">2113: </a>  pc-&gt;ops-&gt;postsolve           = PCPostSolve_BDDC;

<a name="line2115">2115: </a>  <font color="#B22222">/* composing function */</font>
<a name="line2116">2116: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc,<font color="#666666">"PCBDDCSetChangeOfBasisMat_C"</font>,PCBDDCSetChangeOfBasisMat_BDDC);
<a name="line2117">2117: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc,<font color="#666666">"PCBDDCSetPrimalVerticesLocalIS_C"</font>,PCBDDCSetPrimalVerticesLocalIS_BDDC);
<a name="line2118">2118: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc,<font color="#666666">"PCBDDCSetCoarseningRatio_C"</font>,PCBDDCSetCoarseningRatio_BDDC);
<a name="line2119">2119: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc,<font color="#666666">"PCBDDCSetLevel_C"</font>,PCBDDCSetLevel_BDDC);
<a name="line2120">2120: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc,<font color="#666666">"PCBDDCSetUseExactDirichlet_C"</font>,PCBDDCSetUseExactDirichlet_BDDC);
<a name="line2121">2121: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc,<font color="#666666">"PCBDDCSetLevels_C"</font>,PCBDDCSetLevels_BDDC);
<a name="line2122">2122: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc,<font color="#666666">"PCBDDCSetNullSpace_C"</font>,PCBDDCSetNullSpace_BDDC);
<a name="line2123">2123: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc,<font color="#666666">"PCBDDCSetDirichletBoundaries_C"</font>,PCBDDCSetDirichletBoundaries_BDDC);
<a name="line2124">2124: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc,<font color="#666666">"PCBDDCSetDirichletBoundariesLocal_C"</font>,PCBDDCSetDirichletBoundariesLocal_BDDC);
<a name="line2125">2125: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc,<font color="#666666">"PCBDDCSetNeumannBoundaries_C"</font>,PCBDDCSetNeumannBoundaries_BDDC);
<a name="line2126">2126: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc,<font color="#666666">"PCBDDCSetNeumannBoundariesLocal_C"</font>,PCBDDCSetNeumannBoundariesLocal_BDDC);
<a name="line2127">2127: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc,<font color="#666666">"PCBDDCGetDirichletBoundaries_C"</font>,PCBDDCGetDirichletBoundaries_BDDC);
<a name="line2128">2128: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc,<font color="#666666">"PCBDDCGetDirichletBoundariesLocal_C"</font>,PCBDDCGetDirichletBoundariesLocal_BDDC);
<a name="line2129">2129: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc,<font color="#666666">"PCBDDCGetNeumannBoundaries_C"</font>,PCBDDCGetNeumannBoundaries_BDDC);
<a name="line2130">2130: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc,<font color="#666666">"PCBDDCGetNeumannBoundariesLocal_C"</font>,PCBDDCGetNeumannBoundariesLocal_BDDC);
<a name="line2131">2131: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc,<font color="#666666">"PCBDDCSetDofsSplitting_C"</font>,PCBDDCSetDofsSplitting_BDDC);
<a name="line2132">2132: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc,<font color="#666666">"PCBDDCSetDofsSplittingLocal_C"</font>,PCBDDCSetDofsSplittingLocal_BDDC);
<a name="line2133">2133: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc,<font color="#666666">"PCBDDCSetLocalAdjacencyGraph_C"</font>,PCBDDCSetLocalAdjacencyGraph_BDDC);
<a name="line2134">2134: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc,<font color="#666666">"PCBDDCCreateFETIDPOperators_C"</font>,PCBDDCCreateFETIDPOperators_BDDC);
<a name="line2135">2135: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc,<font color="#666666">"PCBDDCMatFETIDPGetRHS_C"</font>,PCBDDCMatFETIDPGetRHS_BDDC);
<a name="line2136">2136: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc,<font color="#666666">"PCBDDCMatFETIDPGetSolution_C"</font>,PCBDDCMatFETIDPGetSolution_BDDC);
<a name="line2137">2137: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)pc,<font color="#666666">"PCPreSolveChangeRHS_C"</font>,PCPreSolveChangeRHS_BDDC);
<a name="line2138">2138: </a>  <font color="#4169E1">return</font>(0);
<a name="line2139">2139: </a>}

</pre>
</body>

</html>
