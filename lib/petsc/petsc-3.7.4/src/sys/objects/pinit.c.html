<center><a href="pinit.c">Actual source code: pinit.c</a></center><br>

<html>
<head> <link rel="canonical" href="http://www.mcs.anl.gov/petsc/petsc-current/src/sys/objects/pinit.c.html" />
<title></title>
<meta name="generator" content="c2html 0.9.4">
<meta name="date" content="2016-10-03T02:14:33+00:00">
</head>

<body bgcolor="#FFFFFF">
   <div id="version" align=right><b>petsc-3.7.4 2016-10-02</b></div>
   <div id="bugreport" align=right><a href="mailto:petsc-maint@mcs.anl.gov?subject=Typo or Error in Documentation &body=Please describe the typo or error in the documentation: petsc-3.7.4 v3.7.4 src/sys/objects/pinit.c.html "><small>Report Typos and Errors</small></a></div>
<pre width="80">
<a name="line2">  2: </a><font color="#B22222">/*</font>
<a name="line3">  3: </a><font color="#B22222">   This file defines the initialization of PETSc, including <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>()</font>
<a name="line4">  4: </a><font color="#B22222">*/</font>
<a name="line5">  5: </a><font color="#A020F0">#include &lt;petsc/private/petscimpl.h&gt;        </font><font color="#B22222">/*I  "petscsys.h"   I*/</font><font color="#A020F0"></font>
<a name="line6">  6: </a><font color="#A020F0">#include &lt;petscvalgrind.h&gt;</font>
<a name="line7">  7: </a><font color="#A020F0">#include &lt;petscviewer.h&gt;</font>

<a name="line9">  9: </a><font color="#A020F0">#if defined(PETSC_USE_LOG)</font>
<a name="line10"> 10: </a><strong><font color="#4169E1">extern <a href="../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PetscLogInitialize(void)</font></strong>;
<a name="line11"> 11: </a><font color="#A020F0">#endif</font>

<a name="line13"> 13: </a><font color="#A020F0">#if defined(PETSC_SERIALIZE_FUNCTIONS)</font>
<a name="line14"> 14: </a>PetscFPT PetscFPTData = 0;
<a name="line15"> 15: </a><font color="#A020F0">#endif</font>

<a name="line17"> 17: </a><font color="#A020F0">#if defined(PETSC_HAVE_CUDA)</font>
<a name="line18"> 18: </a>cublasHandle_t cublasv2handle = NULL;
<a name="line19"> 19: </a><font color="#A020F0">#endif</font>

<a name="line21"> 21: </a><font color="#A020F0">#if defined(PETSC_HAVE_SAWS)</font>
<a name="line22"> 22: </a><font color="#A020F0">#include &lt;petscviewersaws.h&gt;</font>
<a name="line23"> 23: </a><font color="#A020F0">#endif</font>
<a name="line24"> 24: </a><font color="#B22222">/* -----------------------------------------------------------------------------------------*/</font>

<a name="line26"> 26: </a>extern FILE *petsc_history;

<a name="line28"> 28: </a><strong><font color="#4169E1">extern <a href="../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PetscInitialize_DynamicLibraries(void)</font></strong>;
<a name="line29"> 29: </a><strong><font color="#4169E1">extern <a href="../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PetscFinalize_DynamicLibraries(void)</font></strong>;
<a name="line30"> 30: </a><strong><font color="#4169E1">extern <a href="../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PetscFunctionListPrintAll(void)</font></strong>;
<a name="line31"> 31: </a><strong><font color="#4169E1">extern <a href="../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PetscSequentialPhaseBegin_Private(<a href="../../../docs/manualpages/Sys/MPI_Comm.html#MPI_Comm">MPI_Comm</a>,int)</font></strong>;
<a name="line32"> 32: </a><strong><font color="#4169E1">extern <a href="../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PetscSequentialPhaseEnd_Private(<a href="../../../docs/manualpages/Sys/MPI_Comm.html#MPI_Comm">MPI_Comm</a>,int)</font></strong>;
<a name="line33"> 33: </a><strong><font color="#4169E1">extern <a href="../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PetscCloseHistoryFile(FILE**)</font></strong>;

<a name="line35"> 35: </a><font color="#B22222">/* user may set this BEFORE calling <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>() */</font>
<a name="line36"> 36: </a><a href="../../../docs/manualpages/Sys/MPI_Comm.html#MPI_Comm">MPI_Comm</a> <a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a> = MPI_COMM_NULL;

<a name="line38"> 38: </a><a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a> Petsc_Counter_keyval   = MPI_KEYVAL_INVALID;
<a name="line39"> 39: </a><a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a> Petsc_InnerComm_keyval = MPI_KEYVAL_INVALID;
<a name="line40"> 40: </a><a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a> Petsc_OuterComm_keyval = MPI_KEYVAL_INVALID;

<a name="line42"> 42: </a><font color="#B22222">/*</font>
<a name="line43"> 43: </a><font color="#B22222">     Declare and set all the string names of the PETSc enums</font>
<a name="line44"> 44: </a><font color="#B22222">*/</font>
<a name="line45"> 45: </a>const char *const PetscBools[]     = {<font color="#666666">"FALSE"</font>,<font color="#666666">"TRUE"</font>,<font color="#666666">"<a href="../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a>"</font>,<font color="#666666">"PETSC_"</font>,0};
<a name="line46"> 46: </a>const char *const PetscCopyModes[] = {<font color="#666666">"COPY_VALUES"</font>,<font color="#666666">"OWN_POINTER"</font>,<font color="#666666">"USE_POINTER"</font>,<font color="#666666">"<a href="../../../docs/manualpages/Sys/PetscCopyMode.html#PetscCopyMode">PetscCopyMode</a>"</font>,<font color="#666666">"PETSC_"</font>,0};
<a name="line47"> 47: </a>const char *const PetscDataTypes[] = {<font color="#666666">"INT"</font>,<font color="#666666">"DOUBLE"</font>,<font color="#666666">"COMPLEX"</font>,<font color="#666666">"LONG"</font>,<font color="#666666">"SHORT"</font>,<font color="#666666">"FLOAT"</font>,
<a name="line48"> 48: </a>                                      <font color="#666666">"CHAR"</font>,<font color="#666666">"LOGICAL"</font>,<font color="#666666">"ENUM"</font>,<font color="#666666">"BOOL"</font>,<font color="#666666">"LONGDOUBLE"</font>,<font color="#666666">"OBJECT"</font>,<font color="#666666">"FUNCTION"</font>,<font color="#666666">"<a href="../../../docs/manualpages/Sys/PetscDataType.html#PetscDataType">PetscDataType</a>"</font>,<font color="#666666">"PETSC_"</font>,0};

<a name="line50"> 50: </a><a href="../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a> PetscPreLoadingUsed = <a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line51"> 51: </a><a href="../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a> PetscPreLoadingOn   = <a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;

<a name="line53"> 53: </a><a href="../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> PetscHotRegionDepth;

<a name="line55"> 55: </a><font color="#A020F0">#if defined(PETSC_HAVE_THREADSAFETY)</font>
<a name="line56"> 56: </a>PetscSpinlock PetscViewerASCIISpinLockOpen;
<a name="line57"> 57: </a>PetscSpinlock PetscViewerASCIISpinLockStdout;
<a name="line58"> 58: </a>PetscSpinlock PetscViewerASCIISpinLockStderr;
<a name="line59"> 59: </a>PetscSpinlock PetscCommSpinLock;
<a name="line60"> 60: </a><font color="#A020F0">#endif</font>

<a name="line62"> 62: </a><font color="#B22222">/*</font>
<a name="line63"> 63: </a><font color="#B22222">       Checks the options database for initializations related to the</font>
<a name="line64"> 64: </a><font color="#B22222">    PETSc components</font>
<a name="line65"> 65: </a><font color="#B22222">*/</font>
<a name="line68"> 68: </a><strong><font color="#4169E1"><a name="PetscOptionsCheckInitial_Components"></a><a href="../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a>  PetscOptionsCheckInitial_Components(void)</font></strong>
<a name="line69"> 69: </a>{
<a name="line70"> 70: </a>  <a href="../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a>      flg1;

<a name="line74"> 74: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsHasName.html#PetscOptionsHasName">PetscOptionsHasName</a>(NULL,NULL,<font color="#666666">"-help"</font>,&amp;flg1);
<a name="line75"> 75: </a>  <font color="#4169E1">if</font> (flg1) {
<a name="line76"> 76: </a><font color="#A020F0">#if defined(PETSC_USE_LOG)</font>
<a name="line77"> 77: </a>    <a href="../../../docs/manualpages/Sys/MPI_Comm.html#MPI_Comm">MPI_Comm</a> comm = <a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>;
<a name="line78"> 78: </a>    (*<a href="../../../docs/manualpages/Sys/PetscHelpPrintf.html#PetscHelpPrintf">PetscHelpPrintf</a>)(comm,<font color="#666666">"------Additional PETSc component options--------\n"</font>);
<a name="line79"> 79: </a>    (*<a href="../../../docs/manualpages/Sys/PetscHelpPrintf.html#PetscHelpPrintf">PetscHelpPrintf</a>)(comm,<font color="#666666">" -log_exclude: &lt;vec,mat,pc.ksp,snes&gt;\n"</font>);
<a name="line80"> 80: </a>    (*<a href="../../../docs/manualpages/Sys/PetscHelpPrintf.html#PetscHelpPrintf">PetscHelpPrintf</a>)(comm,<font color="#666666">" -info_exclude: &lt;null,vec,mat,pc,ksp,snes,ts&gt;\n"</font>);
<a name="line81"> 81: </a>    (*<a href="../../../docs/manualpages/Sys/PetscHelpPrintf.html#PetscHelpPrintf">PetscHelpPrintf</a>)(comm,<font color="#666666">"-----------------------------------------------\n"</font>);
<a name="line82"> 82: </a><font color="#A020F0">#endif</font>
<a name="line83"> 83: </a>  }
<a name="line84"> 84: </a>  <font color="#4169E1">return</font>(0);
<a name="line85"> 85: </a>}

<a name="line89"> 89: </a><font color="#B22222">/*</font>
<a name="line90"> 90: </a><font color="#B22222">      PetscInitializeNoPointers - Calls <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>() from C/C++ without the pointers to argc and args</font>

<a name="line92"> 92: </a><font color="#B22222">   Collective</font>

<a name="line94"> 94: </a><font color="#B22222">   Level: advanced</font>

<a name="line96"> 96: </a><font color="#B22222">    Notes: this is called only by the PETSc MATLAB and Julia interface. Even though it might start MPI it sets the flag to</font>
<a name="line97"> 97: </a><font color="#B22222">     indicate that it did NOT start MPI so that the <a href="../../../docs/manualpages/Sys/PetscFinalize.html#PetscFinalize">PetscFinalize</a>() does not end MPI, thus allowing <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>() to</font>
<a name="line98"> 98: </a><font color="#B22222">     be called multiple times from MATLAB and Julia without the problem of trying to initialize MPI more than once.</font>

<a name="line100">100: </a><font color="#B22222">     Turns off PETSc signal handling because that can interact with MATLAB's signal handling causing random crashes.</font>

<a name="line102">102: </a><font color="#B22222">.seealso: <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>(), <a href="../../../docs/manualpages/Sys/PetscInitializeFortran.html#PetscInitializeFortran">PetscInitializeFortran</a>(), <a href="../../../docs/manualpages/Sys/PetscInitializeNoArguments.html#PetscInitializeNoArguments">PetscInitializeNoArguments</a>()</font>
<a name="line103">103: </a><font color="#B22222">*/</font>
<a name="line104">104: </a><strong><font color="#4169E1"><a name="PetscInitializeNoPointers"></a><a href="../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a>  PetscInitializeNoPointers(int argc,char **args,const char *filename,const char *help)</font></strong>
<a name="line105">105: </a>{
<a name="line107">107: </a>  int            myargc   = argc;
<a name="line108">108: </a>  char           **myargs = args;

<a name="line111">111: </a>  <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>(&amp;myargc,&amp;myargs,filename,help);
<a name="line112">112: </a>  <a href="../../../docs/manualpages/Sys/PetscPopSignalHandler.html#PetscPopSignalHandler">PetscPopSignalHandler</a>();
<a name="line113">113: </a>  PetscBeganMPI = <a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line114">114: </a>  <a href="../../../docs/manualpages/Sys/PetscFunctionReturn.html#PetscFunctionReturn">PetscFunctionReturn</a>(ierr);
<a name="line115">115: </a>}

<a name="line119">119: </a><font color="#B22222">/*</font>
<a name="line120">120: </a><font color="#B22222">      Used by MATLAB and Julia interface to get communicator</font>
<a name="line121">121: </a><font color="#B22222">*/</font>
<a name="line122">122: </a><strong><font color="#4169E1"><a name="PetscGetPETSC_COMM_SELF"></a><a href="../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a>  PetscGetPETSC_COMM_SELF(<a href="../../../docs/manualpages/Sys/MPI_Comm.html#MPI_Comm">MPI_Comm</a> *comm)</font></strong>
<a name="line123">123: </a>{
<a name="line125">125: </a>  *comm = <a href="../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>;
<a name="line126">126: </a>  <font color="#4169E1">return</font>(0);
<a name="line127">127: </a>}

<a name="line131">131: </a><font color="#B22222">/*@C</font>
<a name="line132">132: </a><font color="#B22222">      <a href="../../../docs/manualpages/Sys/PetscInitializeNoArguments.html#PetscInitializeNoArguments">PetscInitializeNoArguments</a> - Calls <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>() from C/C++ without</font>
<a name="line133">133: </a><font color="#B22222">        the command line arguments.</font>

<a name="line135">135: </a><font color="#B22222">   Collective</font>

<a name="line137">137: </a><font color="#B22222">   Level: advanced</font>

<a name="line139">139: </a><font color="#B22222">.seealso: <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>(), <a href="../../../docs/manualpages/Sys/PetscInitializeFortran.html#PetscInitializeFortran">PetscInitializeFortran</a>()</font>
<a name="line140">140: </a><font color="#B22222">@*/</font>
<a name="line141">141: </a><strong><font color="#4169E1"><a name="PetscInitializeNoArguments"></a><a href="../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a>  <a href="../../../docs/manualpages/Sys/PetscInitializeNoArguments.html#PetscInitializeNoArguments">PetscInitializeNoArguments</a>(void)</font></strong>
<a name="line142">142: </a>{
<a name="line144">144: </a>  int            argc   = 0;
<a name="line145">145: </a>  char           **args = 0;

<a name="line148">148: </a>  <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>(&amp;argc,&amp;args,NULL,NULL);
<a name="line149">149: </a>  <a href="../../../docs/manualpages/Sys/PetscFunctionReturn.html#PetscFunctionReturn">PetscFunctionReturn</a>(ierr);
<a name="line150">150: </a>}

<a name="line154">154: </a><font color="#B22222">/*@</font>
<a name="line155">155: </a><font color="#B22222">      <a href="../../../docs/manualpages/Sys/PetscInitialized.html#PetscInitialized">PetscInitialized</a> - Determine whether PETSc is initialized.</font>

<a name="line157">157: </a><font color="#B22222">   Level: beginner</font>

<a name="line159">159: </a><font color="#B22222">.seealso: <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>(), <a href="../../../docs/manualpages/Sys/PetscInitializeNoArguments.html#PetscInitializeNoArguments">PetscInitializeNoArguments</a>(), <a href="../../../docs/manualpages/Sys/PetscInitializeFortran.html#PetscInitializeFortran">PetscInitializeFortran</a>()</font>
<a name="line160">160: </a><font color="#B22222">@*/</font>
<a name="line161">161: </a><strong><font color="#4169E1"><a name="PetscInitialized"></a><a href="../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../docs/manualpages/Sys/PetscInitialized.html#PetscInitialized">PetscInitialized</a>(<a href="../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a>  *isInitialized)</font></strong>
<a name="line162">162: </a>{
<a name="line163">163: </a>  *isInitialized = PetscInitializeCalled;
<a name="line164">164: </a>  <font color="#4169E1">return</font> 0;
<a name="line165">165: </a>}

<a name="line169">169: </a><font color="#B22222">/*@</font>
<a name="line170">170: </a><font color="#B22222">      <a href="../../../docs/manualpages/Sys/PetscFinalized.html#PetscFinalized">PetscFinalized</a> - Determine whether <a href="../../../docs/manualpages/Sys/PetscFinalize.html#PetscFinalize">PetscFinalize</a>() has been called yet</font>

<a name="line172">172: </a><font color="#B22222">   Level: developer</font>

<a name="line174">174: </a><font color="#B22222">.seealso: <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>(), <a href="../../../docs/manualpages/Sys/PetscInitializeNoArguments.html#PetscInitializeNoArguments">PetscInitializeNoArguments</a>(), <a href="../../../docs/manualpages/Sys/PetscInitializeFortran.html#PetscInitializeFortran">PetscInitializeFortran</a>()</font>
<a name="line175">175: </a><font color="#B22222">@*/</font>
<a name="line176">176: </a><strong><font color="#4169E1"><a name="PetscFinalized"></a><a href="../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a>  <a href="../../../docs/manualpages/Sys/PetscFinalized.html#PetscFinalized">PetscFinalized</a>(<a href="../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a>  *isFinalized)</font></strong>
<a name="line177">177: </a>{
<a name="line178">178: </a>  *isFinalized = PetscFinalizeCalled;
<a name="line179">179: </a>  <font color="#4169E1">return</font> 0;
<a name="line180">180: </a>}

<a name="line182">182: </a><strong><font color="#4169E1">extern <a href="../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PetscOptionsCheckInitial_Private(void)</font></strong>;

<a name="line184">184: </a><font color="#B22222">/*</font>
<a name="line185">185: </a><font color="#B22222">       This function is the MPI reduction operation used to compute the sum of the</font>
<a name="line186">186: </a><font color="#B22222">   first half of the datatype and the max of the second half.</font>
<a name="line187">187: </a><font color="#B22222">*/</font>
<a name="line188">188: </a>MPI_Op PetscMaxSum_Op = 0;

<a name="line192">192: </a><strong><font color="#4169E1"><a name="PetscMaxSum_Local"></a>PETSC_EXTERN void MPIAPI PetscMaxSum_Local(void *in,void *out,int *cnt,MPI_Datatype *datatype)</font></strong>
<a name="line193">193: </a>{
<a name="line194">194: </a>  <a href="../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> *xin = (<a href="../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>*)in,*xout = (<a href="../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>*)out,i,count = *cnt;

<a name="line197">197: </a>  <font color="#4169E1">if</font> (*datatype != MPIU_2INT) {
<a name="line198">198: </a>    (*<a href="../../../docs/manualpages/Sys/PetscErrorPrintf.html#PetscErrorPrintf">PetscErrorPrintf</a>)(<font color="#666666">"Can only handle MPIU_2INT data types"</font>);
<a name="line199">199: </a>    <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Abort.html#MPI_Abort">MPI_Abort</a>(MPI_COMM_WORLD,1);
<a name="line200">200: </a>  }

<a name="line202">202: </a>  <font color="#4169E1">for</font> (i=0; i&lt;count; i++) {
<a name="line203">203: </a>    xout[2*i]    = <a href="../../../docs/manualpages/Sys/PetscMax.html#PetscMax">PetscMax</a>(xout[2*i],xin[2*i]);
<a name="line204">204: </a>    xout[2*i+1] += xin[2*i+1];
<a name="line205">205: </a>  }
<a name="line206">206: </a>  PetscFunctionReturnVoid();
<a name="line207">207: </a>}

<a name="line209">209: </a><font color="#B22222">/*</font>
<a name="line210">210: </a><font color="#B22222">    Returns the max of the first entry owned by this processor and the</font>
<a name="line211">211: </a><font color="#B22222">sum of the second entry.</font>

<a name="line213">213: </a><font color="#B22222">    The reason sizes[2*i] contains lengths sizes[2*i+1] contains flag of 1 if length is nonzero</font>
<a name="line214">214: </a><font color="#B22222">is so that the PetscMaxSum_Op() can set TWO values, if we passed in only sizes[i] with lengths</font>
<a name="line215">215: </a><font color="#B22222">there would be no place to store the both needed results.</font>
<a name="line216">216: </a><font color="#B22222">*/</font>
<a name="line219">219: </a><strong><font color="#4169E1"><a name="PetscMaxSum"></a><a href="../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a>  PetscMaxSum(<a href="../../../docs/manualpages/Sys/MPI_Comm.html#MPI_Comm">MPI_Comm</a> comm,const <a href="../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> sizes[],<a href="../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> *max,<a href="../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> *sum)</font></strong>
<a name="line220">220: </a>{

<a name="line224">224: </a><font color="#A020F0">#if defined(PETSC_HAVE_MPI_REDUCE_SCATTER_BLOCK)</font>
<a name="line225">225: </a>  {
<a name="line226">226: </a>    <font color="#4169E1">struct</font> {<a href="../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> max,sum;} work;
<a name="line227">227: </a>    <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Reduce_scatter_block.html#MPI_Reduce_scatter_block">MPI_Reduce_scatter_block</a>((void*)sizes,&amp;work,1,MPIU_2INT,PetscMaxSum_Op,comm);
<a name="line228">228: </a>    *max = work.max;
<a name="line229">229: </a>    *sum = work.sum;
<a name="line230">230: </a>  }
<a name="line231">231: </a><font color="#A020F0">#else</font>
<a name="line232">232: </a>  {
<a name="line233">233: </a>    <a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a>    size,rank;
<a name="line234">234: </a>    <font color="#4169E1">struct</font> {<a href="../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> max,sum;} *work;
<a name="line235">235: </a>    <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_size.html#MPI_Comm_size">MPI_Comm_size</a>(comm,&amp;size);
<a name="line236">236: </a>    <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_rank.html#MPI_Comm_rank">MPI_Comm_rank</a>(comm,&amp;rank);
<a name="line237">237: </a>    <a href="../../../docs/manualpages/Sys/PetscMalloc1.html#PetscMalloc1">PetscMalloc1</a>(size,&amp;work);
<a name="line238">238: </a>    MPIU_Allreduce((void*)sizes,work,size,MPIU_2INT,PetscMaxSum_Op,comm);
<a name="line239">239: </a>    *max = work[rank].max;
<a name="line240">240: </a>    *sum = work[rank].sum;
<a name="line241">241: </a>    <a href="../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</a>(work);
<a name="line242">242: </a>  }
<a name="line243">243: </a><font color="#A020F0">#endif</font>
<a name="line244">244: </a>  <font color="#4169E1">return</font>(0);
<a name="line245">245: </a>}

<a name="line247">247: </a><font color="#B22222">/* ----------------------------------------------------------------------------*/</font>

<a name="line249">249: </a><font color="#A020F0">#if (defined(PETSC_HAVE_COMPLEX) &amp;&amp; !defined(PETSC_HAVE_MPI_C_DOUBLE_COMPLEX)) || defined(PETSC_USE_REAL___FLOAT128)</font>
<a name="line250">250: </a>MPI_Op MPIU_SUM = 0;

<a name="line254">254: </a><strong><font color="#4169E1"><a name="PetscSum_Local"></a>PETSC_EXTERN void PetscSum_Local(void *in,void *out,<a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a> *cnt,MPI_Datatype *datatype)</font></strong>
<a name="line255">255: </a>{
<a name="line256">256: </a>  <a href="../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> i,count = *cnt;

<a name="line259">259: </a>  <font color="#4169E1">if</font> (*datatype == MPIU_REAL) {
<a name="line260">260: </a>    <a href="../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> *xin = (<a href="../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a>*)in,*xout = (<a href="../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a>*)out;
<a name="line261">261: </a>    <font color="#4169E1">for</font> (i=0; i&lt;count; i++) xout[i] += xin[i];
<a name="line262">262: </a>  }
<a name="line263">263: </a><font color="#A020F0">#if defined(PETSC_HAVE_COMPLEX)</font>
<a name="line264">264: </a>  <font color="#4169E1">else</font> <font color="#4169E1">if</font> (*datatype == MPIU_COMPLEX) {
<a name="line265">265: </a>    <a href="../../../docs/manualpages/Sys/PetscComplex.html#PetscComplex">PetscComplex</a> *xin = (<a href="../../../docs/manualpages/Sys/PetscComplex.html#PetscComplex">PetscComplex</a>*)in,*xout = (<a href="../../../docs/manualpages/Sys/PetscComplex.html#PetscComplex">PetscComplex</a>*)out;
<a name="line266">266: </a>    <font color="#4169E1">for</font> (i=0; i&lt;count; i++) xout[i] += xin[i];
<a name="line267">267: </a>  }
<a name="line268">268: </a><font color="#A020F0">#endif</font>
<a name="line269">269: </a>  <font color="#4169E1">else</font> {
<a name="line270">270: </a>    (*<a href="../../../docs/manualpages/Sys/PetscErrorPrintf.html#PetscErrorPrintf">PetscErrorPrintf</a>)(<font color="#666666">"Can only handle MPIU_REAL or MPIU_COMPLEX data types"</font>);
<a name="line271">271: </a>    <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Abort.html#MPI_Abort">MPI_Abort</a>(MPI_COMM_WORLD,1);
<a name="line272">272: </a>  }
<a name="line273">273: </a>  PetscFunctionReturnVoid();
<a name="line274">274: </a>}
<a name="line275">275: </a><font color="#A020F0">#endif</font>

<a name="line277">277: </a><font color="#A020F0">#if defined(PETSC_USE_REAL___FLOAT128)</font>
<a name="line278">278: </a>MPI_Op MPIU_MAX = 0;
<a name="line279">279: </a>MPI_Op MPIU_MIN = 0;

<a name="line283">283: </a><strong><font color="#4169E1"><a name="PetscMax_Local"></a>PETSC_EXTERN void PetscMax_Local(void *in,void *out,<a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a> *cnt,MPI_Datatype *datatype)</font></strong>
<a name="line284">284: </a>{
<a name="line285">285: </a>  <a href="../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> i,count = *cnt;

<a name="line288">288: </a>  <font color="#4169E1">if</font> (*datatype == MPIU_REAL) {
<a name="line289">289: </a>    <a href="../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> *xin = (<a href="../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a>*)in,*xout = (<a href="../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a>*)out;
<a name="line290">290: </a>    <font color="#4169E1">for</font> (i=0; i&lt;count; i++) xout[i] = <a href="../../../docs/manualpages/Sys/PetscMax.html#PetscMax">PetscMax</a>(xout[i],xin[i]);
<a name="line291">291: </a>  }
<a name="line292">292: </a><font color="#A020F0">#if defined(PETSC_HAVE_COMPLEX)</font>
<a name="line293">293: </a>  <font color="#4169E1">else</font> <font color="#4169E1">if</font> (*datatype == MPIU_COMPLEX) {
<a name="line294">294: </a>    <a href="../../../docs/manualpages/Sys/PetscComplex.html#PetscComplex">PetscComplex</a> *xin = (<a href="../../../docs/manualpages/Sys/PetscComplex.html#PetscComplex">PetscComplex</a>*)in,*xout = (<a href="../../../docs/manualpages/Sys/PetscComplex.html#PetscComplex">PetscComplex</a>*)out;
<a name="line295">295: </a>    <font color="#4169E1">for</font> (i=0; i&lt;count; i++) {
<a name="line296">296: </a>      xout[i] = PetscRealPartComplex(xout[i])&lt;PetscRealPartComplex(xin[i]) ? xin[i] : xout[i];
<a name="line297">297: </a>    }
<a name="line298">298: </a>  }
<a name="line299">299: </a><font color="#A020F0">#endif</font>
<a name="line300">300: </a>  <font color="#4169E1">else</font> {
<a name="line301">301: </a>    (*<a href="../../../docs/manualpages/Sys/PetscErrorPrintf.html#PetscErrorPrintf">PetscErrorPrintf</a>)(<font color="#666666">"Can only handle MPIU_REAL or MPIU_COMPLEX data types"</font>);
<a name="line302">302: </a>    <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Abort.html#MPI_Abort">MPI_Abort</a>(MPI_COMM_WORLD,1);
<a name="line303">303: </a>  }
<a name="line304">304: </a>  PetscFunctionReturnVoid();
<a name="line305">305: </a>}

<a name="line309">309: </a><strong><font color="#4169E1"><a name="PetscMin_Local"></a>PETSC_EXTERN void PetscMin_Local(void *in,void *out,<a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a> *cnt,MPI_Datatype *datatype)</font></strong>
<a name="line310">310: </a>{
<a name="line311">311: </a>  <a href="../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>    i,count = *cnt;

<a name="line314">314: </a>  <font color="#4169E1">if</font> (*datatype == MPIU_REAL) {
<a name="line315">315: </a>    <a href="../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> *xin = (<a href="../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a>*)in,*xout = (<a href="../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a>*)out;
<a name="line316">316: </a>    <font color="#4169E1">for</font> (i=0; i&lt;count; i++) xout[i] = <a href="../../../docs/manualpages/Sys/PetscMin.html#PetscMin">PetscMin</a>(xout[i],xin[i]);
<a name="line317">317: </a>  }
<a name="line318">318: </a><font color="#A020F0">#if defined(PETSC_HAVE_COMPLEX)</font>
<a name="line319">319: </a>  <font color="#4169E1">else</font> <font color="#4169E1">if</font> (*datatype == MPIU_COMPLEX) {
<a name="line320">320: </a>    <a href="../../../docs/manualpages/Sys/PetscComplex.html#PetscComplex">PetscComplex</a> *xin = (<a href="../../../docs/manualpages/Sys/PetscComplex.html#PetscComplex">PetscComplex</a>*)in,*xout = (<a href="../../../docs/manualpages/Sys/PetscComplex.html#PetscComplex">PetscComplex</a>*)out;
<a name="line321">321: </a>    <font color="#4169E1">for</font> (i=0; i&lt;count; i++) {
<a name="line322">322: </a>      xout[i] = PetscRealPartComplex(xout[i])&gt;PetscRealPartComplex(xin[i]) ? xin[i] : xout[i];
<a name="line323">323: </a>    }
<a name="line324">324: </a>  }
<a name="line325">325: </a><font color="#A020F0">#endif</font>
<a name="line326">326: </a>  <font color="#4169E1">else</font> {
<a name="line327">327: </a>    (*<a href="../../../docs/manualpages/Sys/PetscErrorPrintf.html#PetscErrorPrintf">PetscErrorPrintf</a>)(<font color="#666666">"Can only handle MPIU_REAL or <a href="../../../docs/manualpages/Sys/MPIU_SCALAR.html#MPIU_SCALAR">MPIU_SCALAR</a> data (i.e. double or complex) types"</font>);
<a name="line328">328: </a>    <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Abort.html#MPI_Abort">MPI_Abort</a>(MPI_COMM_WORLD,1);
<a name="line329">329: </a>  }
<a name="line330">330: </a>  PetscFunctionReturnVoid();
<a name="line331">331: </a>}
<a name="line332">332: </a><font color="#A020F0">#endif</font>

<a name="line336">336: </a><font color="#B22222">/*</font>
<a name="line337">337: </a><font color="#B22222">   Private routine to delete internal tag/name counter storage when a communicator is freed.</font>

<a name="line339">339: </a><font color="#B22222">   This is called by MPI, not by users. This is called by <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_free.html#MPI_Comm_free">MPI_Comm_free</a>() when the communicator that has this  data as an attribute is freed.</font>

<a name="line341">341: </a><font color="#B22222">   Note: this is declared extern "C" because it is passed to <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Keyval_create.html#MPI_Keyval_create">MPI_Keyval_create</a>()</font>

<a name="line343">343: </a><font color="#B22222">*/</font>
<a name="line344">344: </a><strong><font color="#4169E1"><a name="Petsc_DelCounter"></a>PETSC_EXTERN <a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a> MPIAPI Petsc_DelCounter(<a href="../../../docs/manualpages/Sys/MPI_Comm.html#MPI_Comm">MPI_Comm</a> comm,<a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a> keyval,void *count_val,void *extra_state)</font></strong>
<a name="line345">345: </a>{

<a name="line349">349: </a>  PetscInfo1(0,<font color="#666666">"Deleting counter data in an <a href="../../../docs/manualpages/Sys/MPI_Comm.html#MPI_Comm">MPI_Comm</a> %ld\n"</font>,(long)comm);<font color="#4169E1">if</font> (ierr) <a href="../../../docs/manualpages/Sys/PetscFunctionReturn.html#PetscFunctionReturn">PetscFunctionReturn</a>((<a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a>)ierr);
<a name="line350">350: </a>  <a href="../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</a>(count_val);<font color="#4169E1">if</font> (ierr) <a href="../../../docs/manualpages/Sys/PetscFunctionReturn.html#PetscFunctionReturn">PetscFunctionReturn</a>((<a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a>)ierr);
<a name="line351">351: </a>  <a href="../../../docs/manualpages/Sys/PetscFunctionReturn.html#PetscFunctionReturn">PetscFunctionReturn</a>(MPI_SUCCESS);
<a name="line352">352: </a>}

<a name="line356">356: </a><font color="#B22222">/*</font>
<a name="line357">357: </a><font color="#B22222">  This is invoked on the outer comm as a result of either <a href="../../../docs/manualpages/Sys/PetscCommDestroy.html#PetscCommDestroy">PetscCommDestroy</a>() (via <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Attr_delete.html#MPI_Attr_delete">MPI_Attr_delete</a>) or when the user</font>
<a name="line358">358: </a><font color="#B22222">  calls <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_free.html#MPI_Comm_free">MPI_Comm_free</a>().</font>

<a name="line360">360: </a><font color="#B22222">  This is the only entry point for breaking the links between inner and outer comms.</font>

<a name="line362">362: </a><font color="#B22222">  This is called by MPI, not by users. This is called when <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_free.html#MPI_Comm_free">MPI_Comm_free</a>() is called on the communicator.</font>

<a name="line364">364: </a><font color="#B22222">  Note: this is declared extern "C" because it is passed to <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Keyval_create.html#MPI_Keyval_create">MPI_Keyval_create</a>()</font>

<a name="line366">366: </a><font color="#B22222">*/</font>
<a name="line367">367: </a><strong><font color="#4169E1"><a name="Petsc_DelComm_Outer"></a>PETSC_EXTERN <a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a> MPIAPI Petsc_DelComm_Outer(<a href="../../../docs/manualpages/Sys/MPI_Comm.html#MPI_Comm">MPI_Comm</a> comm,<a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a> keyval,void *attr_val,void *extra_state)</font></strong>
<a name="line368">368: </a>{
<a name="line370">370: </a>  <a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a>    flg;
<a name="line371">371: </a>  <font color="#4169E1">union</font> {<a href="../../../docs/manualpages/Sys/MPI_Comm.html#MPI_Comm">MPI_Comm</a> comm; void *ptr;} icomm,ocomm;

<a name="line374">374: </a>  <font color="#4169E1">if</font> (keyval != Petsc_InnerComm_keyval) <a href="../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>,PETSC_ERR_ARG_CORRUPT,<font color="#666666">"Unexpected keyval"</font>);
<a name="line375">375: </a>  icomm.ptr = attr_val;

<a name="line377">377: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Attr_get.html#MPI_Attr_get">MPI_Attr_get</a>(icomm.comm,Petsc_OuterComm_keyval,&amp;ocomm,&amp;flg);
<a name="line378">378: </a>  <font color="#4169E1">if</font> (!flg) <a href="../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>,PETSC_ERR_ARG_CORRUPT,<font color="#666666">"Inner <a href="../../../docs/manualpages/Sys/MPI_Comm.html#MPI_Comm">MPI_Comm</a> does not have expected reference to outer comm"</font>);
<a name="line379">379: </a>  <font color="#4169E1">if</font> (ocomm.comm != comm) <a href="../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>,PETSC_ERR_ARG_CORRUPT,<font color="#666666">"Inner <a href="../../../docs/manualpages/Sys/MPI_Comm.html#MPI_Comm">MPI_Comm</a> has reference to non-matching outer comm"</font>);
<a name="line380">380: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Attr_delete.html#MPI_Attr_delete">MPI_Attr_delete</a>(icomm.comm,Petsc_OuterComm_keyval); <font color="#B22222">/* Calls Petsc_DelComm_Inner */</font>
<a name="line381">381: </a>  PetscInfo1(0,<font color="#666666">"User <a href="../../../docs/manualpages/Sys/MPI_Comm.html#MPI_Comm">MPI_Comm</a> %ld is being freed after removing reference from inner PETSc comm to this outer comm\n"</font>,(long)comm);<font color="#4169E1">if</font> (ierr) <a href="../../../docs/manualpages/Sys/PetscFunctionReturn.html#PetscFunctionReturn">PetscFunctionReturn</a>((<a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a>)ierr);
<a name="line382">382: </a>  <a href="../../../docs/manualpages/Sys/PetscFunctionReturn.html#PetscFunctionReturn">PetscFunctionReturn</a>(MPI_SUCCESS);
<a name="line383">383: </a>}

<a name="line387">387: </a><font color="#B22222">/*</font>
<a name="line388">388: </a><font color="#B22222"> * This is invoked on the inner comm when Petsc_DelComm_Outer calls <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Attr_delete.html#MPI_Attr_delete">MPI_Attr_delete</a>.  It should not be reached any other way.</font>
<a name="line389">389: </a><font color="#B22222"> */</font>
<a name="line390">390: </a><strong><font color="#4169E1"><a name="Petsc_DelComm_Inner"></a>PETSC_EXTERN <a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a> MPIAPI Petsc_DelComm_Inner(<a href="../../../docs/manualpages/Sys/MPI_Comm.html#MPI_Comm">MPI_Comm</a> comm,<a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a> keyval,void *attr_val,void *extra_state)</font></strong>
<a name="line391">391: </a>{

<a name="line395">395: </a>  PetscInfo1(0,<font color="#666666">"Removing reference to PETSc communicator embedded in a user <a href="../../../docs/manualpages/Sys/MPI_Comm.html#MPI_Comm">MPI_Comm</a> %ld\n"</font>,(long)comm);<font color="#4169E1">if</font> (ierr) <a href="../../../docs/manualpages/Sys/PetscFunctionReturn.html#PetscFunctionReturn">PetscFunctionReturn</a>((<a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a>)ierr);
<a name="line396">396: </a>  <a href="../../../docs/manualpages/Sys/PetscFunctionReturn.html#PetscFunctionReturn">PetscFunctionReturn</a>(MPI_SUCCESS);
<a name="line397">397: </a>}

<a name="line399">399: </a><font color="#A020F0">#if defined(PETSC_USE_PETSC_MPI_EXTERNAL32)</font>
<a name="line400">400: </a><font color="#A020F0">#if !defined(PETSC_WORDS_BIGENDIAN)</font>
<a name="line401">401: </a><strong><font color="#4169E1">PETSC_EXTERN <a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a> PetscDataRep_extent_fn(MPI_Datatype,MPI_Aint*,void*)</font></strong>;
<a name="line402">402: </a><strong><font color="#4169E1">PETSC_EXTERN <a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a> PetscDataRep_read_conv_fn(void*, MPI_Datatype,<a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a>,void*,MPI_Offset,void*)</font></strong>;
<a name="line403">403: </a><strong><font color="#4169E1">PETSC_EXTERN <a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a> PetscDataRep_write_conv_fn(void*, MPI_Datatype,<a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a>,void*,MPI_Offset,void*)</font></strong>;
<a name="line404">404: </a><font color="#A020F0">#endif</font>
<a name="line405">405: </a><font color="#A020F0">#endif</font>

<a name="line407">407: </a>int  PetscGlobalArgc   = 0;
<a name="line408">408: </a>char **PetscGlobalArgs = 0;
<a name="line409">409: </a><a href="../../../docs/manualpages/Sys/PetscSegBuffer.html#PetscSegBuffer">PetscSegBuffer</a> PetscCitationsList;

<a name="line413">413: </a><strong><font color="#4169E1"><a name="PetscCitationsInitialize"></a><a href="../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PetscCitationsInitialize()</font></strong>
<a name="line414">414: </a>{

<a name="line418">418: </a>  <a href="../../../docs/manualpages/Sys/PetscSegBufferCreate.html#PetscSegBufferCreate">PetscSegBufferCreate</a>(1,10000,&amp;PetscCitationsList);
<a name="line419">419: </a>  <a href="../../../docs/manualpages/Sys/PetscCitationsRegister.html#PetscCitationsRegister">PetscCitationsRegister</a>(<font color="#666666">"@TechReport{petsc-user-ref,\n  Author = {Satish Balay and Shrirang Abhyankar and Mark F. Adams and Jed Brown and Peter Brune\n            and Kris Buschelman and Lisandro Dalcin and Victor Eijkhout and William D. Gropp\n            and Dinesh Kaushik and Matthew G. Knepley\n            and Lois Curfman McInnes and Karl Rupp and Barry F. Smith\n            and Stefano Zampini and Hong Zhang and Hong Zhang},\n  Title = {{PETS}c Users Manual},\n  Number = {ANL-95/11 - Revision 3.7},\n  Institution = {Argonne National Laboratory},\n  Year = {2016}\n}\n"</font>,NULL);
<a name="line420">420: </a>  <a href="../../../docs/manualpages/Sys/PetscCitationsRegister.html#PetscCitationsRegister">PetscCitationsRegister</a>(<font color="#666666">"@InProceedings{petsc-efficient,\n  Author = {Satish Balay and William D. Gropp and Lois Curfman McInnes and Barry F. Smith},\n  Title = {Efficient Management of Parallelism in Object Oriented Numerical Software Libraries},\n  Booktitle = {Modern Software Tools in Scientific Computing},\n  Editor = {E. Arge and A. M. Bruaset and H. P. Langtangen},\n  Pages = {163--202},\n  Publisher = {Birkh{\\\"{a}}user Press},\n  Year = {1997}\n}\n"</font>,NULL);
<a name="line421">421: </a>  <font color="#4169E1">return</font>(0);
<a name="line422">422: </a>}

<a name="line426">426: </a><font color="#B22222">/*@C</font>
<a name="line427">427: </a><font color="#B22222">   <a href="../../../docs/manualpages/Sys/PetscGetArgs.html#PetscGetArgs">PetscGetArgs</a> - Allows you to access the raw command line arguments anywhere</font>
<a name="line428">428: </a><font color="#B22222">     after <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>() is called but before <a href="../../../docs/manualpages/Sys/PetscFinalize.html#PetscFinalize">PetscFinalize</a>().</font>

<a name="line430">430: </a><font color="#B22222">   Not Collective</font>

<a name="line432">432: </a><font color="#B22222">   Output Parameters:</font>
<a name="line433">433: </a><font color="#B22222">+  argc - count of number of command line arguments</font>
<a name="line434">434: </a><font color="#B22222">-  args - the command line arguments</font>

<a name="line436">436: </a><font color="#B22222">   Level: intermediate</font>

<a name="line438">438: </a><font color="#B22222">   Notes:</font>
<a name="line439">439: </a><font color="#B22222">      This is usually used to pass the command line arguments into other libraries</font>
<a name="line440">440: </a><font color="#B22222">   that are called internally deep in PETSc or the application.</font>

<a name="line442">442: </a><font color="#B22222">      The first argument contains the program name as is normal for C arguments.</font>

<a name="line444">444: </a><font color="#B22222">   Concepts: command line arguments</font>

<a name="line446">446: </a><font color="#B22222">.seealso: <a href="../../../docs/manualpages/Sys/PetscFinalize.html#PetscFinalize">PetscFinalize</a>(), <a href="../../../docs/manualpages/Sys/PetscInitializeFortran.html#PetscInitializeFortran">PetscInitializeFortran</a>(), <a href="../../../docs/manualpages/Sys/PetscGetArguments.html#PetscGetArguments">PetscGetArguments</a>()</font>

<a name="line448">448: </a><font color="#B22222">@*/</font>
<a name="line449">449: </a><strong><font color="#4169E1"><a name="PetscGetArgs"></a><a href="../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a>  <a href="../../../docs/manualpages/Sys/PetscGetArgs.html#PetscGetArgs">PetscGetArgs</a>(int *argc,char ***args)</font></strong>
<a name="line450">450: </a>{
<a name="line452">452: </a>  <font color="#4169E1">if</font> (!PetscInitializeCalled &amp;&amp; PetscFinalizeCalled) <a href="../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>,PETSC_ERR_ORDER,<font color="#666666">"You must call after <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>() but before <a href="../../../docs/manualpages/Sys/PetscFinalize.html#PetscFinalize">PetscFinalize</a>()"</font>);
<a name="line453">453: </a>  *argc = PetscGlobalArgc;
<a name="line454">454: </a>  *args = PetscGlobalArgs;
<a name="line455">455: </a>  <font color="#4169E1">return</font>(0);
<a name="line456">456: </a>}

<a name="line460">460: </a><font color="#B22222">/*@C</font>
<a name="line461">461: </a><font color="#B22222">   <a href="../../../docs/manualpages/Sys/PetscGetArguments.html#PetscGetArguments">PetscGetArguments</a> - Allows you to access the  command line arguments anywhere</font>
<a name="line462">462: </a><font color="#B22222">     after <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>() is called but before <a href="../../../docs/manualpages/Sys/PetscFinalize.html#PetscFinalize">PetscFinalize</a>().</font>

<a name="line464">464: </a><font color="#B22222">   Not Collective</font>

<a name="line466">466: </a><font color="#B22222">   Output Parameters:</font>
<a name="line467">467: </a><font color="#B22222">.  args - the command line arguments</font>

<a name="line469">469: </a><font color="#B22222">   Level: intermediate</font>

<a name="line471">471: </a><font color="#B22222">   Notes:</font>
<a name="line472">472: </a><font color="#B22222">      This does NOT start with the program name and <a href="../../../docs/manualpages/IS/IS.html#IS">IS</a> null terminated (final arg is void)</font>

<a name="line474">474: </a><font color="#B22222">   Concepts: command line arguments</font>

<a name="line476">476: </a><font color="#B22222">.seealso: <a href="../../../docs/manualpages/Sys/PetscFinalize.html#PetscFinalize">PetscFinalize</a>(), <a href="../../../docs/manualpages/Sys/PetscInitializeFortran.html#PetscInitializeFortran">PetscInitializeFortran</a>(), <a href="../../../docs/manualpages/Sys/PetscGetArgs.html#PetscGetArgs">PetscGetArgs</a>(), <a href="../../../docs/manualpages/Sys/PetscFreeArguments.html#PetscFreeArguments">PetscFreeArguments</a>()</font>

<a name="line478">478: </a><font color="#B22222">@*/</font>
<a name="line479">479: </a><strong><font color="#4169E1"><a name="PetscGetArguments"></a><a href="../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a>  <a href="../../../docs/manualpages/Sys/PetscGetArguments.html#PetscGetArguments">PetscGetArguments</a>(char ***args)</font></strong>
<a name="line480">480: </a>{
<a name="line481">481: </a>  <a href="../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>       i,argc = PetscGlobalArgc;

<a name="line485">485: </a>  <font color="#4169E1">if</font> (!PetscInitializeCalled &amp;&amp; PetscFinalizeCalled) <a href="../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>,PETSC_ERR_ORDER,<font color="#666666">"You must call after <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>() but before <a href="../../../docs/manualpages/Sys/PetscFinalize.html#PetscFinalize">PetscFinalize</a>()"</font>);
<a name="line486">486: </a>  <font color="#4169E1">if</font> (!argc) {*args = 0; <font color="#4169E1">return</font>(0);}
<a name="line487">487: </a>  <a href="../../../docs/manualpages/Sys/PetscMalloc1.html#PetscMalloc1">PetscMalloc1</a>(argc,args);
<a name="line488">488: </a>  <font color="#4169E1">for</font> (i=0; i&lt;argc-1; i++) {
<a name="line489">489: </a>    <a href="../../../docs/manualpages/Sys/PetscStrallocpy.html#PetscStrallocpy">PetscStrallocpy</a>(PetscGlobalArgs[i+1],&amp;(*args)[i]);
<a name="line490">490: </a>  }
<a name="line491">491: </a>  (*args)[argc-1] = 0;
<a name="line492">492: </a>  <font color="#4169E1">return</font>(0);
<a name="line493">493: </a>}

<a name="line497">497: </a><font color="#B22222">/*@C</font>
<a name="line498">498: </a><font color="#B22222">   <a href="../../../docs/manualpages/Sys/PetscFreeArguments.html#PetscFreeArguments">PetscFreeArguments</a> - Frees the memory obtained with <a href="../../../docs/manualpages/Sys/PetscGetArguments.html#PetscGetArguments">PetscGetArguments</a>()</font>

<a name="line500">500: </a><font color="#B22222">   Not Collective</font>

<a name="line502">502: </a><font color="#B22222">   Output Parameters:</font>
<a name="line503">503: </a><font color="#B22222">.  args - the command line arguments</font>

<a name="line505">505: </a><font color="#B22222">   Level: intermediate</font>

<a name="line507">507: </a><font color="#B22222">   Concepts: command line arguments</font>

<a name="line509">509: </a><font color="#B22222">.seealso: <a href="../../../docs/manualpages/Sys/PetscFinalize.html#PetscFinalize">PetscFinalize</a>(), <a href="../../../docs/manualpages/Sys/PetscInitializeFortran.html#PetscInitializeFortran">PetscInitializeFortran</a>(), <a href="../../../docs/manualpages/Sys/PetscGetArgs.html#PetscGetArgs">PetscGetArgs</a>(), <a href="../../../docs/manualpages/Sys/PetscGetArguments.html#PetscGetArguments">PetscGetArguments</a>()</font>

<a name="line511">511: </a><font color="#B22222">@*/</font>
<a name="line512">512: </a><strong><font color="#4169E1"><a name="PetscFreeArguments"></a><a href="../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a>  <a href="../../../docs/manualpages/Sys/PetscFreeArguments.html#PetscFreeArguments">PetscFreeArguments</a>(char **args)</font></strong>
<a name="line513">513: </a>{
<a name="line514">514: </a>  <a href="../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>       i = 0;

<a name="line518">518: </a>  <font color="#4169E1">if</font> (!args) <font color="#4169E1">return</font>(0);
<a name="line519">519: </a>  <font color="#4169E1">while</font> (args[i]) {
<a name="line520">520: </a>    <a href="../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</a>(args[i]);
<a name="line521">521: </a>    i++;
<a name="line522">522: </a>  }
<a name="line523">523: </a>  <a href="../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</a>(args);
<a name="line524">524: </a>  <font color="#4169E1">return</font>(0);
<a name="line525">525: </a>}

<a name="line527">527: </a><font color="#A020F0">#if defined(PETSC_HAVE_SAWS)</font>
<a name="line528">528: </a><font color="#A020F0">#include &lt;petscconfiginfo.h&gt;</font>

<a name="line532">532: </a><strong><font color="#4169E1"><a name="PetscInitializeSAWs"></a><a href="../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a>  PetscInitializeSAWs(const char help[])</font></strong>
<a name="line533">533: </a>{
<a name="line534">534: </a>  <font color="#4169E1">if</font> (!PetscGlobalRank) {
<a name="line535">535: </a>    char           cert[PETSC_MAX_PATH_LEN],root[PETSC_MAX_PATH_LEN],*intro,programname[64],*appline,*options,version[64];
<a name="line536">536: </a>    int            port;
<a name="line537">537: </a>    <a href="../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a>      flg,rootlocal = <a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>,flg2,selectport = <a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line538">538: </a>    size_t         applinelen,introlen;
<a name="line540">540: </a>    char           sawsurl[256];

<a name="line542">542: </a>    <a href="../../../docs/manualpages/Sys/PetscOptionsHasName.html#PetscOptionsHasName">PetscOptionsHasName</a>(NULL,NULL,<font color="#666666">"-saws_log"</font>,&amp;flg);
<a name="line543">543: </a>    <font color="#4169E1">if</font> (flg) {
<a name="line544">544: </a>      char  sawslog[PETSC_MAX_PATH_LEN];

<a name="line546">546: </a>      <a href="../../../docs/manualpages/Sys/PetscOptionsGetString.html#PetscOptionsGetString">PetscOptionsGetString</a>(NULL,NULL,<font color="#666666">"-saws_log"</font>,sawslog,PETSC_MAX_PATH_LEN,NULL);
<a name="line547">547: </a>      <font color="#4169E1">if</font> (sawslog[0]) {
<a name="line548">548: </a>        PetscStackCallSAWs(SAWs_Set_Use_Logfile,(sawslog));
<a name="line549">549: </a>      } <font color="#4169E1">else</font> {
<a name="line550">550: </a>        PetscStackCallSAWs(SAWs_Set_Use_Logfile,(NULL));
<a name="line551">551: </a>      }
<a name="line552">552: </a>    }
<a name="line553">553: </a>    <a href="../../../docs/manualpages/Sys/PetscOptionsGetString.html#PetscOptionsGetString">PetscOptionsGetString</a>(NULL,NULL,<font color="#666666">"-saws_https"</font>,cert,PETSC_MAX_PATH_LEN,&amp;flg);
<a name="line554">554: </a>    <font color="#4169E1">if</font> (flg) {
<a name="line555">555: </a>      PetscStackCallSAWs(SAWs_Set_Use_HTTPS,(cert));
<a name="line556">556: </a>    }
<a name="line557">557: </a>    <a href="../../../docs/manualpages/Sys/PetscOptionsGetBool.html#PetscOptionsGetBool">PetscOptionsGetBool</a>(NULL,NULL,<font color="#666666">"-saws_port_auto_select"</font>,&amp;selectport,NULL);
<a name="line558">558: </a>    <font color="#4169E1">if</font> (selectport) {
<a name="line559">559: </a>        PetscStackCallSAWs(SAWs_Get_Available_Port,(&amp;port));
<a name="line560">560: </a>        PetscStackCallSAWs(SAWs_Set_Port,(port));
<a name="line561">561: </a>    } <font color="#4169E1">else</font> {
<a name="line562">562: </a>      <a href="../../../docs/manualpages/Sys/PetscOptionsGetInt.html#PetscOptionsGetInt">PetscOptionsGetInt</a>(NULL,NULL,<font color="#666666">"-saws_port"</font>,&amp;port,&amp;flg);
<a name="line563">563: </a>      <font color="#4169E1">if</font> (flg) {
<a name="line564">564: </a>        PetscStackCallSAWs(SAWs_Set_Port,(port));
<a name="line565">565: </a>      }
<a name="line566">566: </a>    }
<a name="line567">567: </a>    <a href="../../../docs/manualpages/Sys/PetscOptionsGetString.html#PetscOptionsGetString">PetscOptionsGetString</a>(NULL,NULL,<font color="#666666">"-saws_root"</font>,root,PETSC_MAX_PATH_LEN,&amp;flg);
<a name="line568">568: </a>    <font color="#4169E1">if</font> (flg) {
<a name="line569">569: </a>      PetscStackCallSAWs(SAWs_Set_Document_Root,(root));
<a name="line570">570: </a>      <a href="../../../docs/manualpages/Sys/PetscStrcmp.html#PetscStrcmp">PetscStrcmp</a>(root,<font color="#666666">"."</font>,&amp;rootlocal);
<a name="line571">571: </a>    } <font color="#4169E1">else</font> {
<a name="line572">572: </a>      <a href="../../../docs/manualpages/Sys/PetscOptionsHasName.html#PetscOptionsHasName">PetscOptionsHasName</a>(NULL,NULL,<font color="#666666">"-saws_options"</font>,&amp;flg);
<a name="line573">573: </a>      <font color="#4169E1">if</font> (flg) {
<a name="line574">574: </a>        <a href="../../../docs/manualpages/Sys/PetscStrreplace.html#PetscStrreplace">PetscStrreplace</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,<font color="#666666">"${PETSC_DIR}/share/petsc/saws"</font>,root,PETSC_MAX_PATH_LEN);
<a name="line575">575: </a>        PetscStackCallSAWs(SAWs_Set_Document_Root,(root));
<a name="line576">576: </a>      }
<a name="line577">577: </a>    }
<a name="line578">578: </a>    <a href="../../../docs/manualpages/Sys/PetscOptionsHasName.html#PetscOptionsHasName">PetscOptionsHasName</a>(NULL,NULL,<font color="#666666">"-saws_local"</font>,&amp;flg2);
<a name="line579">579: </a>    <font color="#4169E1">if</font> (flg2) {
<a name="line580">580: </a>      char jsdir[PETSC_MAX_PATH_LEN];
<a name="line581">581: </a>      <font color="#4169E1">if</font> (!flg) <a href="../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>,PETSC_ERR_SUP,<font color="#666666">"-saws_local option requires -saws_root option"</font>);
<a name="line582">582: </a>      <a href="../../../docs/manualpages/Sys/PetscSNPrintf.html#PetscSNPrintf">PetscSNPrintf</a>(jsdir,PETSC_MAX_PATH_LEN,<font color="#666666">"%s/js"</font>,root);
<a name="line583">583: </a>      PetscTestDirectory(jsdir,'r',&amp;flg);
<a name="line584">584: </a>      <font color="#4169E1">if</font> (!flg) <a href="../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>,PETSC_ERR_FILE_READ,<font color="#666666">"-saws_local option requires js directory in root directory"</font>);
<a name="line585">585: </a>      PetscStackCallSAWs(SAWs_Push_Local_Header,());
<a name="line586">586: </a>    }
<a name="line587">587: </a>    <a href="../../../docs/manualpages/Sys/PetscGetProgramName.html#PetscGetProgramName">PetscGetProgramName</a>(programname,64);
<a name="line588">588: </a>    <a href="../../../docs/manualpages/Sys/PetscStrlen.html#PetscStrlen">PetscStrlen</a>(help,&amp;applinelen);
<a name="line589">589: </a>    introlen   = 4096 + applinelen;
<a name="line590">590: </a>    applinelen += 1024;
<a name="line591">591: </a>    <a href="../../../docs/manualpages/Sys/PetscMalloc.html#PetscMalloc">PetscMalloc</a>(applinelen,&amp;appline);
<a name="line592">592: </a>    <a href="../../../docs/manualpages/Sys/PetscMalloc.html#PetscMalloc">PetscMalloc</a>(introlen,&amp;intro);

<a name="line594">594: </a>    <font color="#4169E1">if</font> (rootlocal) {
<a name="line595">595: </a>      <a href="../../../docs/manualpages/Sys/PetscSNPrintf.html#PetscSNPrintf">PetscSNPrintf</a>(appline,applinelen,<font color="#666666">"%s.c.html"</font>,programname);
<a name="line596">596: </a>      PetscTestFile(appline,'r',&amp;rootlocal);
<a name="line597">597: </a>    }
<a name="line598">598: </a>    <a href="../../../docs/manualpages/Sys/PetscOptionsGetAll.html#PetscOptionsGetAll">PetscOptionsGetAll</a>(NULL,&amp;options);
<a name="line599">599: </a>    <font color="#4169E1">if</font> (rootlocal &amp;&amp; help) {
<a name="line600">600: </a>      <a href="../../../docs/manualpages/Sys/PetscSNPrintf.html#PetscSNPrintf">PetscSNPrintf</a>(appline,applinelen,<font color="#666666">"&lt;center&gt; Running &lt;a href=\"%s.c.html\"&gt;%s&lt;/a&gt; %s&lt;/center&gt;&lt;br&gt;&lt;center&gt;&lt;pre&gt;%s&lt;/pre&gt;&lt;/center&gt;&lt;br&gt;\n"</font>,programname,programname,options,help);
<a name="line601">601: </a>    } <font color="#4169E1">else</font> <font color="#4169E1">if</font> (help) {
<a name="line602">602: </a>      <a href="../../../docs/manualpages/Sys/PetscSNPrintf.html#PetscSNPrintf">PetscSNPrintf</a>(appline,applinelen,<font color="#666666">"&lt;center&gt;Running %s %s&lt;/center&gt;&lt;br&gt;&lt;center&gt;&lt;pre&gt;%s&lt;/pre&gt;&lt;/center&gt;&lt;br&gt;"</font>,programname,options,help);
<a name="line603">603: </a>    } <font color="#4169E1">else</font> {
<a name="line604">604: </a>      <a href="../../../docs/manualpages/Sys/PetscSNPrintf.html#PetscSNPrintf">PetscSNPrintf</a>(appline,applinelen,<font color="#666666">"&lt;center&gt; Running %s %s&lt;/center&gt;&lt;br&gt;\n"</font>,programname,options);
<a name="line605">605: </a>    }
<a name="line606">606: </a>    <a href="../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</a>(options);
<a name="line607">607: </a>    <a href="../../../docs/manualpages/Sys/PetscGetVersion.html#PetscGetVersion">PetscGetVersion</a>(version,<font color="#4169E1">sizeof</font>(version));
<a name="line608">608: </a>    <a href="../../../docs/manualpages/Sys/PetscSNPrintf.html#PetscSNPrintf">PetscSNPrintf</a>(intro,introlen,<font color="#666666">"&lt;body&gt;\n"</font>
<a name="line609">609: </a>                                    <font color="#666666">"&lt;center&gt;&lt;h2&gt; &lt;a href=\"http://www.mcs.anl.gov/petsc\"&gt;PETSc&lt;/a&gt; Application Web server powered by &lt;a href=\"https://bitbucket.org/saws/saws\"&gt;SAWs&lt;/a&gt; &lt;/h2&gt;&lt;/center&gt;\n"</font>
<a name="line610">610: </a>                                    <font color="#666666">"&lt;center&gt;This is the default PETSc application dashboard, from it you can access any published PETSc objects or logging data&lt;/center&gt;&lt;br&gt;&lt;center&gt;%s configured with %s&lt;/center&gt;&lt;br&gt;\n"</font>
<a name="line611">611: </a>                                    <font color="#666666">"%s"</font>,version,petscconfigureoptions,appline);
<a name="line612">612: </a>    PetscStackCallSAWs(SAWs_Push_Body,(<font color="#666666">"index.html"</font>,0,intro));
<a name="line613">613: </a>    <a href="../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</a>(intro);
<a name="line614">614: </a>    <a href="../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</a>(appline);
<a name="line615">615: </a>    PetscStackCallSAWs(SAWs_Initialize,());
<a name="line616">616: </a>    <font color="#4169E1">if</font> (selectport) {
<a name="line617">617: </a>      PetscStackCallSAWs(SAWs_Get_FullURL,(<font color="#4169E1">sizeof</font>(sawsurl),sawsurl));
<a name="line618">618: </a>      <a href="../../../docs/manualpages/Sys/PetscPrintf.html#PetscPrintf">PetscPrintf</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,<font color="#666666">"Point your browser to %s for SAWs\n"</font>,sawsurl);
<a name="line619">619: </a>    }
<a name="line620">620: </a>    <a href="../../../docs/manualpages/Sys/PetscCitationsRegister.html#PetscCitationsRegister">PetscCitationsRegister</a>(<font color="#666666">"@TechReport{ saws,\n"</font>
<a name="line621">621: </a>                                  <font color="#666666">"  Author = {Matt Otten and Jed Brown and Barry Smith},\n"</font>
<a name="line622">622: </a>                                  <font color="#666666">"  Title  = {Scientific Application Web Server (SAWs) Users Manual},\n"</font>
<a name="line623">623: </a>                                  <font color="#666666">"  Institution = {Argonne National Laboratory},\n"</font>
<a name="line624">624: </a>                                  <font color="#666666">"  Year   = 2013\n}\n"</font>,NULL);
<a name="line625">625: </a>  }
<a name="line626">626: </a>  <font color="#4169E1">return</font>(0);
<a name="line627">627: </a>}
<a name="line628">628: </a><font color="#A020F0">#endif</font>

<a name="line632">632: </a><font color="#B22222">/*@C</font>
<a name="line633">633: </a><font color="#B22222">   <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a> - Initializes the PETSc database and MPI.</font>
<a name="line634">634: </a><font color="#B22222">   <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>() calls <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Init.html#MPI_Init">MPI_Init</a>() if that has yet to be called,</font>
<a name="line635">635: </a><font color="#B22222">   so this routine should always be called near the beginning of</font>
<a name="line636">636: </a><font color="#B22222">   your program -- usually the very first line!</font>

<a name="line638">638: </a><font color="#B22222">   Collective on MPI_COMM_WORLD or <a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a> if it has been set</font>

<a name="line640">640: </a><font color="#B22222">   Input Parameters:</font>
<a name="line641">641: </a><font color="#B22222">+  argc - count of number of command line arguments</font>
<a name="line642">642: </a><font color="#B22222">.  args - the command line arguments</font>
<a name="line643">643: </a><font color="#B22222">.  file - [optional] PETSc database file, also checks ~username/.petscrc and .petscrc use NULL to not check for</font>
<a name="line644">644: </a><font color="#B22222">          code specific file. Use -skip_petscrc in the code specific file to skip the .petscrc files</font>
<a name="line645">645: </a><font color="#B22222">-  help - [optional] Help message to print, use NULL for no message</font>

<a name="line647">647: </a><font color="#B22222">   If you wish PETSc code to run ONLY on a subcommunicator of MPI_COMM_WORLD, create that</font>
<a name="line648">648: </a><font color="#B22222">   communicator first and assign it to <a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a> BEFORE calling <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>(). Thus if you are running a</font>
<a name="line649">649: </a><font color="#B22222">   four process job and two processes will run PETSc and have <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>() and <a href="../../../docs/manualpages/Sys/PetscFinalize.html#PetscFinalize">PetscFinalize</a>() and two process will not,</font>
<a name="line650">650: </a><font color="#B22222">   then do this. If ALL processes in the job are using <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>() and <a href="../../../docs/manualpages/Sys/PetscFinalize.html#PetscFinalize">PetscFinalize</a>() then you don't need to do this, even</font>
<a name="line651">651: </a><font color="#B22222">   if different subcommunicators of the job are doing different things with PETSc.</font>

<a name="line653">653: </a><font color="#B22222">   Options Database Keys:</font>
<a name="line654">654: </a><font color="#B22222">+  -start_in_debugger [noxterm,dbx,xdb,gdb,...] - Starts program in debugger</font>
<a name="line655">655: </a><font color="#B22222">.  -on_error_attach_debugger [noxterm,dbx,xdb,gdb,...] - Starts debugger when error detected</font>
<a name="line656">656: </a><font color="#B22222">.  -on_error_emacs &lt;machinename&gt; causes emacsclient to jump to error file</font>
<a name="line657">657: </a><font color="#B22222">.  -on_error_abort calls abort() when error detected (no traceback)</font>
<a name="line658">658: </a><font color="#B22222">.  -on_error_mpiabort calls MPI_abort() when error detected</font>
<a name="line659">659: </a><font color="#B22222">.  -error_output_stderr prints error messages to stderr instead of the default stdout</font>
<a name="line660">660: </a><font color="#B22222">.  -error_output_none does not print the error messages (but handles errors in the same way as if this was not called)</font>
<a name="line661">661: </a><font color="#B22222">.  -debugger_nodes [node1,node2,...] - Indicates nodes to start in debugger</font>
<a name="line662">662: </a><font color="#B22222">.  -debugger_pause [sleeptime] (in seconds) - Pauses debugger</font>
<a name="line663">663: </a><font color="#B22222">.  -stop_for_debugger - Print message on how to attach debugger manually to</font>
<a name="line664">664: </a><font color="#B22222">                        process and wait (-debugger_pause) seconds for attachment</font>
<a name="line665">665: </a><font color="#B22222">.  -malloc - Indicates use of PETSc error-checking malloc (on by default for debug version of libraries)</font>
<a name="line666">666: </a><font color="#B22222">.  -malloc no - Indicates not to use error-checking malloc</font>
<a name="line667">667: </a><font color="#B22222">.  -malloc_debug - check for memory corruption at EVERY malloc or free</font>
<a name="line668">668: </a><font color="#B22222">.  -malloc_dump - prints a list of all unfreed memory at the end of the run</font>
<a name="line669">669: </a><font color="#B22222">.  -malloc_test - like -malloc_dump -malloc_debug, but only active for debugging builds</font>
<a name="line670">670: </a><font color="#B22222">.  -fp_trap - Stops on floating point exceptions (Note that on the</font>
<a name="line671">671: </a><font color="#B22222">              IBM RS6000 this slows code by at least a factor of 10.)</font>
<a name="line672">672: </a><font color="#B22222">.  -no_signal_handler - Indicates not to trap error signals</font>
<a name="line673">673: </a><font color="#B22222">.  -shared_tmp - indicates /tmp directory is shared by all processors</font>
<a name="line674">674: </a><font color="#B22222">.  -not_shared_tmp - each processor has own /tmp</font>
<a name="line675">675: </a><font color="#B22222">.  -tmp - alternative name of /tmp directory</font>
<a name="line676">676: </a><font color="#B22222">.  -get_total_flops - returns total flops done by all processors</font>
<a name="line677">677: </a><font color="#B22222">-  -memory_view - Print memory usage at end of run</font>

<a name="line679">679: </a><font color="#B22222">   Options Database Keys for Profiling:</font>
<a name="line680">680: </a><font color="#B22222">   See Users-Manual: <a href="../../../docs/manualpages/../manual.pdf#chapter.13">Chapter 13 Profiling</a> for details.</font>
<a name="line681">681: </a><font color="#B22222">+  -info &lt;optional filename&gt; - Prints verbose information to the screen</font>
<a name="line682">682: </a><font color="#B22222">.  -info_exclude &lt;null,vec,mat,pc,ksp,snes,ts&gt; - Excludes some of the verbose messages</font>
<a name="line683">683: </a><font color="#B22222">.  -log_sync - Log the synchronization in scatters, inner products and norms</font>
<a name="line684">684: </a><font color="#B22222">.  -log_trace [filename] - Print traces of all PETSc calls to the screen (useful to determine where a program</font>
<a name="line685">685: </a><font color="#B22222">        hangs without running in the debugger).  See <a href="../../../docs/manualpages/Profiling/PetscLogTraceBegin.html#PetscLogTraceBegin">PetscLogTraceBegin</a>().</font>
<a name="line686">686: </a><font color="#B22222">.  -log_view [:filename:format] - Prints summary of flop and timing information to screen or file, see <a href="../../../docs/manualpages/Profiling/PetscLogView.html#PetscLogView">PetscLogView</a>().</font>
<a name="line687">687: </a><font color="#B22222">.  -log_summary [filename] - (Deprecated, use -log_view) Prints summary of flop and timing information to screen. If the filename is specified the</font>
<a name="line688">688: </a><font color="#B22222">        summary is written to the file.  See <a href="../../../docs/manualpages/Profiling/PetscLogView.html#PetscLogView">PetscLogView</a>().</font>
<a name="line689">689: </a><font color="#B22222">.  -log_exclude: &lt;vec,mat,pc.ksp,snes&gt; - excludes subset of object classes from logging</font>
<a name="line690">690: </a><font color="#B22222">.  -log_all [filename] - Logs extensive profiling information  See <a href="../../../docs/manualpages/Profiling/PetscLogDump.html#PetscLogDump">PetscLogDump</a>().</font>
<a name="line691">691: </a><font color="#B22222">.  -log [filename] - Logs basic profiline information  See <a href="../../../docs/manualpages/Profiling/PetscLogDump.html#PetscLogDump">PetscLogDump</a>().</font>
<a name="line692">692: </a><font color="#B22222">-  -log_mpe [filename] - Creates a logfile viewable by the utility Jumpshot (in MPICH distribution)</font>

<a name="line694">694: </a><font color="#B22222">    Only one of -log_trace, -log_view, -log_summary, -log_all, -log, or -log_mpe may be used at a time</font>

<a name="line696">696: </a><font color="#B22222">   Options Database Keys for SAWs:</font>
<a name="line697">697: </a><font color="#B22222">+  -saws_port &lt;portnumber&gt; - port number to publish SAWs data, default is 8080</font>
<a name="line698">698: </a><font color="#B22222">.  -saws_port_auto_select - have SAWs select a new unique port number where it publishes the data, the URL is printed to the screen</font>
<a name="line699">699: </a><font color="#B22222">                            this is useful when you are running many jobs that utilize SAWs at the same time</font>
<a name="line700">700: </a><font color="#B22222">.  -saws_log &lt;filename&gt; - save a log of all SAWs communication</font>
<a name="line701">701: </a><font color="#B22222">.  -saws_https &lt;certificate file&gt; - have SAWs use HTTPS instead of HTTP</font>
<a name="line702">702: </a><font color="#B22222">-  -saws_root &lt;directory&gt; - allow SAWs to have access to the given directory to search for requested resources and files</font>

<a name="line704">704: </a><font color="#B22222">   Environmental Variables:</font>
<a name="line705">705: </a><font color="#B22222">+   PETSC_TMP - alternative tmp directory</font>
<a name="line706">706: </a><font color="#B22222">.   PETSC_SHARED_TMP - tmp is shared by all processes</font>
<a name="line707">707: </a><font color="#B22222">.   PETSC_NOT_SHARED_TMP - each process has its own private tmp</font>
<a name="line708">708: </a><font color="#B22222">.   PETSC_VIEWER_SOCKET_PORT - socket number to use for socket viewer</font>
<a name="line709">709: </a><font color="#B22222">-   PETSC_VIEWER_SOCKET_MACHINE - machine to use for socket viewer to connect to</font>


<a name="line712">712: </a><font color="#B22222">   Level: beginner</font>

<a name="line714">714: </a><font color="#B22222">   Notes:</font>
<a name="line715">715: </a><font color="#B22222">   If for some reason you must call <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Init.html#MPI_Init">MPI_Init</a>() separately, call</font>
<a name="line716">716: </a><font color="#B22222">   it before <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>().</font>

<a name="line718">718: </a><font color="#B22222">   Fortran Version:</font>
<a name="line719">719: </a><font color="#B22222">   In Fortran this routine has the format</font>
<a name="line720">720: </a><font color="#B22222">$       call <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>(file,ierr)</font>

<a name="line722">722: </a><font color="#B22222">+   ierr - error return code</font>
<a name="line723">723: </a><font color="#B22222">-  file - [optional] PETSc database file, also checks ~username/.petscrc and .petscrc use PETSC_NULL_CHARACTER to not check for</font>
<a name="line724">724: </a><font color="#B22222">          code specific file. Use -skip_petscrc in the code specific file to skip the .petscrc files</font>

<a name="line726">726: </a><font color="#B22222">   Important Fortran Note:</font>
<a name="line727">727: </a><font color="#B22222">   In Fortran, you MUST use PETSC_NULL_CHARACTER to indicate a</font>
<a name="line728">728: </a><font color="#B22222">   null character string; you CANNOT just use NULL as</font>
<a name="line729">729: </a><font color="#B22222">   in the C version. See Users-Manual: <a href="../../../docs/manualpages/../manual.pdf#chapter.12">Chapter 12 PETSc for Fortran Users</a> for details.</font>

<a name="line731">731: </a><font color="#B22222">   If your main program is C but you call Fortran code that also uses PETSc you need to call <a href="../../../docs/manualpages/Sys/PetscInitializeFortran.html#PetscInitializeFortran">PetscInitializeFortran</a>() soon after</font>
<a name="line732">732: </a><font color="#B22222">   calling <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>().</font>

<a name="line734">734: </a><font color="#B22222">   Concepts: initializing PETSc</font>

<a name="line736">736: </a><font color="#B22222">.seealso: <a href="../../../docs/manualpages/Sys/PetscFinalize.html#PetscFinalize">PetscFinalize</a>(), <a href="../../../docs/manualpages/Sys/PetscInitializeFortran.html#PetscInitializeFortran">PetscInitializeFortran</a>(), <a href="../../../docs/manualpages/Sys/PetscGetArgs.html#PetscGetArgs">PetscGetArgs</a>(), <a href="../../../docs/manualpages/Sys/PetscInitializeNoArguments.html#PetscInitializeNoArguments">PetscInitializeNoArguments</a>()</font>

<a name="line738">738: </a><font color="#B22222">@*/</font>
<a name="line739">739: </a><strong><font color="#4169E1"><a name="PetscInitialize"></a><a href="../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a>  <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>(int *argc,char ***args,const char file[],const char help[])</font></strong>
<a name="line740">740: </a>{
<a name="line742">742: </a>  <a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a>    flag, size;
<a name="line743">743: </a>  <a href="../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a>      flg;
<a name="line744">744: </a>  char           hostname[256];
<a name="line745">745: </a><font color="#A020F0">#if defined(PETSC_HAVE_CUDA)</font>
<a name="line746">746: </a>  cublasStatus_t cberr;
<a name="line747">747: </a><font color="#A020F0">#endif</font>

<a name="line750">750: </a>  <font color="#4169E1">if</font> (PetscInitializeCalled) <font color="#4169E1">return</font>(0);

<a name="line752">752: </a>  <font color="#B22222">/* these must be initialized in a routine, not as a constant declaration*/</font>
<a name="line753">753: </a>  PETSC_STDOUT = stdout;
<a name="line754">754: </a>  PETSC_STDERR = stderr;

<a name="line756">756: </a>  <font color="#B22222">/* on Windows - set printf to default to printing 2 digit exponents */</font>
<a name="line757">757: </a><font color="#A020F0">#if defined(PETSC_HAVE__SET_OUTPUT_FORMAT)</font>
<a name="line758">758: </a>  _set_output_format(_TWO_DIGIT_EXPONENT);
<a name="line759">759: </a><font color="#A020F0">#endif</font>

<a name="line761">761: </a>  PetscOptionsCreateDefault();

<a name="line763">763: </a>  <font color="#B22222">/*</font>
<a name="line764">764: </a><font color="#B22222">     We initialize the program name here (before <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Init.html#MPI_Init">MPI_Init</a>()) because MPICH has a bug in</font>
<a name="line765">765: </a><font color="#B22222">     it that it sets args[0] on all processors to be args[0] on the first processor.</font>
<a name="line766">766: </a><font color="#B22222">  */</font>
<a name="line767">767: </a>  <font color="#4169E1">if</font> (argc &amp;&amp; *argc) {
<a name="line768">768: </a>    PetscSetProgramName(**args);
<a name="line769">769: </a>  } <font color="#4169E1">else</font> {
<a name="line770">770: </a>    PetscSetProgramName(<font color="#666666">"Unknown Name"</font>);
<a name="line771">771: </a>  }

<a name="line773">773: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Initialized.html#MPI_Initialized">MPI_Initialized</a>(&amp;flag);
<a name="line774">774: </a>  <font color="#4169E1">if</font> (!flag) {
<a name="line775">775: </a>    <font color="#4169E1">if</font> (<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a> != MPI_COMM_NULL) <a href="../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>,PETSC_ERR_SUP,<font color="#666666">"You cannot set <a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a> if you have not initialized MPI first"</font>);
<a name="line776">776: </a><font color="#A020F0">#if defined(PETSC_HAVE_MPI_INIT_THREAD)</font>
<a name="line777">777: </a>    {
<a name="line778">778: </a>      <a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a> provided;
<a name="line779">779: </a>      <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Init_thread.html#MPI_Init_thread">MPI_Init_thread</a>(argc,args,MPI_THREAD_FUNNELED,&amp;provided);
<a name="line780">780: </a>    }
<a name="line781">781: </a><font color="#A020F0">#else</font>
<a name="line782">782: </a>    <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Init.html#MPI_Init">MPI_Init</a>(argc,args);
<a name="line783">783: </a><font color="#A020F0">#endif</font>
<a name="line784">784: </a>    PetscBeganMPI = <a href="../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line785">785: </a>  }
<a name="line786">786: </a>  <font color="#4169E1">if</font> (argc &amp;&amp; args) {
<a name="line787">787: </a>    PetscGlobalArgc = *argc;
<a name="line788">788: </a>    PetscGlobalArgs = *args;
<a name="line789">789: </a>  }
<a name="line790">790: </a>  PetscFinalizeCalled = <a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line791">791: </a>  PetscSpinlockCreate(&amp;PetscViewerASCIISpinLockOpen);
<a name="line792">792: </a>  PetscSpinlockCreate(&amp;PetscViewerASCIISpinLockStdout);
<a name="line793">793: </a>  PetscSpinlockCreate(&amp;PetscViewerASCIISpinLockStderr);
<a name="line794">794: </a>  PetscSpinlockCreate(&amp;PetscCommSpinLock);

<a name="line796">796: </a>  <font color="#4169E1">if</font> (<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a> == MPI_COMM_NULL) <a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a> = MPI_COMM_WORLD;
<a name="line797">797: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_set_errhandler.html#MPI_Comm_set_errhandler">MPI_Comm_set_errhandler</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,MPI_ERRORS_RETURN);

<a name="line799">799: </a>  <font color="#B22222">/* Done after init due to a bug in MPICH-GM? */</font>
<a name="line800">800: </a>  PetscErrorPrintfInitialize();

<a name="line802">802: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_rank.html#MPI_Comm_rank">MPI_Comm_rank</a>(MPI_COMM_WORLD,&amp;PetscGlobalRank);
<a name="line803">803: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_size.html#MPI_Comm_size">MPI_Comm_size</a>(MPI_COMM_WORLD,&amp;PetscGlobalSize);

<a name="line805">805: </a>  MPIU_BOOL = MPI_INT;
<a name="line806">806: </a>  MPIU_ENUM = MPI_INT;

<a name="line808">808: </a>  <font color="#B22222">/*</font>
<a name="line809">809: </a><font color="#B22222">     Initialized the global complex variable; this is because with</font>
<a name="line810">810: </a><font color="#B22222">     shared libraries the constructors for global variables</font>
<a name="line811">811: </a><font color="#B22222">     are not called; at least on IRIX.</font>
<a name="line812">812: </a><font color="#B22222">  */</font>
<a name="line813">813: </a><font color="#A020F0">#if defined(PETSC_HAVE_COMPLEX)</font>
<a name="line814">814: </a>  {
<a name="line815">815: </a><font color="#A020F0">#if defined(PETSC_CLANGUAGE_CXX)</font>
<a name="line816">816: </a>    <a href="../../../docs/manualpages/Sys/PetscComplex.html#PetscComplex">PetscComplex</a> ic(0.0,1.0);
<a name="line817">817: </a>    <a href="../../../docs/manualpages/Sys/PETSC_i.html#PETSC_i">PETSC_i</a> = ic;
<a name="line818">818: </a><font color="#A020F0">#elif defined(PETSC_CLANGUAGE_C)</font>
<a name="line819">819: </a>    <a href="../../../docs/manualpages/Sys/PETSC_i.html#PETSC_i">PETSC_i</a> = _Complex_I;
<a name="line820">820: </a><font color="#A020F0">#endif</font>
<a name="line821">821: </a>  }

<a name="line823">823: </a><font color="#A020F0">#if !defined(PETSC_HAVE_MPI_C_DOUBLE_COMPLEX)</font>
<a name="line824">824: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Type_contiguous.html#MPI_Type_contiguous">MPI_Type_contiguous</a>(2,MPI_DOUBLE,&amp;MPIU_C_DOUBLE_COMPLEX);
<a name="line825">825: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Type_commit.html#MPI_Type_commit">MPI_Type_commit</a>(&amp;MPIU_C_DOUBLE_COMPLEX);
<a name="line826">826: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Type_contiguous.html#MPI_Type_contiguous">MPI_Type_contiguous</a>(2,MPI_FLOAT,&amp;MPIU_C_COMPLEX);
<a name="line827">827: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Type_commit.html#MPI_Type_commit">MPI_Type_commit</a>(&amp;MPIU_C_COMPLEX);
<a name="line828">828: </a><font color="#A020F0">#endif</font>
<a name="line829">829: </a><font color="#A020F0">#endif </font><font color="#B22222">/* PETSC_HAVE_COMPLEX */</font><font color="#A020F0"></font>

<a name="line831">831: </a>  <font color="#B22222">/*</font>
<a name="line832">832: </a><font color="#B22222">     Create the PETSc MPI reduction operator that sums of the first</font>
<a name="line833">833: </a><font color="#B22222">     half of the entries and maxes the second half.</font>
<a name="line834">834: </a><font color="#B22222">  */</font>
<a name="line835">835: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Op_create.html#MPI_Op_create">MPI_Op_create</a>(PetscMaxSum_Local,1,&amp;PetscMaxSum_Op);

<a name="line837">837: </a><font color="#A020F0">#if defined(PETSC_USE_REAL___FLOAT128)</font>
<a name="line838">838: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Type_contiguous.html#MPI_Type_contiguous">MPI_Type_contiguous</a>(2,MPI_DOUBLE,&amp;MPIU___FLOAT128);
<a name="line839">839: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Type_commit.html#MPI_Type_commit">MPI_Type_commit</a>(&amp;MPIU___FLOAT128);
<a name="line840">840: </a><font color="#A020F0">#if defined(PETSC_HAVE_COMPLEX)</font>
<a name="line841">841: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Type_contiguous.html#MPI_Type_contiguous">MPI_Type_contiguous</a>(4,MPI_DOUBLE,&amp;MPIU___COMPLEX128);
<a name="line842">842: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Type_commit.html#MPI_Type_commit">MPI_Type_commit</a>(&amp;MPIU___COMPLEX128);
<a name="line843">843: </a><font color="#A020F0">#endif</font>
<a name="line844">844: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Op_create.html#MPI_Op_create">MPI_Op_create</a>(PetscMax_Local,1,&amp;MPIU_MAX);
<a name="line845">845: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Op_create.html#MPI_Op_create">MPI_Op_create</a>(PetscMin_Local,1,&amp;MPIU_MIN);
<a name="line846">846: </a><font color="#A020F0">#endif</font>

<a name="line848">848: </a><font color="#A020F0">#if (defined(PETSC_HAVE_COMPLEX) &amp;&amp; !defined(PETSC_HAVE_MPI_C_DOUBLE_COMPLEX)) || defined(PETSC_USE_REAL___FLOAT128)</font>
<a name="line849">849: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Op_create.html#MPI_Op_create">MPI_Op_create</a>(PetscSum_Local,1,&amp;MPIU_SUM);
<a name="line850">850: </a><font color="#A020F0">#endif</font>

<a name="line852">852: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Type_contiguous.html#MPI_Type_contiguous">MPI_Type_contiguous</a>(2,<a href="../../../docs/manualpages/Sys/MPIU_SCALAR.html#MPIU_SCALAR">MPIU_SCALAR</a>,&amp;MPIU_2SCALAR);
<a name="line853">853: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Type_commit.html#MPI_Type_commit">MPI_Type_commit</a>(&amp;MPIU_2SCALAR);

<a name="line855">855: </a><font color="#A020F0">#if defined(PETSC_USE_64BIT_INDICES) || !defined(MPI_2INT)</font>
<a name="line856">856: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Type_contiguous.html#MPI_Type_contiguous">MPI_Type_contiguous</a>(2,MPIU_INT,&amp;MPIU_2INT);
<a name="line857">857: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Type_commit.html#MPI_Type_commit">MPI_Type_commit</a>(&amp;MPIU_2INT);
<a name="line858">858: </a><font color="#A020F0">#endif</font>


<a name="line861">861: </a>  <font color="#B22222">/*</font>
<a name="line862">862: </a><font color="#B22222">     Attributes to be set on PETSc communicators</font>
<a name="line863">863: </a><font color="#B22222">  */</font>
<a name="line864">864: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Keyval_create.html#MPI_Keyval_create">MPI_Keyval_create</a>(MPI_NULL_COPY_FN,Petsc_DelCounter,&amp;Petsc_Counter_keyval,(void*)0);
<a name="line865">865: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Keyval_create.html#MPI_Keyval_create">MPI_Keyval_create</a>(MPI_NULL_COPY_FN,Petsc_DelComm_Outer,&amp;Petsc_InnerComm_keyval,(void*)0);
<a name="line866">866: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Keyval_create.html#MPI_Keyval_create">MPI_Keyval_create</a>(MPI_NULL_COPY_FN,Petsc_DelComm_Inner,&amp;Petsc_OuterComm_keyval,(void*)0);

<a name="line868">868: </a>  <font color="#B22222">/*</font>
<a name="line869">869: </a><font color="#B22222">     Build the options database</font>
<a name="line870">870: </a><font color="#B22222">  */</font>
<a name="line871">871: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsInsert.html#PetscOptionsInsert">PetscOptionsInsert</a>(NULL,argc,args,file);


<a name="line874">874: </a>  <font color="#B22222">/*</font>
<a name="line875">875: </a><font color="#B22222">     Print main application help message</font>
<a name="line876">876: </a><font color="#B22222">  */</font>
<a name="line877">877: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsHasName.html#PetscOptionsHasName">PetscOptionsHasName</a>(NULL,NULL,<font color="#666666">"-help"</font>,&amp;flg);
<a name="line878">878: </a>  <font color="#4169E1">if</font> (help &amp;&amp; flg) {
<a name="line879">879: </a>    <a href="../../../docs/manualpages/Sys/PetscPrintf.html#PetscPrintf">PetscPrintf</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,help);
<a name="line880">880: </a>  }
<a name="line881">881: </a>  PetscOptionsCheckInitial_Private();

<a name="line883">883: </a>  PetscCitationsInitialize();

<a name="line885">885: </a><font color="#A020F0">#if defined(PETSC_HAVE_SAWS)</font>
<a name="line886">886: </a>  PetscInitializeSAWs(help);
<a name="line887">887: </a><font color="#A020F0">#endif</font>

<a name="line889">889: </a>  <font color="#B22222">/* Creates the logging data structures; this is enabled even if logging is not turned on */</font>
<a name="line890">890: </a><font color="#A020F0">#if defined(PETSC_USE_LOG)</font>
<a name="line891">891: </a>  PetscLogInitialize();
<a name="line892">892: </a><font color="#A020F0">#endif</font>

<a name="line894">894: </a>  <font color="#B22222">/*</font>
<a name="line895">895: </a><font color="#B22222">     Load the dynamic libraries (on machines that support them), this registers all</font>
<a name="line896">896: </a><font color="#B22222">     the solvers etc. (On non-dynamic machines this initializes the <a href="../../../docs/manualpages/Draw/PetscDraw.html#PetscDraw">PetscDraw</a> and <a href="../../../docs/manualpages/Viewer/PetscViewer.html#PetscViewer">PetscViewer</a> classes)</font>
<a name="line897">897: </a><font color="#B22222">  */</font>
<a name="line898">898: </a>  PetscInitialize_DynamicLibraries();

<a name="line900">900: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_size.html#MPI_Comm_size">MPI_Comm_size</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,&amp;size);
<a name="line901">901: </a>  PetscInfo1(0,<font color="#666666">"PETSc successfully started: number of processors = %d\n"</font>,size);
<a name="line902">902: </a>  <a href="../../../docs/manualpages/Sys/PetscGetHostName.html#PetscGetHostName">PetscGetHostName</a>(hostname,256);
<a name="line903">903: </a>  PetscInfo1(0,<font color="#666666">"Running on machine: %s\n"</font>,hostname);

<a name="line905">905: </a>  PetscOptionsCheckInitial_Components();
<a name="line906">906: </a>  <font color="#B22222">/* Check the options database for options related to the options database itself */</font>
<a name="line907">907: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsSetFromOptions.html#PetscOptionsSetFromOptions">PetscOptionsSetFromOptions</a>(NULL);

<a name="line909">909: </a><font color="#A020F0">#if defined(PETSC_USE_PETSC_MPI_EXTERNAL32)</font>
<a name="line910">910: </a>  <font color="#B22222">/*</font>
<a name="line911">911: </a><font color="#B22222">      Tell MPI about our own data representation converter, this would/should be used if extern32 is not supported by the MPI</font>

<a name="line913">913: </a><font color="#B22222">      Currently not used because it is not supported by MPICH.</font>
<a name="line914">914: </a><font color="#B22222">  */</font>
<a name="line915">915: </a><font color="#A020F0">#if !defined(PETSC_WORDS_BIGENDIAN)</font>
<a name="line916">916: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Register_datarep.html#MPI_Register_datarep">MPI_Register_datarep</a>((char*)<font color="#666666">"petsc"</font>,PetscDataRep_read_conv_fn,PetscDataRep_write_conv_fn,PetscDataRep_extent_fn,NULL);
<a name="line917">917: </a><font color="#A020F0">#endif</font>
<a name="line918">918: </a><font color="#A020F0">#endif</font>

<a name="line920">920: </a><font color="#A020F0">#if defined(PETSC_HAVE_CUDA)</font>
<a name="line921">921: </a>  flg  = <a href="../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line922">922: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsGetBool.html#PetscOptionsGetBool">PetscOptionsGetBool</a>(NULL,NULL,<font color="#666666">"-cublas"</font>,&amp;flg,NULL);
<a name="line923">923: </a>  <font color="#4169E1">if</font> (flg) {
<a name="line924">924: </a>    <a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a> p;
<a name="line925">925: </a>    <font color="#4169E1">for</font> (p = 0; p &lt; PetscGlobalSize; ++p) {
<a name="line926">926: </a>      <font color="#4169E1">if</font> (p == PetscGlobalRank) {
<a name="line927">927: </a>        cberr = cublasCreate(&amp;cublasv2handle);CHKERRCUBLAS(cberr);
<a name="line928">928: </a>      }
<a name="line929">929: </a>      <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Barrier.html#MPI_Barrier">MPI_Barrier</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>);
<a name="line930">930: </a>    }
<a name="line931">931: </a>  }
<a name="line932">932: </a><font color="#A020F0">#endif</font>

<a name="line934">934: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsHasName.html#PetscOptionsHasName">PetscOptionsHasName</a>(NULL,NULL,<font color="#666666">"-python"</font>,&amp;flg);
<a name="line935">935: </a>  <font color="#4169E1">if</font> (flg) {
<a name="line936">936: </a>    PetscInitializeCalled = <a href="../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line937">937: </a>    PetscPythonInitialize(NULL,NULL);
<a name="line938">938: </a>  }

<a name="line940">940: </a>  <font color="#B22222">/*</font>
<a name="line941">941: </a><font color="#B22222">      Setup building of stack frames for all function calls</font>
<a name="line942">942: </a><font color="#B22222">  */</font>
<a name="line943">943: </a><font color="#A020F0">#if defined(PETSC_USE_DEBUG) &amp;&amp; !defined(PETSC_HAVE_THREADSAFETY)</font>
<a name="line944">944: </a>  PetscStackCreate();
<a name="line945">945: </a><font color="#A020F0">#endif</font>

<a name="line947">947: </a><font color="#A020F0">#if defined(PETSC_SERIALIZE_FUNCTIONS)</font>
<a name="line948">948: </a>  PetscFPTCreate(10000);
<a name="line949">949: </a><font color="#A020F0">#endif</font>


<a name="line952">952: </a>  <font color="#B22222">/*</font>
<a name="line953">953: </a><font color="#B22222">      Once we are completedly initialized then we can set this variables</font>
<a name="line954">954: </a><font color="#B22222">  */</font>
<a name="line955">955: </a>  PetscInitializeCalled = <a href="../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line956">956: </a>  <font color="#4169E1">return</font>(0);
<a name="line957">957: </a>}

<a name="line959">959: </a><font color="#A020F0">#if defined(PETSC_USE_LOG)</font>
<a name="line960">960: </a>extern <a href="../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a> *PetscObjects;
<a name="line961">961: </a>extern <a href="../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>    PetscObjectsCounts, PetscObjectsMaxCounts;
<a name="line962">962: </a>extern <a href="../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a>   PetscObjectsLog;
<a name="line963">963: </a><font color="#A020F0">#endif</font>

<a name="line967">967: </a><font color="#B22222">/*@C</font>
<a name="line968">968: </a><font color="#B22222">   <a href="../../../docs/manualpages/Sys/PetscFinalize.html#PetscFinalize">PetscFinalize</a> - Checks for options to be called at the conclusion</font>
<a name="line969">969: </a><font color="#B22222">   of the program. <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Finalize.html#MPI_Finalize">MPI_Finalize</a>() is called only if the user had not</font>
<a name="line970">970: </a><font color="#B22222">   called <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Init.html#MPI_Init">MPI_Init</a>() before calling <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>().</font>

<a name="line972">972: </a><font color="#B22222">   Collective on <a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a></font>

<a name="line974">974: </a><font color="#B22222">   Options Database Keys:</font>
<a name="line975">975: </a><font color="#B22222">+  -options_table - Calls <a href="../../../docs/manualpages/Sys/PetscOptionsView.html#PetscOptionsView">PetscOptionsView</a>()</font>
<a name="line976">976: </a><font color="#B22222">.  -options_left - Prints unused options that remain in the database</font>
<a name="line977">977: </a><font color="#B22222">.  -objects_dump [all] - Prints list of objects allocated by the user that have not been freed, the option all cause all outstanding objects to be listed</font>
<a name="line978">978: </a><font color="#B22222">.  -mpidump - Calls <a href="../../../docs/manualpages/Sys/PetscMPIDump.html#PetscMPIDump">PetscMPIDump</a>()</font>
<a name="line979">979: </a><font color="#B22222">.  -malloc_dump - Calls <a href="../../../docs/manualpages/Sys/PetscMallocDump.html#PetscMallocDump">PetscMallocDump</a>()</font>
<a name="line980">980: </a><font color="#B22222">.  -malloc_info - Prints total memory usage</font>
<a name="line981">981: </a><font color="#B22222">-  -malloc_log - Prints summary of memory usage</font>

<a name="line983">983: </a><font color="#B22222">   Level: beginner</font>

<a name="line985">985: </a><font color="#B22222">   Note:</font>
<a name="line986">986: </a><font color="#B22222">   See <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>() for more general runtime options.</font>

<a name="line988">988: </a><font color="#B22222">.seealso: <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>(), <a href="../../../docs/manualpages/Sys/PetscOptionsView.html#PetscOptionsView">PetscOptionsView</a>(), <a href="../../../docs/manualpages/Sys/PetscMallocDump.html#PetscMallocDump">PetscMallocDump</a>(), <a href="../../../docs/manualpages/Sys/PetscMPIDump.html#PetscMPIDump">PetscMPIDump</a>(), <a href="../../../docs/manualpages/Sys/PetscEnd.html#PetscEnd">PetscEnd</a>()</font>
<a name="line989">989: </a><font color="#B22222">@*/</font>
<a name="line990">990: </a><strong><font color="#4169E1"><a name="PetscFinalize"></a><a href="../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a>  <a href="../../../docs/manualpages/Sys/PetscFinalize.html#PetscFinalize">PetscFinalize</a>(void)</font></strong>
<a name="line991">991: </a>{
<a name="line993">993: </a>  <a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a>    rank;
<a name="line994">994: </a>  <a href="../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>       nopt;
<a name="line995">995: </a>  <a href="../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a>      flg1 = <a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>,flg2 = <a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>,flg3 = <a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line996">996: </a>  <a href="../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a>      flg;
<a name="line997">997: </a><font color="#A020F0">#if defined(PETSC_USE_LOG)</font>
<a name="line998">998: </a>  char           mname[PETSC_MAX_PATH_LEN];
<a name="line999">999: </a><font color="#A020F0">#endif</font>
<a name="line1000">1000: </a><font color="#A020F0">#if defined(PETSC_HAVE_CUDA)</font>
<a name="line1001">1001: </a>  cublasStatus_t cberr;
<a name="line1002">1002: </a><font color="#A020F0">#endif</font>

<a name="line1005">1005: </a>  <font color="#4169E1">if</font> (!PetscInitializeCalled) {
<a name="line1006">1006: </a>    printf(<font color="#666666">"<a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>() must be called before <a href="../../../docs/manualpages/Sys/PetscFinalize.html#PetscFinalize">PetscFinalize</a>()\n"</font>);
<a name="line1007">1007: </a>    <a href="../../../docs/manualpages/Sys/PetscFunctionReturn.html#PetscFunctionReturn">PetscFunctionReturn</a>(PETSC_ERR_ARG_WRONGSTATE);
<a name="line1008">1008: </a>  }
<a name="line1009">1009: </a>  <a href="../../../docs/manualpages/Profiling/PetscInfo.html#PetscInfo">PetscInfo</a>(NULL,<font color="#666666">"<a href="../../../docs/manualpages/Sys/PetscFinalize.html#PetscFinalize">PetscFinalize</a>() called\n"</font>);

<a name="line1011">1011: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_rank.html#MPI_Comm_rank">MPI_Comm_rank</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,&amp;rank);

<a name="line1013">1013: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsHasName.html#PetscOptionsHasName">PetscOptionsHasName</a>(NULL,NULL,<font color="#666666">"-citations"</font>,&amp;flg);
<a name="line1014">1014: </a>  <font color="#4169E1">if</font> (flg) {
<a name="line1015">1015: </a>    char  *cits, filename[PETSC_MAX_PATH_LEN];
<a name="line1016">1016: </a>    FILE  *fd = PETSC_STDOUT;

<a name="line1018">1018: </a>    <a href="../../../docs/manualpages/Sys/PetscOptionsGetString.html#PetscOptionsGetString">PetscOptionsGetString</a>(NULL,NULL,<font color="#666666">"-citations"</font>,filename,PETSC_MAX_PATH_LEN,NULL);
<a name="line1019">1019: </a>    <font color="#4169E1">if</font> (filename[0]) {
<a name="line1020">1020: </a>      <a href="../../../docs/manualpages/Sys/PetscFOpen.html#PetscFOpen">PetscFOpen</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,filename,<font color="#666666">"w"</font>,&amp;fd);
<a name="line1021">1021: </a>    }
<a name="line1022">1022: </a>    <a href="../../../docs/manualpages/Sys/PetscSegBufferGet.html#PetscSegBufferGet">PetscSegBufferGet</a>(PetscCitationsList,1,&amp;cits);
<a name="line1023">1023: </a>    cits[0] = 0;
<a name="line1024">1024: </a>    <a href="../../../docs/manualpages/Sys/PetscSegBufferExtractAlloc.html#PetscSegBufferExtractAlloc">PetscSegBufferExtractAlloc</a>(PetscCitationsList,&amp;cits);
<a name="line1025">1025: </a>    <a href="../../../docs/manualpages/Sys/PetscFPrintf.html#PetscFPrintf">PetscFPrintf</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,fd,<font color="#666666">"If you publish results based on this computation please cite the following:\n"</font>);
<a name="line1026">1026: </a>    <a href="../../../docs/manualpages/Sys/PetscFPrintf.html#PetscFPrintf">PetscFPrintf</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,fd,<font color="#666666">"===========================================================================\n"</font>);
<a name="line1027">1027: </a>    <a href="../../../docs/manualpages/Sys/PetscFPrintf.html#PetscFPrintf">PetscFPrintf</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,fd,<font color="#666666">"%s"</font>,cits);
<a name="line1028">1028: </a>    <a href="../../../docs/manualpages/Sys/PetscFPrintf.html#PetscFPrintf">PetscFPrintf</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,fd,<font color="#666666">"===========================================================================\n"</font>);
<a name="line1029">1029: </a>    <a href="../../../docs/manualpages/Sys/PetscFClose.html#PetscFClose">PetscFClose</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,fd);
<a name="line1030">1030: </a>    <a href="../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</a>(cits);
<a name="line1031">1031: </a>  }
<a name="line1032">1032: </a>  <a href="../../../docs/manualpages/Sys/PetscSegBufferDestroy.html#PetscSegBufferDestroy">PetscSegBufferDestroy</a>(&amp;PetscCitationsList);

<a name="line1034">1034: </a><font color="#A020F0">#if defined(PETSC_HAVE_SSL) &amp;&amp; defined(PETSC_USE_SOCKET_VIEWER)</font>
<a name="line1035">1035: </a>  <font color="#B22222">/* TextBelt is run for testing purposes only, please do not use this feature often */</font>
<a name="line1036">1036: </a>  {
<a name="line1037">1037: </a>    <a href="../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> nmax = 2;
<a name="line1038">1038: </a>    char     **buffs;
<a name="line1039">1039: </a>    <a href="../../../docs/manualpages/Sys/PetscMalloc1.html#PetscMalloc1">PetscMalloc1</a>(2,&amp;buffs);
<a name="line1040">1040: </a>    <a href="../../../docs/manualpages/Sys/PetscOptionsGetStringArray.html#PetscOptionsGetStringArray">PetscOptionsGetStringArray</a>(NULL,NULL,<font color="#666666">"-textbelt"</font>,buffs,&amp;nmax,&amp;flg1);
<a name="line1041">1041: </a>    <font color="#4169E1">if</font> (flg1) {
<a name="line1042">1042: </a>      <font color="#4169E1">if</font> (!nmax) <a href="../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,PETSC_ERR_USER,<font color="#666666">"-textbelt requires either the phone number or number,\"message\""</font>);
<a name="line1043">1043: </a>      <font color="#4169E1">if</font> (nmax == 1) {
<a name="line1044">1044: </a>        <a href="../../../docs/manualpages/Sys/PetscMalloc1.html#PetscMalloc1">PetscMalloc1</a>(128,&amp;buffs[1]);
<a name="line1045">1045: </a>        <a href="../../../docs/manualpages/Sys/PetscGetProgramName.html#PetscGetProgramName">PetscGetProgramName</a>(buffs[1],32);
<a name="line1046">1046: </a>        <a href="../../../docs/manualpages/Sys/PetscStrcat.html#PetscStrcat">PetscStrcat</a>(buffs[1],<font color="#666666">" has completed"</font>);
<a name="line1047">1047: </a>      }
<a name="line1048">1048: </a>      <a href="../../../docs/manualpages/Sys/PetscTextBelt.html#PetscTextBelt">PetscTextBelt</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,buffs[0],buffs[1],NULL);
<a name="line1049">1049: </a>      <a href="../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</a>(buffs[0]);
<a name="line1050">1050: </a>      <a href="../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</a>(buffs[1]);
<a name="line1051">1051: </a>    }
<a name="line1052">1052: </a>    <a href="../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</a>(buffs);
<a name="line1053">1053: </a>  }
<a name="line1054">1054: </a><font color="#A020F0">#endif</font>
<a name="line1055">1055: </a>  <font color="#B22222">/*</font>
<a name="line1056">1056: </a><font color="#B22222">    It should be safe to cancel the options monitors, since we don't expect to be setting options</font>
<a name="line1057">1057: </a><font color="#B22222">    here (at least that are worth monitoring).  Monitors ought to be released so that they release</font>
<a name="line1058">1058: </a><font color="#B22222">    whatever memory was allocated there before -malloc_dump reports unfreed memory.</font>
<a name="line1059">1059: </a><font color="#B22222">  */</font>
<a name="line1060">1060: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsMonitorCancel.html#PetscOptionsMonitorCancel">PetscOptionsMonitorCancel</a>();

<a name="line1062">1062: </a><font color="#A020F0">#if defined(PETSC_SERIALIZE_FUNCTIONS)</font>
<a name="line1063">1063: </a>  PetscFPTDestroy();
<a name="line1064">1064: </a><font color="#A020F0">#endif</font>


<a name="line1067">1067: </a><font color="#A020F0">#if defined(PETSC_HAVE_SAWS)</font>
<a name="line1068">1068: </a>  flg = <a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line1069">1069: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsGetBool.html#PetscOptionsGetBool">PetscOptionsGetBool</a>(NULL,NULL,<font color="#666666">"-saw_options"</font>,&amp;flg,NULL);
<a name="line1070">1070: </a>  <font color="#4169E1">if</font> (flg) {
<a name="line1071">1071: </a>    PetscOptionsSAWsDestroy();
<a name="line1072">1072: </a>  }
<a name="line1073">1073: </a><font color="#A020F0">#endif</font>

<a name="line1075">1075: </a><font color="#A020F0">#if defined(PETSC_HAVE_X)</font>
<a name="line1076">1076: </a>  flg1 = <a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line1077">1077: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsGetBool.html#PetscOptionsGetBool">PetscOptionsGetBool</a>(NULL,NULL,<font color="#666666">"-x_virtual"</font>,&amp;flg1,NULL);
<a name="line1078">1078: </a>  <font color="#4169E1">if</font> (flg1) {
<a name="line1079">1079: </a>    <font color="#B22222">/*  this is a crude hack, but better than nothing */</font>
<a name="line1080">1080: </a>    <a href="../../../docs/manualpages/Sys/PetscPOpen.html#PetscPOpen">PetscPOpen</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,NULL,<font color="#666666">"pkill -9 Xvfb"</font>,<font color="#666666">"r"</font>,NULL);
<a name="line1081">1081: </a>  }
<a name="line1082">1082: </a><font color="#A020F0">#endif</font>

<a name="line1084">1084: </a><font color="#A020F0">#if !defined(PETSC_HAVE_THREADSAFETY)</font>
<a name="line1085">1085: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsGetBool.html#PetscOptionsGetBool">PetscOptionsGetBool</a>(NULL,NULL,<font color="#666666">"-malloc_info"</font>,&amp;flg2,NULL);
<a name="line1086">1086: </a>  <font color="#4169E1">if</font> (!flg2) {
<a name="line1087">1087: </a>    flg2 = <a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line1088">1088: </a>    <a href="../../../docs/manualpages/Sys/PetscOptionsGetBool.html#PetscOptionsGetBool">PetscOptionsGetBool</a>(NULL,NULL,<font color="#666666">"-memory_view"</font>,&amp;flg2,NULL);
<a name="line1089">1089: </a>  }
<a name="line1090">1090: </a>  <font color="#4169E1">if</font> (flg2) {
<a name="line1091">1091: </a>    <a href="../../../docs/manualpages/Sys/PetscMemoryView.html#PetscMemoryView">PetscMemoryView</a>(<a href="../../../docs/manualpages/Viewer/PETSC_VIEWER_STDOUT_WORLD.html#PETSC_VIEWER_STDOUT_WORLD">PETSC_VIEWER_STDOUT_WORLD</a>,<font color="#666666">"Summary of Memory Usage in PETSc\n"</font>);
<a name="line1092">1092: </a>  }
<a name="line1093">1093: </a><font color="#A020F0">#endif</font>

<a name="line1095">1095: </a><font color="#A020F0">#if defined(PETSC_USE_LOG)</font>
<a name="line1096">1096: </a>  flg1 = <a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line1097">1097: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsGetBool.html#PetscOptionsGetBool">PetscOptionsGetBool</a>(NULL,NULL,<font color="#666666">"-get_total_flops"</font>,&amp;flg1,NULL);
<a name="line1098">1098: </a>  <font color="#4169E1">if</font> (flg1) {
<a name="line1099">1099: </a>    PetscLogDouble flops = 0;
<a name="line1100">1100: </a>    <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Reduce.html#MPI_Reduce">MPI_Reduce</a>(&amp;petsc_TotalFlops,&amp;flops,1,MPI_DOUBLE,MPI_SUM,0,<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>);
<a name="line1101">1101: </a>    <a href="../../../docs/manualpages/Sys/PetscPrintf.html#PetscPrintf">PetscPrintf</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,<font color="#666666">"Total flops over all processors %g\n"</font>,flops);
<a name="line1102">1102: </a>  }
<a name="line1103">1103: </a><font color="#A020F0">#endif</font>


<a name="line1106">1106: </a><font color="#A020F0">#if defined(PETSC_USE_LOG)</font>
<a name="line1107">1107: </a><font color="#A020F0">#if defined(PETSC_HAVE_MPE)</font>
<a name="line1108">1108: </a>  mname[0] = 0;

<a name="line1110">1110: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsGetString.html#PetscOptionsGetString">PetscOptionsGetString</a>(NULL,NULL,<font color="#666666">"-log_mpe"</font>,mname,PETSC_MAX_PATH_LEN,&amp;flg1);
<a name="line1111">1111: </a>  <font color="#4169E1">if</font> (flg1) {
<a name="line1112">1112: </a>    <font color="#4169E1">if</font> (mname[0]) {<a href="../../../docs/manualpages/Profiling/PetscLogMPEDump.html#PetscLogMPEDump">PetscLogMPEDump</a>(mname);}
<a name="line1113">1113: </a>    <font color="#4169E1">else</font>          {<a href="../../../docs/manualpages/Profiling/PetscLogMPEDump.html#PetscLogMPEDump">PetscLogMPEDump</a>(0);}
<a name="line1114">1114: </a>  }
<a name="line1115">1115: </a><font color="#A020F0">#endif</font>
<a name="line1116">1116: </a>  mname[0] = 0;

<a name="line1118">1118: </a>  <a href="../../../docs/manualpages/Profiling/PetscLogViewFromOptions.html#PetscLogViewFromOptions">PetscLogViewFromOptions</a>();
<a name="line1119">1119: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsGetString.html#PetscOptionsGetString">PetscOptionsGetString</a>(NULL,NULL,<font color="#666666">"-log_summary"</font>,mname,PETSC_MAX_PATH_LEN,&amp;flg1);
<a name="line1120">1120: </a>  <font color="#4169E1">if</font> (flg1) {
<a name="line1121">1121: </a>    <a href="../../../docs/manualpages/Viewer/PetscViewer.html#PetscViewer">PetscViewer</a> viewer;
<a name="line1122">1122: </a>    (*<a href="../../../docs/manualpages/Sys/PetscHelpPrintf.html#PetscHelpPrintf">PetscHelpPrintf</a>)(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,<font color="#666666">"\n\n WARNING:   -log_summary is being deprecated; switch to -log_view\n\n\n"</font>);
<a name="line1123">1123: </a>    <font color="#4169E1">if</font> (mname[0]) {
<a name="line1124">1124: </a>      <a href="../../../docs/manualpages/Viewer/PetscViewerASCIIOpen.html#PetscViewerASCIIOpen">PetscViewerASCIIOpen</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,mname,&amp;viewer);
<a name="line1125">1125: </a>      <a href="../../../docs/manualpages/Profiling/PetscLogView.html#PetscLogView">PetscLogView</a>(viewer);
<a name="line1126">1126: </a>      <a href="../../../docs/manualpages/Viewer/PetscViewerDestroy.html#PetscViewerDestroy">PetscViewerDestroy</a>(&amp;viewer);
<a name="line1127">1127: </a>    } <font color="#4169E1">else</font> {
<a name="line1128">1128: </a>      viewer = <a href="../../../docs/manualpages/Viewer/PETSC_VIEWER_STDOUT_WORLD.html#PETSC_VIEWER_STDOUT_WORLD">PETSC_VIEWER_STDOUT_WORLD</a>;
<a name="line1129">1129: </a>      <a href="../../../docs/manualpages/Viewer/PetscViewerPushFormat.html#PetscViewerPushFormat">PetscViewerPushFormat</a>(viewer,PETSC_VIEWER_DEFAULT);
<a name="line1130">1130: </a>      <a href="../../../docs/manualpages/Profiling/PetscLogView.html#PetscLogView">PetscLogView</a>(viewer);
<a name="line1131">1131: </a>      <a href="../../../docs/manualpages/Viewer/PetscViewerPopFormat.html#PetscViewerPopFormat">PetscViewerPopFormat</a>(viewer);
<a name="line1132">1132: </a>    }
<a name="line1133">1133: </a>  }
<a name="line1134">1134: </a>  mname[0] = 0;

<a name="line1136">1136: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsGetString.html#PetscOptionsGetString">PetscOptionsGetString</a>(NULL,NULL,<font color="#666666">"-log_all"</font>,mname,PETSC_MAX_PATH_LEN,&amp;flg1);
<a name="line1137">1137: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsGetString.html#PetscOptionsGetString">PetscOptionsGetString</a>(NULL,NULL,<font color="#666666">"-log"</font>,mname,PETSC_MAX_PATH_LEN,&amp;flg2);
<a name="line1138">1138: </a>  <font color="#4169E1">if</font> (flg1 || flg2) {
<a name="line1139">1139: </a>    <font color="#4169E1">if</font> (mname[0]) <a href="../../../docs/manualpages/Profiling/PetscLogDump.html#PetscLogDump">PetscLogDump</a>(mname);
<a name="line1140">1140: </a>    <font color="#4169E1">else</font>          <a href="../../../docs/manualpages/Profiling/PetscLogDump.html#PetscLogDump">PetscLogDump</a>(0);
<a name="line1141">1141: </a>  }
<a name="line1142">1142: </a><font color="#A020F0">#endif</font>

<a name="line1144">1144: </a>  <font color="#B22222">/*</font>
<a name="line1145">1145: </a><font color="#B22222">     Free all objects registered with <a href="../../../docs/manualpages/Sys/PetscObjectRegisterDestroy.html#PetscObjectRegisterDestroy">PetscObjectRegisterDestroy</a>() such as PETSC_VIEWER_XXX_().</font>
<a name="line1146">1146: </a><font color="#B22222">  */</font>
<a name="line1147">1147: </a>  <a href="../../../docs/manualpages/Sys/PetscObjectRegisterDestroyAll.html#PetscObjectRegisterDestroyAll">PetscObjectRegisterDestroyAll</a>();

<a name="line1149">1149: </a>  PetscStackDestroy();

<a name="line1151">1151: </a>  flg1 = <a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line1152">1152: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsGetBool.html#PetscOptionsGetBool">PetscOptionsGetBool</a>(NULL,NULL,<font color="#666666">"-no_signal_handler"</font>,&amp;flg1,NULL);
<a name="line1153">1153: </a>  <font color="#4169E1">if</font> (!flg1) { <a href="../../../docs/manualpages/Sys/PetscPopSignalHandler.html#PetscPopSignalHandler">PetscPopSignalHandler</a>();}
<a name="line1154">1154: </a>  flg1 = <a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line1155">1155: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsGetBool.html#PetscOptionsGetBool">PetscOptionsGetBool</a>(NULL,NULL,<font color="#666666">"-mpidump"</font>,&amp;flg1,NULL);
<a name="line1156">1156: </a>  <font color="#4169E1">if</font> (flg1) {
<a name="line1157">1157: </a>    <a href="../../../docs/manualpages/Sys/PetscMPIDump.html#PetscMPIDump">PetscMPIDump</a>(stdout);
<a name="line1158">1158: </a>  }
<a name="line1159">1159: </a>  flg1 = <a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line1160">1160: </a>  flg2 = <a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line1161">1161: </a>  <font color="#B22222">/* preemptive call to avoid listing this option in options table as unused */</font>
<a name="line1162">1162: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsHasName.html#PetscOptionsHasName">PetscOptionsHasName</a>(NULL,NULL,<font color="#666666">"-malloc_dump"</font>,&amp;flg1);
<a name="line1163">1163: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsHasName.html#PetscOptionsHasName">PetscOptionsHasName</a>(NULL,NULL,<font color="#666666">"-objects_dump"</font>,&amp;flg1);
<a name="line1164">1164: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsGetBool.html#PetscOptionsGetBool">PetscOptionsGetBool</a>(NULL,NULL,<font color="#666666">"-options_view"</font>,&amp;flg2,NULL);

<a name="line1166">1166: </a>  <font color="#4169E1">if</font> (flg2) {
<a name="line1167">1167: </a>    <a href="../../../docs/manualpages/Viewer/PetscViewer.html#PetscViewer">PetscViewer</a> viewer;
<a name="line1168">1168: </a>    <a href="../../../docs/manualpages/Viewer/PetscViewerCreate.html#PetscViewerCreate">PetscViewerCreate</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,&amp;viewer);
<a name="line1169">1169: </a>    <a href="../../../docs/manualpages/Viewer/PetscViewerSetType.html#PetscViewerSetType">PetscViewerSetType</a>(viewer,PETSCVIEWERASCII);
<a name="line1170">1170: </a>    <a href="../../../docs/manualpages/Sys/PetscOptionsView.html#PetscOptionsView">PetscOptionsView</a>(NULL,viewer);
<a name="line1171">1171: </a>    <a href="../../../docs/manualpages/Viewer/PetscViewerDestroy.html#PetscViewerDestroy">PetscViewerDestroy</a>(&amp;viewer);
<a name="line1172">1172: </a>  }

<a name="line1174">1174: </a>  <font color="#B22222">/* to prevent PETSc -options_left from warning */</font>
<a name="line1175">1175: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsHasName.html#PetscOptionsHasName">PetscOptionsHasName</a>(NULL,NULL,<font color="#666666">"-nox"</font>,&amp;flg1);
<a name="line1176">1176: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsHasName.html#PetscOptionsHasName">PetscOptionsHasName</a>(NULL,NULL,<font color="#666666">"-nox_warning"</font>,&amp;flg1);

<a name="line1178">1178: </a>  flg3 = <a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>; <font color="#B22222">/* default value is required */</font>
<a name="line1179">1179: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsGetBool.html#PetscOptionsGetBool">PetscOptionsGetBool</a>(NULL,NULL,<font color="#666666">"-options_left"</font>,&amp;flg3,&amp;flg1);
<a name="line1180">1180: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsAllUsed.html#PetscOptionsAllUsed">PetscOptionsAllUsed</a>(NULL,&amp;nopt);
<a name="line1181">1181: </a>  <font color="#4169E1">if</font> (flg3) {
<a name="line1182">1182: </a>    <font color="#4169E1">if</font> (!flg2) { <font color="#B22222">/* have not yet printed the options */</font>
<a name="line1183">1183: </a>      <a href="../../../docs/manualpages/Viewer/PetscViewer.html#PetscViewer">PetscViewer</a> viewer;
<a name="line1184">1184: </a>      <a href="../../../docs/manualpages/Viewer/PetscViewerCreate.html#PetscViewerCreate">PetscViewerCreate</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,&amp;viewer);
<a name="line1185">1185: </a>      <a href="../../../docs/manualpages/Viewer/PetscViewerSetType.html#PetscViewerSetType">PetscViewerSetType</a>(viewer,PETSCVIEWERASCII);
<a name="line1186">1186: </a>      <a href="../../../docs/manualpages/Sys/PetscOptionsView.html#PetscOptionsView">PetscOptionsView</a>(NULL,viewer);
<a name="line1187">1187: </a>      <a href="../../../docs/manualpages/Viewer/PetscViewerDestroy.html#PetscViewerDestroy">PetscViewerDestroy</a>(&amp;viewer);
<a name="line1188">1188: </a>    }
<a name="line1189">1189: </a>    <font color="#4169E1">if</font> (!nopt) {
<a name="line1190">1190: </a>      <a href="../../../docs/manualpages/Sys/PetscPrintf.html#PetscPrintf">PetscPrintf</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,<font color="#666666">"There are no unused options.\n"</font>);
<a name="line1191">1191: </a>    } <font color="#4169E1">else</font> <font color="#4169E1">if</font> (nopt == 1) {
<a name="line1192">1192: </a>      <a href="../../../docs/manualpages/Sys/PetscPrintf.html#PetscPrintf">PetscPrintf</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,<font color="#666666">"There is one unused database option. It is:\n"</font>);
<a name="line1193">1193: </a>    } <font color="#4169E1">else</font> {
<a name="line1194">1194: </a>      <a href="../../../docs/manualpages/Sys/PetscPrintf.html#PetscPrintf">PetscPrintf</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,<font color="#666666">"There are %D unused database options. They are:\n"</font>,nopt);
<a name="line1195">1195: </a>    }
<a name="line1196">1196: </a>  }
<a name="line1197">1197: </a><font color="#A020F0">#if defined(PETSC_USE_DEBUG)</font>
<a name="line1198">1198: </a>  <font color="#4169E1">if</font> (nopt &amp;&amp; !flg3 &amp;&amp; !flg1) {
<a name="line1199">1199: </a>    <a href="../../../docs/manualpages/Sys/PetscPrintf.html#PetscPrintf">PetscPrintf</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,<font color="#666666">"WARNING! There are options you set that were not used!\n"</font>);
<a name="line1200">1200: </a>    <a href="../../../docs/manualpages/Sys/PetscPrintf.html#PetscPrintf">PetscPrintf</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,<font color="#666666">"WARNING! could be spelling mistake, etc!\n"</font>);
<a name="line1201">1201: </a>    <a href="../../../docs/manualpages/Sys/PetscOptionsLeft.html#PetscOptionsLeft">PetscOptionsLeft</a>(NULL);
<a name="line1202">1202: </a>  } <font color="#4169E1">else</font> <font color="#4169E1">if</font> (nopt &amp;&amp; flg3) {
<a name="line1203">1203: </a><font color="#A020F0">#else</font>
<a name="line1204">1204: </a>  <font color="#4169E1">if</font> (nopt &amp;&amp; flg3) {
<a name="line1205">1205: </a><font color="#A020F0">#endif</font>
<a name="line1206">1206: </a>    <a href="../../../docs/manualpages/Sys/PetscOptionsLeft.html#PetscOptionsLeft">PetscOptionsLeft</a>(NULL);
<a name="line1207">1207: </a>  }

<a name="line1209">1209: </a><font color="#A020F0">#if defined(PETSC_HAVE_SAWS)</font>
<a name="line1210">1210: </a>  <font color="#4169E1">if</font> (!PetscGlobalRank) {
<a name="line1211">1211: </a>    PetscStackSAWsViewOff();
<a name="line1212">1212: </a>    PetscStackCallSAWs(SAWs_Finalize,());
<a name="line1213">1213: </a>  }
<a name="line1214">1214: </a><font color="#A020F0">#endif</font>

<a name="line1216">1216: </a><font color="#A020F0">#if defined(PETSC_USE_LOG)</font>
<a name="line1217">1217: </a>  <font color="#B22222">/*</font>
<a name="line1218">1218: </a><font color="#B22222">       List all objects the user may have forgot to free</font>
<a name="line1219">1219: </a><font color="#B22222">  */</font>
<a name="line1220">1220: </a>  <font color="#4169E1">if</font> (PetscObjectsLog) {
<a name="line1221">1221: </a>    <a href="../../../docs/manualpages/Sys/PetscOptionsHasName.html#PetscOptionsHasName">PetscOptionsHasName</a>(NULL,NULL,<font color="#666666">"-objects_dump"</font>,&amp;flg1);
<a name="line1222">1222: </a>    <font color="#4169E1">if</font> (flg1) {
<a name="line1223">1223: </a>      <a href="../../../docs/manualpages/Sys/MPI_Comm.html#MPI_Comm">MPI_Comm</a> local_comm;
<a name="line1224">1224: </a>      char     string[64];

<a name="line1226">1226: </a>      <a href="../../../docs/manualpages/Sys/PetscOptionsGetString.html#PetscOptionsGetString">PetscOptionsGetString</a>(NULL,NULL,<font color="#666666">"-objects_dump"</font>,string,64,NULL);
<a name="line1227">1227: </a>      <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_dup.html#MPI_Comm_dup">MPI_Comm_dup</a>(MPI_COMM_WORLD,&amp;local_comm);
<a name="line1228">1228: </a>      PetscSequentialPhaseBegin_Private(local_comm,1);
<a name="line1229">1229: </a>      <a href="../../../docs/manualpages/Sys/PetscObjectsDump.html#PetscObjectsDump">PetscObjectsDump</a>(stdout,(string[0] == 'a') ? <a href="../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a> : <a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>);
<a name="line1230">1230: </a>      PetscSequentialPhaseEnd_Private(local_comm,1);
<a name="line1231">1231: </a>      <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_free.html#MPI_Comm_free">MPI_Comm_free</a>(&amp;local_comm);
<a name="line1232">1232: </a>    }
<a name="line1233">1233: </a>  }
<a name="line1234">1234: </a><font color="#A020F0">#endif</font>

<a name="line1236">1236: </a><font color="#A020F0">#if defined(PETSC_USE_LOG)</font>
<a name="line1237">1237: </a>  PetscObjectsCounts    = 0;
<a name="line1238">1238: </a>  PetscObjectsMaxCounts = 0;
<a name="line1239">1239: </a>  <a href="../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</a>(PetscObjects);
<a name="line1240">1240: </a><font color="#A020F0">#endif</font>

<a name="line1242">1242: </a>  <font color="#B22222">/*</font>
<a name="line1243">1243: </a><font color="#B22222">     Destroy any packages that registered a finalize</font>
<a name="line1244">1244: </a><font color="#B22222">  */</font>
<a name="line1245">1245: </a>  <a href="../../../docs/manualpages/Sys/PetscRegisterFinalizeAll.html#PetscRegisterFinalizeAll">PetscRegisterFinalizeAll</a>();

<a name="line1247">1247: </a><font color="#A020F0">#if defined(PETSC_USE_LOG)</font>
<a name="line1248">1248: </a>  <a href="../../../docs/manualpages/Profiling/PetscLogDestroy.html#PetscLogDestroy">PetscLogDestroy</a>();
<a name="line1249">1249: </a><font color="#A020F0">#endif</font>

<a name="line1251">1251: </a>  <font color="#B22222">/*</font>
<a name="line1252">1252: </a><font color="#B22222">     Print PetscFunctionLists that have not been properly freed</font>

<a name="line1254">1254: </a><font color="#B22222">  PetscFunctionListPrintAll();</font>
<a name="line1255">1255: </a><font color="#B22222">  */</font>

<a name="line1257">1257: </a>  <font color="#4169E1">if</font> (petsc_history) {
<a name="line1258">1258: </a>    PetscCloseHistoryFile(&amp;petsc_history);
<a name="line1259">1259: </a>    petsc_history = 0;
<a name="line1260">1260: </a>  }
<a name="line1261">1261: </a>  PetscOptionsHelpPrintedDestroy(&amp;PetscOptionsHelpPrintedSingleton);

<a name="line1263">1263: </a>  <a href="../../../docs/manualpages/Profiling/PetscInfoAllow.html#PetscInfoAllow">PetscInfoAllow</a>(<a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>,NULL);

<a name="line1265">1265: </a><font color="#A020F0">#if !defined(PETSC_HAVE_THREADSAFETY)</font>
<a name="line1266">1266: </a>  {
<a name="line1267">1267: </a>    char fname[PETSC_MAX_PATH_LEN];
<a name="line1268">1268: </a>    FILE *fd;
<a name="line1269">1269: </a>    int  err;

<a name="line1271">1271: </a>    fname[0] = 0;

<a name="line1273">1273: </a>    <a href="../../../docs/manualpages/Sys/PetscOptionsGetString.html#PetscOptionsGetString">PetscOptionsGetString</a>(NULL,NULL,<font color="#666666">"-malloc_dump"</font>,fname,250,&amp;flg1);
<a name="line1274">1274: </a>    flg2 = <a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line1275">1275: </a>    <a href="../../../docs/manualpages/Sys/PetscOptionsGetBool.html#PetscOptionsGetBool">PetscOptionsGetBool</a>(NULL,NULL,<font color="#666666">"-malloc_test"</font>,&amp;flg2,NULL);
<a name="line1276">1276: </a><font color="#A020F0">#if defined(PETSC_USE_DEBUG)</font>
<a name="line1277">1277: </a>    <font color="#4169E1">if</font> (PETSC_RUNNING_ON_VALGRIND) flg2 = <a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line1278">1278: </a><font color="#A020F0">#else</font>
<a name="line1279">1279: </a>    flg2 = <a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;         <font color="#B22222">/* Skip reporting for optimized builds regardless of -malloc_test */</font>
<a name="line1280">1280: </a><font color="#A020F0">#endif</font>
<a name="line1281">1281: </a>    <font color="#4169E1">if</font> (flg1 &amp;&amp; fname[0]) {
<a name="line1282">1282: </a>      char sname[PETSC_MAX_PATH_LEN];

<a name="line1284">1284: </a>      sprintf(sname,<font color="#666666">"%s_%d"</font>,fname,rank);
<a name="line1285">1285: </a>      fd   = fopen(sname,<font color="#666666">"w"</font>); <font color="#4169E1">if</font> (!fd) <a href="../../../docs/manualpages/Sys/SETERRQ1.html#SETERRQ1">SETERRQ1</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>,PETSC_ERR_FILE_OPEN,<font color="#666666">"Cannot open log file: %s"</font>,sname);
<a name="line1286">1286: </a>      <a href="../../../docs/manualpages/Sys/PetscMallocDump.html#PetscMallocDump">PetscMallocDump</a>(fd);
<a name="line1287">1287: </a>      err  = fclose(fd);
<a name="line1288">1288: </a>      <font color="#4169E1">if</font> (err) <a href="../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>,PETSC_ERR_SYS,<font color="#666666">"fclose() failed on file"</font>);
<a name="line1289">1289: </a>    } <font color="#4169E1">else</font> <font color="#4169E1">if</font> (flg1 || flg2) {
<a name="line1290">1290: </a>      <a href="../../../docs/manualpages/Sys/MPI_Comm.html#MPI_Comm">MPI_Comm</a> local_comm;

<a name="line1292">1292: </a>      <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_dup.html#MPI_Comm_dup">MPI_Comm_dup</a>(MPI_COMM_WORLD,&amp;local_comm);
<a name="line1293">1293: </a>      PetscSequentialPhaseBegin_Private(local_comm,1);
<a name="line1294">1294: </a>      <a href="../../../docs/manualpages/Sys/PetscMallocDump.html#PetscMallocDump">PetscMallocDump</a>(stdout);
<a name="line1295">1295: </a>      PetscSequentialPhaseEnd_Private(local_comm,1);
<a name="line1296">1296: </a>      <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_free.html#MPI_Comm_free">MPI_Comm_free</a>(&amp;local_comm);
<a name="line1297">1297: </a>    }
<a name="line1298">1298: </a>  }

<a name="line1300">1300: </a>  {
<a name="line1301">1301: </a>    char fname[PETSC_MAX_PATH_LEN];
<a name="line1302">1302: </a>    FILE *fd = NULL;

<a name="line1304">1304: </a>    fname[0] = 0;

<a name="line1306">1306: </a>    <a href="../../../docs/manualpages/Sys/PetscOptionsGetString.html#PetscOptionsGetString">PetscOptionsGetString</a>(NULL,NULL,<font color="#666666">"-malloc_log"</font>,fname,250,&amp;flg1);
<a name="line1307">1307: </a>    <a href="../../../docs/manualpages/Sys/PetscOptionsHasName.html#PetscOptionsHasName">PetscOptionsHasName</a>(NULL,NULL,<font color="#666666">"-malloc_log_threshold"</font>,&amp;flg2);
<a name="line1308">1308: </a>    <font color="#4169E1">if</font> (flg1 &amp;&amp; fname[0]) {
<a name="line1309">1309: </a>      int err;

<a name="line1311">1311: </a>      <font color="#4169E1">if</font> (!rank) {
<a name="line1312">1312: </a>        fd = fopen(fname,<font color="#666666">"w"</font>);
<a name="line1313">1313: </a>        <font color="#4169E1">if</font> (!fd) <a href="../../../docs/manualpages/Sys/SETERRQ1.html#SETERRQ1">SETERRQ1</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>,PETSC_ERR_FILE_OPEN,<font color="#666666">"Cannot open log file: %s"</font>,fname);
<a name="line1314">1314: </a>      }
<a name="line1315">1315: </a>      <a href="../../../docs/manualpages/Sys/PetscMallocDumpLog.html#PetscMallocDumpLog">PetscMallocDumpLog</a>(fd);
<a name="line1316">1316: </a>      <font color="#4169E1">if</font> (fd) {
<a name="line1317">1317: </a>        err = fclose(fd);
<a name="line1318">1318: </a>        <font color="#4169E1">if</font> (err) <a href="../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>,PETSC_ERR_SYS,<font color="#666666">"fclose() failed on file"</font>);
<a name="line1319">1319: </a>      }
<a name="line1320">1320: </a>    } <font color="#4169E1">else</font> <font color="#4169E1">if</font> (flg1 || flg2) {
<a name="line1321">1321: </a>      <a href="../../../docs/manualpages/Sys/PetscMallocDumpLog.html#PetscMallocDumpLog">PetscMallocDumpLog</a>(stdout);
<a name="line1322">1322: </a>    }
<a name="line1323">1323: </a>  }
<a name="line1324">1324: </a><font color="#A020F0">#endif</font>

<a name="line1326">1326: </a>  <font color="#B22222">/*</font>
<a name="line1327">1327: </a><font color="#B22222">     Close any open dynamic libraries</font>
<a name="line1328">1328: </a><font color="#B22222">  */</font>
<a name="line1329">1329: </a>  PetscFinalize_DynamicLibraries();

<a name="line1331">1331: </a><font color="#A020F0">#if defined(PETSC_HAVE_CUDA)</font>
<a name="line1332">1332: </a>  flg  = <a href="../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line1333">1333: </a>  <a href="../../../docs/manualpages/Sys/PetscOptionsGetBool.html#PetscOptionsGetBool">PetscOptionsGetBool</a>(NULL,NULL,<font color="#666666">"-cublas"</font>,&amp;flg,NULL);
<a name="line1334">1334: </a>  <font color="#4169E1">if</font> (flg) {
<a name="line1335">1335: </a>    <a href="../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> p;
<a name="line1336">1336: </a>    <font color="#4169E1">for</font> (p = 0; p &lt; PetscGlobalSize; ++p) {
<a name="line1337">1337: </a>      <font color="#4169E1">if</font> (p == PetscGlobalRank) {
<a name="line1338">1338: </a>        <font color="#4169E1">if</font> (cublasv2handle) {
<a name="line1339">1339: </a>          cberr = cublasDestroy(cublasv2handle);CHKERRCUBLAS(cberr);
<a name="line1340">1340: </a>        }
<a name="line1341">1341: </a>      }
<a name="line1342">1342: </a>      <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Barrier.html#MPI_Barrier">MPI_Barrier</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>);
<a name="line1343">1343: </a>    }
<a name="line1344">1344: </a>  }
<a name="line1345">1345: </a><font color="#A020F0">#endif</font>

<a name="line1347">1347: </a>  <font color="#B22222">/* Can be destroyed only after all the options are used */</font>
<a name="line1348">1348: </a>  PetscOptionsDestroyDefault();

<a name="line1350">1350: </a>  PetscGlobalArgc = 0;
<a name="line1351">1351: </a>  PetscGlobalArgs = 0;

<a name="line1353">1353: </a><font color="#A020F0">#if defined(PETSC_USE_REAL___FLOAT128)</font>
<a name="line1354">1354: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Type_free.html#MPI_Type_free">MPI_Type_free</a>(&amp;MPIU___FLOAT128);
<a name="line1355">1355: </a><font color="#A020F0">#if defined(PETSC_HAVE_COMPLEX)</font>
<a name="line1356">1356: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Type_free.html#MPI_Type_free">MPI_Type_free</a>(&amp;MPIU___COMPLEX128);
<a name="line1357">1357: </a><font color="#A020F0">#endif</font>
<a name="line1358">1358: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Op_free.html#MPI_Op_free">MPI_Op_free</a>(&amp;MPIU_MAX);
<a name="line1359">1359: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Op_free.html#MPI_Op_free">MPI_Op_free</a>(&amp;MPIU_MIN);
<a name="line1360">1360: </a><font color="#A020F0">#endif</font>

<a name="line1362">1362: </a><font color="#A020F0">#if defined(PETSC_HAVE_COMPLEX)</font>
<a name="line1363">1363: </a><font color="#A020F0">#if !defined(PETSC_HAVE_MPI_C_DOUBLE_COMPLEX)</font>
<a name="line1364">1364: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Type_free.html#MPI_Type_free">MPI_Type_free</a>(&amp;MPIU_C_DOUBLE_COMPLEX);
<a name="line1365">1365: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Type_free.html#MPI_Type_free">MPI_Type_free</a>(&amp;MPIU_C_COMPLEX);
<a name="line1366">1366: </a><font color="#A020F0">#endif</font>
<a name="line1367">1367: </a><font color="#A020F0">#endif</font>

<a name="line1369">1369: </a><font color="#A020F0">#if (defined(PETSC_HAVE_COMPLEX) &amp;&amp; !defined(PETSC_HAVE_MPI_C_DOUBLE_COMPLEX)) || defined(PETSC_USE_REAL___FLOAT128)</font>
<a name="line1370">1370: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Op_free.html#MPI_Op_free">MPI_Op_free</a>(&amp;MPIU_SUM);
<a name="line1371">1371: </a><font color="#A020F0">#endif</font>

<a name="line1373">1373: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Type_free.html#MPI_Type_free">MPI_Type_free</a>(&amp;MPIU_2SCALAR);
<a name="line1374">1374: </a><font color="#A020F0">#if defined(PETSC_USE_64BIT_INDICES) || !defined(MPI_2INT)</font>
<a name="line1375">1375: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Type_free.html#MPI_Type_free">MPI_Type_free</a>(&amp;MPIU_2INT);
<a name="line1376">1376: </a><font color="#A020F0">#endif</font>
<a name="line1377">1377: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Op_free.html#MPI_Op_free">MPI_Op_free</a>(&amp;PetscMaxSum_Op);

<a name="line1379">1379: </a>  <font color="#B22222">/*</font>
<a name="line1380">1380: </a><font color="#B22222">     Destroy any known inner <a href="../../../docs/manualpages/Sys/MPI_Comm.html#MPI_Comm">MPI_Comm</a>'s and attributes pointing to them</font>
<a name="line1381">1381: </a><font color="#B22222">     Note this will not destroy any new communicators the user has created.</font>

<a name="line1383">1383: </a><font color="#B22222">     If all PETSc objects were not destroyed those left over objects will have hanging references to</font>
<a name="line1384">1384: </a><font color="#B22222">     the MPI_Comms that were freed; but that is ok because those PETSc objects will never be used again</font>
<a name="line1385">1385: </a><font color="#B22222"> */</font>
<a name="line1386">1386: </a>  {
<a name="line1387">1387: </a>    PetscCommCounter *counter;
<a name="line1388">1388: </a>    <a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a>      flg;
<a name="line1389">1389: </a>    <a href="../../../docs/manualpages/Sys/MPI_Comm.html#MPI_Comm">MPI_Comm</a>         icomm;
<a name="line1390">1390: </a>    <font color="#4169E1">union</font> {<a href="../../../docs/manualpages/Sys/MPI_Comm.html#MPI_Comm">MPI_Comm</a> comm; void *ptr;} ucomm;
<a name="line1391">1391: </a>    <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Attr_get.html#MPI_Attr_get">MPI_Attr_get</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>,Petsc_InnerComm_keyval,&amp;ucomm,&amp;flg);
<a name="line1392">1392: </a>    <font color="#4169E1">if</font> (flg) {
<a name="line1393">1393: </a>      icomm = ucomm.comm;
<a name="line1394">1394: </a>      <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Attr_get.html#MPI_Attr_get">MPI_Attr_get</a>(icomm,Petsc_Counter_keyval,&amp;counter,&amp;flg);
<a name="line1395">1395: </a>      <font color="#4169E1">if</font> (!flg) <a href="../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>,PETSC_ERR_ARG_CORRUPT,<font color="#666666">"Inner <a href="../../../docs/manualpages/Sys/MPI_Comm.html#MPI_Comm">MPI_Comm</a> does not have expected tag/name counter, problem with corrupted memory"</font>);

<a name="line1397">1397: </a>      <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Attr_delete.html#MPI_Attr_delete">MPI_Attr_delete</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>,Petsc_InnerComm_keyval);
<a name="line1398">1398: </a>      <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Attr_delete.html#MPI_Attr_delete">MPI_Attr_delete</a>(icomm,Petsc_Counter_keyval);
<a name="line1399">1399: </a>      <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_free.html#MPI_Comm_free">MPI_Comm_free</a>(&amp;icomm);
<a name="line1400">1400: </a>    }
<a name="line1401">1401: </a>    <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Attr_get.html#MPI_Attr_get">MPI_Attr_get</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,Petsc_InnerComm_keyval,&amp;ucomm,&amp;flg);
<a name="line1402">1402: </a>    <font color="#4169E1">if</font> (flg) {
<a name="line1403">1403: </a>      icomm = ucomm.comm;
<a name="line1404">1404: </a>      <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Attr_get.html#MPI_Attr_get">MPI_Attr_get</a>(icomm,Petsc_Counter_keyval,&amp;counter,&amp;flg);
<a name="line1405">1405: </a>      <font color="#4169E1">if</font> (!flg) <a href="../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,PETSC_ERR_ARG_CORRUPT,<font color="#666666">"Inner <a href="../../../docs/manualpages/Sys/MPI_Comm.html#MPI_Comm">MPI_Comm</a> does not have expected tag/name counter, problem with corrupted memory"</font>);

<a name="line1407">1407: </a>      <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Attr_delete.html#MPI_Attr_delete">MPI_Attr_delete</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a>,Petsc_InnerComm_keyval);
<a name="line1408">1408: </a>      <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Attr_delete.html#MPI_Attr_delete">MPI_Attr_delete</a>(icomm,Petsc_Counter_keyval);
<a name="line1409">1409: </a>      <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_free.html#MPI_Comm_free">MPI_Comm_free</a>(&amp;icomm);
<a name="line1410">1410: </a>    }
<a name="line1411">1411: </a>  }

<a name="line1413">1413: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Keyval_free.html#MPI_Keyval_free">MPI_Keyval_free</a>(&amp;Petsc_Counter_keyval);
<a name="line1414">1414: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Keyval_free.html#MPI_Keyval_free">MPI_Keyval_free</a>(&amp;Petsc_InnerComm_keyval);
<a name="line1415">1415: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Keyval_free.html#MPI_Keyval_free">MPI_Keyval_free</a>(&amp;Petsc_OuterComm_keyval);

<a name="line1417">1417: </a>  PetscSpinlockDestroy(&amp;PetscViewerASCIISpinLockOpen);
<a name="line1418">1418: </a>  PetscSpinlockDestroy(&amp;PetscViewerASCIISpinLockStdout);
<a name="line1419">1419: </a>  PetscSpinlockDestroy(&amp;PetscViewerASCIISpinLockStderr);
<a name="line1420">1420: </a>  PetscSpinlockDestroy(&amp;PetscCommSpinLock);

<a name="line1422">1422: </a>  <font color="#4169E1">if</font> (PetscBeganMPI) {
<a name="line1423">1423: </a><font color="#A020F0">#if defined(PETSC_HAVE_MPI_FINALIZED)</font>
<a name="line1424">1424: </a>    <a href="../../../docs/manualpages/Sys/PetscMPIInt.html#PetscMPIInt">PetscMPIInt</a> flag;
<a name="line1425">1425: </a>    <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Finalized.html#MPI_Finalized">MPI_Finalized</a>(&amp;flag);
<a name="line1426">1426: </a>    <font color="#4169E1">if</font> (flag) <a href="../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</a>(<a href="../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>,PETSC_ERR_LIB,<font color="#666666">"<a href="http://www.mpich.org/static/docs/latest/www3/MPI_Finalize.html#MPI_Finalize">MPI_Finalize</a>() has already been called, even though <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Init.html#MPI_Init">MPI_Init</a>() was called by <a href="../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>()"</font>);
<a name="line1427">1427: </a><font color="#A020F0">#endif</font>
<a name="line1428">1428: </a>    <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Finalize.html#MPI_Finalize">MPI_Finalize</a>();
<a name="line1429">1429: </a>  }
<a name="line1430">1430: </a><font color="#B22222">/*</font>

<a name="line1432">1432: </a><font color="#B22222">     Note: In certain cases <a href="../../../docs/manualpages/Sys/PETSC_COMM_WORLD.html#PETSC_COMM_WORLD">PETSC_COMM_WORLD</a> is never <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_free.html#MPI_Comm_free">MPI_Comm_free</a>()ed because</font>
<a name="line1433">1433: </a><font color="#B22222">   the communicator has some outstanding requests on it. Specifically if the</font>
<a name="line1434">1434: </a><font color="#B22222">   flag PETSC_HAVE_BROKEN_REQUEST_FREE is set (for IBM MPI implementation). See</font>
<a name="line1435">1435: </a><font color="#B22222">   src/vec/utils/vpscat.c. Due to this the memory allocated in <a href="../../../docs/manualpages/Sys/PetscCommDuplicate.html#PetscCommDuplicate">PetscCommDuplicate</a>()</font>
<a name="line1436">1436: </a><font color="#B22222">   is never freed as it should be. Thus one may obtain messages of the form</font>
<a name="line1437">1437: </a><font color="#B22222">   [ 1] 8 bytes <a href="../../../docs/manualpages/Sys/PetscCommDuplicate.html#PetscCommDuplicate">PetscCommDuplicate</a>() line 645 in src/sys/mpiu.c indicating the</font>
<a name="line1438">1438: </a><font color="#B22222">   memory was not freed.</font>

<a name="line1440">1440: </a><font color="#B22222">*/</font>
<a name="line1441">1441: </a>  <a href="../../../docs/manualpages/Sys/PetscMallocClear.html#PetscMallocClear">PetscMallocClear</a>();

<a name="line1443">1443: </a>  PetscInitializeCalled = <a href="../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line1444">1444: </a>  PetscFinalizeCalled   = <a href="../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line1445">1445: </a>  <a href="../../../docs/manualpages/Sys/PetscFunctionReturn.html#PetscFunctionReturn">PetscFunctionReturn</a>(ierr);
<a name="line1446">1446: </a>}

<a name="line1448">1448: </a><font color="#A020F0">#if defined(PETSC_MISSING_LAPACK_lsame_)</font>
<a name="line1449">1449: </a><strong><font color="#4169E1"><a name="lsame_"></a>PETSC_EXTERN int lsame_(char *a,char *b)</font></strong>
<a name="line1450">1450: </a>{
<a name="line1451">1451: </a>  <font color="#4169E1">if</font> (*a == *b) <font color="#4169E1">return</font> 1;
<a name="line1452">1452: </a>  <font color="#4169E1">if</font> (*a + 32 == *b) <font color="#4169E1">return</font> 1;
<a name="line1453">1453: </a>  <font color="#4169E1">if</font> (*a - 32 == *b) <font color="#4169E1">return</font> 1;
<a name="line1454">1454: </a>  <font color="#4169E1">return</font> 0;
<a name="line1455">1455: </a>}
<a name="line1456">1456: </a><font color="#A020F0">#endif</font>

<a name="line1458">1458: </a><font color="#A020F0">#if defined(PETSC_MISSING_LAPACK_lsame)</font>
<a name="line1459">1459: </a><strong><font color="#4169E1"><a name="lsame"></a>PETSC_EXTERN int lsame(char *a,char *b)</font></strong>
<a name="line1460">1460: </a>{
<a name="line1461">1461: </a>  <font color="#4169E1">if</font> (*a == *b) <font color="#4169E1">return</font> 1;
<a name="line1462">1462: </a>  <font color="#4169E1">if</font> (*a + 32 == *b) <font color="#4169E1">return</font> 1;
<a name="line1463">1463: </a>  <font color="#4169E1">if</font> (*a - 32 == *b) <font color="#4169E1">return</font> 1;
<a name="line1464">1464: </a>  <font color="#4169E1">return</font> 0;
<a name="line1465">1465: </a>}
<a name="line1466">1466: </a><font color="#A020F0">#endif</font>
</pre>
</body>

</html>
